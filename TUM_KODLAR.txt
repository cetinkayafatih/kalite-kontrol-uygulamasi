======================================
KALITE KONTROL UYGULAMASI - TUM KODLAR
======================================

========================================
DOSYA: ./App.tsx
========================================
import { BrowserRouter, Routes, Route } from 'react-router-dom';
import Layout from './components/layout/Layout';
import Dashboard from './pages/Dashboard';
import LotEntry from './pages/LotEntry';
import Inspection from './pages/Inspection';
import Result from './pages/Result';
import Reports from './pages/Reports';
import Suppliers from './pages/Suppliers';
import Analytics from './pages/Analytics';
import Settings from './pages/Settings';

function App() {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/" element={<Layout />}>
          <Route index element={<Dashboard />} />
          <Route path="lot-entry" element={<LotEntry />} />
          <Route path="inspection" element={<Inspection />} />
          <Route path="result" element={<Result />} />
          <Route path="reports" element={<Reports />} />
          <Route path="suppliers" element={<Suppliers />} />
          <Route path="analytics" element={<Analytics />} />
          <Route path="settings" element={<Settings />} />
        </Route>
      </Routes>
    </BrowserRouter>
  );
}

export default App;


========================================
DOSYA: ./components/common/Badge.tsx
========================================
import type { ReactNode } from 'react';

interface BadgeProps {
  children: ReactNode;
  variant?: 'default' | 'success' | 'danger' | 'warning' | 'info';
  size?: 'sm' | 'md';
  pulse?: boolean;
}

export default function Badge({
  children,
  variant = 'default',
  size = 'md',
  pulse = false
}: BadgeProps) {
  const variantClasses = {
    default: 'bg-gray-100 text-gray-700 dark:bg-slate-700 dark:text-gray-300',
    success: 'bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400',
    danger: 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400',
    warning: 'bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400',
    info: 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400',
  };

  const sizeClasses = {
    sm: 'px-2 py-0.5 text-xs',
    md: 'px-2.5 py-1 text-sm',
  };

  const pulseClasses = pulse
    ? variant === 'success'
      ? 'pulse-success'
      : variant === 'danger'
      ? 'pulse-danger'
      : ''
    : '';

  return (
    <span
      className={`
        inline-flex items-center justify-center
        font-medium rounded-full
        ${variantClasses[variant]}
        ${sizeClasses[size]}
        ${pulseClasses}
      `}
    >
      {children}
    </span>
  );
}

export function StatusBadge({ status }: { status: 'pending' | 'in-progress' | 'completed' }) {
  const config = {
    pending: { label: 'Bekliyor', variant: 'warning' as const },
    'in-progress': { label: 'Devam Ediyor', variant: 'info' as const },
    completed: { label: 'Tamamlandı', variant: 'success' as const },
  };

  const { label, variant } = config[status];
  return <Badge variant={variant}>{label}</Badge>;
}

export function DecisionBadge({ decision }: { decision: 'accepted' | 'rejected' | null }) {
  if (!decision) return <Badge variant="default">-</Badge>;

  const config = {
    accepted: { label: 'KABUL', variant: 'success' as const },
    rejected: { label: 'RED', variant: 'danger' as const },
  };

  const { label, variant } = config[decision];
  return <Badge variant={variant} pulse>{label}</Badge>;
}

export function SeverityBadge({ severity }: { severity: 'critical' | 'major' | 'minor' }) {
  const config = {
    critical: { label: 'Kritik', variant: 'danger' as const },
    major: { label: 'Büyük', variant: 'warning' as const },
    minor: { label: 'Küçük', variant: 'default' as const },
  };

  const { label, variant } = config[severity];
  return <Badge variant={variant} size="sm">{label}</Badge>;
}


========================================
DOSYA: ./components/common/Button.tsx
========================================
import type { ReactNode, ButtonHTMLAttributes } from 'react';
import { Loader2 } from 'lucide-react';

interface ButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {
  children: ReactNode;
  variant?: 'primary' | 'secondary' | 'success' | 'danger' | 'ghost';
  size?: 'sm' | 'md' | 'lg';
  loading?: boolean;
  icon?: ReactNode;
  fullWidth?: boolean;
}

export default function Button({
  children,
  variant = 'primary',
  size = 'md',
  loading = false,
  icon,
  fullWidth = false,
  disabled,
  className = '',
  ...props
}: ButtonProps) {
  const baseClasses = `
    inline-flex items-center justify-center gap-2
    font-medium rounded-xl
    transition-all duration-200
    focus:outline-none focus:ring-2 focus:ring-offset-2
    disabled:opacity-50 disabled:cursor-not-allowed
  `;

  const variantClasses = {
    primary: `
      bg-blue-600 hover:bg-blue-700 active:bg-blue-800
      text-white shadow-md hover:shadow-lg
      focus:ring-blue-500
    `,
    secondary: `
      bg-gray-100 hover:bg-gray-200 active:bg-gray-300
      dark:bg-slate-700 dark:hover:bg-slate-600
      text-gray-800 dark:text-gray-200
      focus:ring-gray-500
    `,
    success: `
      bg-emerald-600 hover:bg-emerald-700 active:bg-emerald-800
      text-white shadow-md hover:shadow-lg
      focus:ring-emerald-500
    `,
    danger: `
      bg-red-600 hover:bg-red-700 active:bg-red-800
      text-white shadow-md hover:shadow-lg
      focus:ring-red-500
    `,
    ghost: `
      bg-transparent hover:bg-gray-100 dark:hover:bg-slate-700
      text-gray-700 dark:text-gray-300
      focus:ring-gray-500
    `,
  };

  const sizeClasses = {
    sm: 'px-3 py-2 text-sm',
    md: 'px-4 py-2.5 text-sm',
    lg: 'px-6 py-3 text-base',
  };

  return (
    <button
      disabled={disabled || loading}
      className={`
        ${baseClasses}
        ${variantClasses[variant]}
        ${sizeClasses[size]}
        ${fullWidth ? 'w-full' : ''}
        ${className}
      `}
      {...props}
    >
      {loading ? (
        <Loader2 className="w-4 h-4 animate-spin" />
      ) : icon ? (
        <span className="w-4 h-4">{icon}</span>
      ) : null}
      {children}
    </button>
  );
}


========================================
DOSYA: ./components/common/Card.tsx
========================================
import type { ReactNode } from 'react';

interface CardProps {
  children: ReactNode;
  className?: string;
  hover?: boolean;
  padding?: 'sm' | 'md' | 'lg' | 'none';
}

export default function Card({
  children,
  className = '',
  hover = false,
  padding = 'md'
}: CardProps) {
  const paddingClasses = {
    none: '',
    sm: 'p-4',
    md: 'p-6',
    lg: 'p-8',
  };

  return (
    <div
      className={`
        bg-white dark:bg-slate-800
        rounded-xl
        border border-gray-200 dark:border-slate-700
        shadow-sm
        ${hover ? 'card-hover hover:shadow-md' : ''}
        ${paddingClasses[padding]}
        ${className}
      `}
    >
      {children}
    </div>
  );
}

interface CardHeaderProps {
  title: string;
  subtitle?: string;
  action?: ReactNode;
}

export function CardHeader({ title, subtitle, action }: CardHeaderProps) {
  return (
    <div className="flex items-center justify-between mb-4">
      <div>
        <h3 className="text-lg font-semibold text-gray-800 dark:text-white">
          {title}
        </h3>
        {subtitle && (
          <p className="text-sm text-gray-500 dark:text-gray-400 mt-1">
            {subtitle}
          </p>
        )}
      </div>
      {action && <div>{action}</div>}
    </div>
  );
}


========================================
DOSYA: ./components/common/Input.tsx
========================================
import type { InputHTMLAttributes } from 'react';
import { forwardRef } from 'react';

interface InputProps extends InputHTMLAttributes<HTMLInputElement> {
  label?: string;
  error?: string;
  helperText?: string;
}

const Input = forwardRef<HTMLInputElement, InputProps>(
  ({ label, error, helperText, className = '', ...props }, ref) => {
    return (
      <div className="space-y-1">
        {label && (
          <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">
            {label}
            {props.required && <span className="text-red-500 ml-1">*</span>}
          </label>
        )}
        <input
          ref={ref}
          className={`
            w-full px-4 py-2.5
            border rounded-xl
            bg-white dark:bg-slate-800
            text-gray-900 dark:text-gray-100
            placeholder-gray-400 dark:placeholder-gray-500
            focus:outline-none focus:ring-2 focus:ring-offset-0
            transition-all duration-200
            ${
              error
                ? 'border-red-500 focus:ring-red-500'
                : 'border-gray-300 dark:border-slate-600 focus:ring-blue-500 focus:border-blue-500'
            }
            ${className}
          `}
          {...props}
        />
        {error && (
          <p className="text-sm text-red-500">{error}</p>
        )}
        {helperText && !error && (
          <p className="text-sm text-gray-500 dark:text-gray-400">{helperText}</p>
        )}
      </div>
    );
  }
);

Input.displayName = 'Input';

export default Input;

interface SelectProps extends React.SelectHTMLAttributes<HTMLSelectElement> {
  label?: string;
  error?: string;
  options: { value: string; label: string }[];
  placeholder?: string;
}

export function Select({
  label,
  error,
  options,
  placeholder,
  className = '',
  ...props
}: SelectProps) {
  return (
    <div className="space-y-1">
      {label && (
        <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">
          {label}
          {props.required && <span className="text-red-500 ml-1">*</span>}
        </label>
      )}
      <select
        className={`
          w-full px-4 py-2.5
          border rounded-xl
          bg-white dark:bg-slate-800
          text-gray-900 dark:text-gray-100
          focus:outline-none focus:ring-2 focus:ring-offset-0
          transition-all duration-200 cursor-pointer
          ${
            error
              ? 'border-red-500 focus:ring-red-500'
              : 'border-gray-300 dark:border-slate-600 focus:ring-blue-500 focus:border-blue-500'
          }
          ${className}
        `}
        {...props}
      >
        {placeholder && (
          <option value="">{placeholder}</option>
        )}
        {options.map((option) => (
          <option key={option.value} value={option.value}>
            {option.label}
          </option>
        ))}
      </select>
      {error && <p className="text-sm text-red-500">{error}</p>}
    </div>
  );
}

interface TextAreaProps extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {
  label?: string;
  error?: string;
}

export function TextArea({
  label,
  error,
  className = '',
  ...props
}: TextAreaProps) {
  return (
    <div className="space-y-1">
      {label && (
        <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">
          {label}
        </label>
      )}
      <textarea
        className={`
          w-full px-4 py-2.5
          border rounded-xl
          bg-white dark:bg-slate-800
          text-gray-900 dark:text-gray-100
          placeholder-gray-400 dark:placeholder-gray-500
          focus:outline-none focus:ring-2 focus:ring-offset-0
          transition-all duration-200 resize-none
          ${
            error
              ? 'border-red-500 focus:ring-red-500'
              : 'border-gray-300 dark:border-slate-600 focus:ring-blue-500 focus:border-blue-500'
          }
          ${className}
        `}
        {...props}
      />
      {error && <p className="text-sm text-red-500">{error}</p>}
    </div>
  );
}


========================================
DOSYA: ./components/common/Modal.tsx
========================================
import type { ReactNode } from 'react';
import { useEffect } from 'react';
import { X } from 'lucide-react';

interface ModalProps {
  isOpen: boolean;
  onClose: () => void;
  title: string;
  children: ReactNode;
  size?: 'sm' | 'md' | 'lg' | 'xl';
  showCloseButton?: boolean;
}

export default function Modal({
  isOpen,
  onClose,
  title,
  children,
  size = 'md',
  showCloseButton = true
}: ModalProps) {
  // Escape key to close
  useEffect(() => {
    const handleEscape = (e: KeyboardEvent) => {
      if (e.key === 'Escape') onClose();
    };

    if (isOpen) {
      document.addEventListener('keydown', handleEscape);
      document.body.style.overflow = 'hidden';
    }

    return () => {
      document.removeEventListener('keydown', handleEscape);
      document.body.style.overflow = 'unset';
    };
  }, [isOpen, onClose]);

  if (!isOpen) return null;

  const sizeClasses = {
    sm: 'max-w-md',
    md: 'max-w-lg',
    lg: 'max-w-2xl',
    xl: 'max-w-4xl',
  };

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
      {/* Backdrop */}
      <div
        className="absolute inset-0 bg-black/50 backdrop-blur-sm"
        onClick={onClose}
      />

      {/* Modal */}
      <div
        className={`
          relative w-full ${sizeClasses[size]}
          bg-white dark:bg-slate-800
          rounded-2xl shadow-xl
          max-h-[90vh] overflow-hidden
          fade-in
        `}
      >
        {/* Header */}
        <div className="flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-slate-700">
          <h2 className="text-lg font-semibold text-gray-800 dark:text-white">
            {title}
          </h2>
          {showCloseButton && (
            <button
              onClick={onClose}
              className="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors"
            >
              <X className="w-5 h-5 text-gray-500" />
            </button>
          )}
        </div>

        {/* Content */}
        <div className="px-6 py-4 overflow-y-auto max-h-[calc(90vh-8rem)]">
          {children}
        </div>
      </div>
    </div>
  );
}


========================================
DOSYA: ./components/common/StatsCard.tsx
========================================
import type { ReactNode } from 'react';
import { TrendingUp, TrendingDown } from 'lucide-react';

interface StatsCardProps {
  title: string;
  value: string | number;
  icon: ReactNode;
  trend?: number;
  trendLabel?: string;
  color?: 'blue' | 'green' | 'red' | 'amber' | 'purple';
}

export default function StatsCard({
  title,
  value,
  icon,
  trend,
  trendLabel,
  color = 'blue'
}: StatsCardProps) {
  const colorClasses = {
    blue: {
      bg: 'bg-blue-50 dark:bg-blue-900/20',
      icon: 'text-blue-600 dark:text-blue-400',
      iconBg: 'bg-blue-100 dark:bg-blue-900/30',
    },
    green: {
      bg: 'bg-emerald-50 dark:bg-emerald-900/20',
      icon: 'text-emerald-600 dark:text-emerald-400',
      iconBg: 'bg-emerald-100 dark:bg-emerald-900/30',
    },
    red: {
      bg: 'bg-red-50 dark:bg-red-900/20',
      icon: 'text-red-600 dark:text-red-400',
      iconBg: 'bg-red-100 dark:bg-red-900/30',
    },
    amber: {
      bg: 'bg-amber-50 dark:bg-amber-900/20',
      icon: 'text-amber-600 dark:text-amber-400',
      iconBg: 'bg-amber-100 dark:bg-amber-900/30',
    },
    purple: {
      bg: 'bg-purple-50 dark:bg-purple-900/20',
      icon: 'text-purple-600 dark:text-purple-400',
      iconBg: 'bg-purple-100 dark:bg-purple-900/30',
    },
  };

  const colors = colorClasses[color];

  return (
    <div className="bg-white dark:bg-slate-800 rounded-xl border border-gray-200 dark:border-slate-700 p-6 card-hover">
      <div className="flex items-start justify-between">
        <div className="flex-1">
          <p className="text-sm font-medium text-gray-500 dark:text-gray-400">
            {title}
          </p>
          <p className="mt-2 text-3xl font-bold text-gray-900 dark:text-white">
            {value}
          </p>
          {trend !== undefined && (
            <div className="mt-2 flex items-center gap-1">
              {trend >= 0 ? (
                <TrendingUp className="w-4 h-4 text-emerald-500" />
              ) : (
                <TrendingDown className="w-4 h-4 text-red-500" />
              )}
              <span
                className={`text-sm font-medium ${
                  trend >= 0 ? 'text-emerald-600' : 'text-red-600'
                }`}
              >
                {trend >= 0 ? '+' : ''}{trend}%
              </span>
              {trendLabel && (
                <span className="text-sm text-gray-500 dark:text-gray-400">
                  {trendLabel}
                </span>
              )}
            </div>
          )}
        </div>
        <div className={`p-3 rounded-xl ${colors.iconBg}`}>
          <div className={colors.icon}>{icon}</div>
        </div>
      </div>
    </div>
  );
}


========================================
DOSYA: ./components/layout/Header.tsx
========================================
import { Menu, Moon, Sun, Bell, User } from 'lucide-react';
import { useSettingsStore } from '../../store/useStore';

interface HeaderProps {
  onMenuClick: () => void;
  title?: string;
}

export default function Header({ onMenuClick, title }: HeaderProps) {
  const { settings, toggleDarkMode } = useSettingsStore();

  return (
    <header className="sticky top-0 z-30 h-16 bg-white dark:bg-slate-800 border-b border-gray-200 dark:border-slate-700 shadow-sm">
      <div className="flex items-center justify-between h-full px-4 lg:px-6">
        {/* Left side */}
        <div className="flex items-center gap-4">
          <button
            onClick={onMenuClick}
            className="lg:hidden p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors"
          >
            <Menu className="w-6 h-6 text-gray-600 dark:text-gray-400" />
          </button>

          {title && (
            <h1 className="text-xl font-semibold text-gray-800 dark:text-white">
              {title}
            </h1>
          )}
        </div>

        {/* Right side */}
        <div className="flex items-center gap-2">
          {/* Notifications */}
          <button className="relative p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors">
            <Bell className="w-5 h-5 text-gray-600 dark:text-gray-400" />
            <span className="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></span>
          </button>

          {/* Theme toggle */}
          <button
            onClick={toggleDarkMode}
            className="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors"
          >
            {settings.darkMode ? (
              <Sun className="w-5 h-5 text-yellow-500" />
            ) : (
              <Moon className="w-5 h-5 text-gray-600" />
            )}
          </button>

          {/* User menu */}
          <div className="flex items-center gap-3 pl-3 ml-2 border-l border-gray-200 dark:border-slate-700">
            <div className="hidden sm:block text-right">
              <p className="text-sm font-medium text-gray-800 dark:text-white">Kalite Kontrol</p>
              <p className="text-xs text-gray-500 dark:text-gray-400">Yönetici</p>
            </div>
            <div className="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center shadow-md">
              <User className="w-5 h-5 text-white" />
            </div>
          </div>
        </div>
      </div>
    </header>
  );
}


========================================
DOSYA: ./components/layout/Layout.tsx
========================================
import { useState, useEffect } from 'react';
import { Outlet, useLocation } from 'react-router-dom';
import Sidebar from './Sidebar';
import Header from './Header';
import { useSettingsStore } from '../../store/useStore';
import { Toaster } from 'react-hot-toast';

const pageTitles: Record<string, string> = {
  '/': 'Kontrol Paneli',
  '/lot-entry': 'Yeni Parti Girişi',
  '/inspection': 'Kontrol',
  '/result': 'Kontrol Sonucu',
  '/reports': 'Raporlar',
  '/suppliers': 'Tedarikçi Yönetimi',
  '/analytics': 'Analiz & İstatistik',
  '/settings': 'Ayarlar',
};

export default function Layout() {
  const [sidebarOpen, setSidebarOpen] = useState(false);
  const location = useLocation();
  const { settings } = useSettingsStore();

  // Apply dark mode
  useEffect(() => {
    if (settings.darkMode) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  }, [settings.darkMode]);

  const pageTitle = pageTitles[location.pathname] || 'Kalite Kontrol';

  return (
    <div className="flex h-screen bg-gray-50 dark:bg-slate-900">
      {/* Sidebar */}
      <Sidebar isOpen={sidebarOpen} onClose={() => setSidebarOpen(false)} />

      {/* Main content */}
      <div className="flex-1 flex flex-col min-w-0 overflow-hidden">
        {/* Header */}
        <Header
          onMenuClick={() => setSidebarOpen(true)}
          title={pageTitle}
        />

        {/* Page content */}
        <main className="flex-1 overflow-y-auto p-4 lg:p-6">
          <div className="fade-in">
            <Outlet />
          </div>
        </main>
      </div>

      {/* Toast notifications */}
      <Toaster
        position="top-right"
        toastOptions={{
          duration: 4000,
          style: {
            background: settings.darkMode ? '#1E293B' : '#fff',
            color: settings.darkMode ? '#fff' : '#1F2937',
            border: settings.darkMode ? '1px solid #334155' : '1px solid #E5E7EB',
          },
          success: {
            iconTheme: {
              primary: '#10B981',
              secondary: '#fff',
            },
          },
          error: {
            iconTheme: {
              primary: '#EF4444',
              secondary: '#fff',
            },
          },
        }}
      />
    </div>
  );
}


========================================
DOSYA: ./components/layout/Sidebar.tsx
========================================
import { NavLink } from 'react-router-dom';
import {
  LayoutDashboard,
  PackagePlus,
  ClipboardCheck,
  FileText,
  Building2,
  BarChart3,
  Settings,
  Factory,
  X
} from 'lucide-react';

interface SidebarProps {
  isOpen: boolean;
  onClose: () => void;
}

const menuItems = [
  { path: '/', icon: LayoutDashboard, label: 'Kontrol Paneli' },
  { path: '/lot-entry', icon: PackagePlus, label: 'Parti Girişi' },
  { path: '/inspection', icon: ClipboardCheck, label: 'Kontrol' },
  { path: '/reports', icon: FileText, label: 'Raporlar' },
  { path: '/suppliers', icon: Building2, label: 'Tedarikçiler' },
  { path: '/analytics', icon: BarChart3, label: 'Analiz' },
  { path: '/settings', icon: Settings, label: 'Ayarlar' },
];

export default function Sidebar({ isOpen, onClose }: SidebarProps) {
  return (
    <>
      {/* Overlay for mobile */}
      {isOpen && (
        <div
          className="fixed inset-0 bg-black/50 z-40 lg:hidden"
          onClick={onClose}
        />
      )}

      {/* Sidebar */}
      <aside
        className={`
          fixed top-0 left-0 z-50 h-full w-64 bg-white dark:bg-slate-800
          border-r border-gray-200 dark:border-slate-700
          transform transition-transform duration-300 ease-in-out
          lg:translate-x-0 lg:static lg:z-auto
          ${isOpen ? 'translate-x-0' : '-translate-x-full'}
        `}
      >
        {/* Logo */}
        <div className="flex items-center justify-between h-16 px-4 border-b border-gray-200 dark:border-slate-700">
          <div className="flex items-center gap-2">
            <div className="w-10 h-10 bg-gradient-to-br from-blue-600 to-blue-700 rounded-xl flex items-center justify-center shadow-lg">
              <Factory className="w-6 h-6 text-white" />
            </div>
            <div>
              <h1 className="text-sm font-bold text-gray-800 dark:text-white">KKYS</h1>
              <p className="text-xs text-gray-500 dark:text-gray-400">Kalite Kontrol</p>
            </div>
          </div>
          <button
            onClick={onClose}
            className="lg:hidden p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700"
          >
            <X className="w-5 h-5 text-gray-500" />
          </button>
        </div>

        {/* Navigation */}
        <nav className="p-4 space-y-1">
          {menuItems.map((item) => (
            <NavLink
              key={item.path}
              to={item.path}
              onClick={onClose}
              className={({ isActive }) =>
                `flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 group
                ${
                  isActive
                    ? 'bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 font-medium shadow-sm'
                    : 'text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-slate-700/50 hover:text-gray-900 dark:hover:text-white'
                }`
              }
            >
              <item.icon className="w-5 h-5 transition-transform group-hover:scale-110" />
              <span>{item.label}</span>
            </NavLink>
          ))}
        </nav>

        {/* Footer */}
        <div className="absolute bottom-0 left-0 right-0 p-4 border-t border-gray-200 dark:border-slate-700">
          <div className="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl p-4">
            <p className="text-xs font-medium text-blue-700 dark:text-blue-400">ISO 2859-1</p>
            <p className="text-xs text-gray-600 dark:text-gray-400 mt-1">
              Standart Örnekleme Sistemi
            </p>
          </div>
        </div>
      </aside>
    </>
  );
}


========================================
DOSYA: ./components/switching/StopProductionModal.tsx
========================================
// Stop Production Warning Modal

import { AlertTriangle, XCircle } from 'lucide-react';
import Modal from '../common/Modal';
import Button from '../common/Button';
import { useSwitchingStore } from '../../store/switchingStore';

interface StopProductionModalProps {
  isOpen: boolean;
  onClose: () => void;
  supplierId: string;
  supplierName: string;
  materialTypeId: string;
  materialName: string;
}

export default function StopProductionModal({
  isOpen,
  onClose,
  supplierId,
  supplierName,
  materialTypeId,
  materialName,
}: StopProductionModalProps) {
  const clearStopFlag = useSwitchingStore((s) => s.clearStopFlag);

  const handleAcknowledge = () => {
    clearStopFlag(supplierId, materialTypeId);
    onClose();
  };

  return (
    <Modal
      isOpen={isOpen}
      onClose={() => {}} // Kapatma butonu yok
      title=""
      size="md"
      showCloseButton={false}
    >
      <div className="text-center py-4">
        {/* Warning Icon */}
        <div className="w-24 h-24 mx-auto mb-6 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center animate-pulse">
          <AlertTriangle className="w-14 h-14 text-red-500" />
        </div>

        {/* Title */}
        <h2 className="text-2xl font-bold text-red-600 dark:text-red-400 mb-2">
          ÜRETİM DURDURULMALI
        </h2>

        {/* Message */}
        <p className="text-gray-600 dark:text-gray-400 mb-6">
          5 ardışık parti reddedildi!
        </p>

        {/* Details */}
        <div className="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-4 mb-6">
          <div className="grid grid-cols-2 gap-4 text-left">
            <div>
              <p className="text-xs text-gray-500 dark:text-gray-400">Tedarikçi</p>
              <p className="font-semibold text-gray-900 dark:text-white">
                {supplierName}
              </p>
            </div>
            <div>
              <p className="text-xs text-gray-500 dark:text-gray-400">Malzeme</p>
              <p className="font-semibold text-gray-900 dark:text-white">
                {materialName}
              </p>
            </div>
          </div>
        </div>

        {/* Action Items */}
        <div className="bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-xl p-4 mb-6 text-left">
          <p className="text-sm font-semibold text-amber-800 dark:text-amber-200 mb-2">
            Yapılması Gerekenler:
          </p>
          <ul className="text-sm text-amber-700 dark:text-amber-300 space-y-1">
            <li className="flex items-start gap-2">
              <span className="mt-1">•</span>
              <span>Tedarikçi ile acil görüşme yapın</span>
            </li>
            <li className="flex items-start gap-2">
              <span className="mt-1">•</span>
              <span>Kök neden analizi isteyin</span>
            </li>
            <li className="flex items-start gap-2">
              <span className="mt-1">•</span>
              <span>Düzeltici faaliyet planı talep edin</span>
            </li>
            <li className="flex items-start gap-2">
              <span className="mt-1">•</span>
              <span>Yeni parti kabul etmeden önce onay alın</span>
            </li>
          </ul>
        </div>

        {/* Buttons */}
        <div className="space-y-3">
          <Button
            onClick={handleAcknowledge}
            variant="danger"
            fullWidth
            size="lg"
          >
            <XCircle className="w-5 h-5 mr-2" />
            Anladım, Tedarikçi ile İletişime Geçeceğim
          </Button>
        </div>
      </div>
    </Modal>
  );
}


========================================
DOSYA: ./components/switching/SwitchingBadge.tsx
========================================
// Switching Level Badge Component

import { useState } from 'react';
import { Shield, AlertTriangle, ChevronDown } from 'lucide-react';
import type { SwitchingLevel, SwitchingState } from '../../types/switching';
import { SWITCHING_LEVEL_LABELS, SWITCHING_LEVEL_COLORS } from '../../types/switching';
import { getSwitchingStatusText } from '../../utils/switchingLogic';
import { useSwitchingStore } from '../../store/switchingStore';
import SwitchingHistory from './SwitchingHistory';

interface SwitchingBadgeProps {
  supplierId: string;
  materialTypeId: string;
  supplierName?: string;
  materialName?: string;
  showDetails?: boolean;
  size?: 'sm' | 'md' | 'lg';
}

export default function SwitchingBadge({
  supplierId,
  materialTypeId,
  supplierName,
  materialName,
  showDetails = true,
  size = 'md',
}: SwitchingBadgeProps) {
  const [showHistory, setShowHistory] = useState(false);
  const state = useSwitchingStore((s) => s.getState(supplierId, materialTypeId));

  if (!supplierId || !materialTypeId) return null;

  const level = state.currentLevel;
  const colors = SWITCHING_LEVEL_COLORS[level];
  const label = SWITCHING_LEVEL_LABELS[level];
  const statusText = getSwitchingStatusText(state);

  const sizeClasses = {
    sm: 'text-xs px-2 py-0.5',
    md: 'text-sm px-3 py-1',
    lg: 'text-base px-4 py-1.5',
  };

  const iconSizes = {
    sm: 'w-3 h-3',
    md: 'w-4 h-4',
    lg: 'w-5 h-5',
  };

  return (
    <>
      <button
        onClick={() => setShowHistory(true)}
        className={`inline-flex items-center gap-1.5 rounded-full border font-medium transition-all hover:shadow-md ${colors.bg} ${colors.text} ${colors.border} ${sizeClasses[size]}`}
        title={statusText}
      >
        {state.shouldStopProduction ? (
          <AlertTriangle className={`${iconSizes[size]} text-red-500 animate-pulse`} />
        ) : (
          <Shield className={iconSizes[size]} />
        )}
        <span>{label}</span>
        {showDetails && (
          <ChevronDown className={`${iconSizes[size]} opacity-50`} />
        )}
      </button>

      {/* History Modal */}
      <SwitchingHistory
        isOpen={showHistory}
        onClose={() => setShowHistory(false)}
        supplierId={supplierId}
        materialTypeId={materialTypeId}
        supplierName={supplierName}
        materialName={materialName}
      />
    </>
  );
}

// Kompakt versiyon - sadece simge
export function SwitchingIcon({
  level,
  shouldStop,
}: {
  level: SwitchingLevel;
  shouldStop?: boolean;
}) {
  const colors = SWITCHING_LEVEL_COLORS[level];

  if (shouldStop) {
    return (
      <span className="inline-flex items-center justify-center w-6 h-6 rounded-full bg-red-100 dark:bg-red-900/30">
        <AlertTriangle className="w-4 h-4 text-red-500 animate-pulse" />
      </span>
    );
  }

  return (
    <span
      className={`inline-flex items-center justify-center w-6 h-6 rounded-full ${colors.bg}`}
    >
      <Shield className={`w-4 h-4 ${colors.text}`} />
    </span>
  );
}

// Inline durum göstergesi
export function SwitchingStatus({
  state,
}: {
  state: SwitchingState;
}) {
  const colors = SWITCHING_LEVEL_COLORS[state.currentLevel];
  const statusText = getSwitchingStatusText(state);

  return (
    <div className={`flex items-center gap-2 text-sm ${colors.text}`}>
      <SwitchingIcon level={state.currentLevel} shouldStop={state.shouldStopProduction} />
      <span>{statusText}</span>
    </div>
  );
}


========================================
DOSYA: ./components/switching/SwitchingHistory.tsx
========================================
// Switching History Modal Component

import { ArrowRight, History, RotateCcw } from 'lucide-react';
import Modal from '../common/Modal';
import Button from '../common/Button';
import { useSwitchingStore } from '../../store/switchingStore';
import { SWITCHING_LEVEL_LABELS, SWITCHING_LEVEL_COLORS } from '../../types/switching';
import { getSwitchingStatusText } from '../../utils/switchingLogic';
import { formatDateTime } from '../../data/samplingData';
import toast from 'react-hot-toast';

interface SwitchingHistoryProps {
  isOpen: boolean;
  onClose: () => void;
  supplierId: string;
  materialTypeId: string;
  supplierName?: string;
  materialName?: string;
}

export default function SwitchingHistory({
  isOpen,
  onClose,
  supplierId,
  materialTypeId,
  supplierName,
  materialName,
}: SwitchingHistoryProps) {
  const state = useSwitchingStore((s) => s.getState(supplierId, materialTypeId));
  const resetState = useSwitchingStore((s) => s.resetState);
  const history = state.history;

  const handleReset = () => {
    if (confirm('Switching durumu sıfırlanacak. Emin misiniz?')) {
      resetState(supplierId, materialTypeId);
      toast.success('Switching durumu sıfırlandı');
      onClose();
    }
  };

  const currentLevel = state.currentLevel;
  const colors = SWITCHING_LEVEL_COLORS[currentLevel];

  const modalTitle = supplierName && materialName
    ? `${supplierName} - ${materialName}`
    : 'Kontrol Seviyesi Geçmişi';

  return (
    <Modal
      isOpen={isOpen}
      onClose={onClose}
      title={modalTitle}
      size="md"
    >
      <div className="space-y-4">
        {/* Mevcut Durum */}
        <div className={`p-4 rounded-xl border ${colors.bg} ${colors.border}`}>
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-500 dark:text-gray-400">Mevcut Seviye</p>
              <p className={`text-xl font-bold ${colors.text}`}>
                {SWITCHING_LEVEL_LABELS[currentLevel]}
              </p>
            </div>
            <div className="text-right">
              <p className="text-sm text-gray-500 dark:text-gray-400">Durum</p>
              <p className="text-sm font-medium text-gray-700 dark:text-gray-300">
                {getSwitchingStatusText(state)}
              </p>
            </div>
          </div>

          {/* İstatistikler */}
          <div className="mt-4 grid grid-cols-3 gap-3">
            <div className="text-center p-2 bg-white/50 dark:bg-slate-800/50 rounded-lg">
              <p className="text-lg font-bold text-gray-900 dark:text-white">
                {state.consecutiveAccepts}
              </p>
              <p className="text-xs text-gray-500">Ardışık Kabul</p>
            </div>
            <div className="text-center p-2 bg-white/50 dark:bg-slate-800/50 rounded-lg">
              <p className="text-lg font-bold text-gray-900 dark:text-white">
                {state.consecutiveRejects}
              </p>
              <p className="text-xs text-gray-500">Ardışık Red</p>
            </div>
            <div className="text-center p-2 bg-white/50 dark:bg-slate-800/50 rounded-lg">
              <p className="text-lg font-bold text-gray-900 dark:text-white">
                {state.recentResults.length}
              </p>
              <p className="text-xs text-gray-500">Son Kontrol</p>
            </div>
          </div>
        </div>

        {/* Son Sonuçlar */}
        {state.recentResults.length > 0 && (
          <div>
            <p className="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
              Son 5 Sonuç
            </p>
            <div className="flex gap-1">
              {state.recentResults.map((result, index) => (
                <span
                  key={index}
                  className={`w-8 h-8 rounded-lg flex items-center justify-center text-xs font-bold ${
                    result === 'accepted'
                      ? 'bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300'
                      : 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300'
                  }`}
                >
                  {result === 'accepted' ? 'K' : 'R'}
                </span>
              ))}
            </div>
          </div>
        )}

        {/* Geçiş Geçmişi */}
        <div>
          <div className="flex items-center gap-2 mb-3">
            <History className="w-4 h-4 text-gray-500" />
            <p className="text-sm font-medium text-gray-700 dark:text-gray-300">
              Geçiş Geçmişi
            </p>
          </div>

          {history.length === 0 ? (
            <p className="text-sm text-gray-500 dark:text-gray-400 text-center py-4">
              Henüz seviye geçişi yok
            </p>
          ) : (
            <div className="space-y-2 max-h-48 overflow-y-auto">
              {[...history].reverse().map((transition) => {
                const fromColors = SWITCHING_LEVEL_COLORS[transition.fromLevel];
                const toColors = SWITCHING_LEVEL_COLORS[transition.toLevel];

                return (
                  <div
                    key={transition.id}
                    className="p-3 bg-gray-50 dark:bg-slate-700 rounded-lg"
                  >
                    <div className="flex items-center gap-2 mb-1">
                      <span
                        className={`text-xs px-2 py-0.5 rounded-full ${fromColors.bg} ${fromColors.text}`}
                      >
                        {SWITCHING_LEVEL_LABELS[transition.fromLevel]}
                      </span>
                      <ArrowRight className="w-4 h-4 text-gray-400" />
                      <span
                        className={`text-xs px-2 py-0.5 rounded-full ${toColors.bg} ${toColors.text}`}
                      >
                        {SWITCHING_LEVEL_LABELS[transition.toLevel]}
                      </span>
                    </div>
                    <p className="text-xs text-gray-600 dark:text-gray-400">
                      {transition.reason} • {transition.lotNumber}
                    </p>
                    <p className="text-xs text-gray-400 dark:text-gray-500">
                      {formatDateTime(transition.timestamp)}
                    </p>
                  </div>
                );
              })}
            </div>
          )}
        </div>

        {/* Actions */}
        <div className="flex justify-between pt-4 border-t border-gray-200 dark:border-slate-700">
          <Button
            variant="secondary"
            size="sm"
            onClick={handleReset}
          >
            <RotateCcw className="w-4 h-4 mr-2" />
            Sıfırla
          </Button>
          <Button onClick={onClose}>
            Kapat
          </Button>
        </div>
      </div>
    </Modal>
  );
}


========================================
DOSYA: ./data/samplingData.ts
========================================
import type { MaterialType, Supplier } from '../types';

// ============================================
// ISO 2859-1 ÖRNEKLEME TABLOLARI
// ============================================

export const sampleSizeTable: Record<string, { code: string; size: number }> = {
  "2-8": { code: "A", size: 2 },
  "9-15": { code: "B", size: 3 },
  "16-25": { code: "C", size: 5 },
  "26-50": { code: "D", size: 8 },
  "51-90": { code: "E", size: 13 },
  "91-150": { code: "F", size: 20 },
  "151-280": { code: "G", size: 32 },
  "281-500": { code: "H", size: 50 },
  "501-1200": { code: "J", size: 80 },
  "1201-3200": { code: "K", size: 125 },
  "3201-10000": { code: "L", size: 200 },
  "10001-35000": { code: "M", size: 315 },
  "35001-150000": { code: "N", size: 500 },
  "150001-500000": { code: "P", size: 800 },
  "500001-9999999": { code: "Q", size: 1250 },
};

// Muayene seviyelerine göre örneklem kodu çarpanları
export const inspectionLevelMultipliers: Record<string, number> = {
  "I": 0.4,    // Azaltılmış - daha az örnek
  "II": 1,     // Normal
  "III": 1.6,  // Sıkılaştırılmış - daha fazla örnek
};

// AQL değerlerine göre Kabul (Ac) ve Red (Re) sayıları
export const acceptanceTable: Record<string, Record<string, [number, number] | null>> = {
  A: { "0.65": null, "1.0": null, "1.5": null, "2.5": [0, 1], "4.0": [0, 1], "6.5": [0, 1] },
  B: { "0.65": null, "1.0": null, "1.5": [0, 1], "2.5": [0, 1], "4.0": [0, 1], "6.5": [1, 2] },
  C: { "0.65": null, "1.0": [0, 1], "1.5": [0, 1], "2.5": [0, 1], "4.0": [0, 1], "6.5": [1, 2] },
  D: { "0.65": null, "1.0": [0, 1], "1.5": [0, 1], "2.5": [0, 1], "4.0": [1, 2], "6.5": [2, 3] },
  E: { "0.65": [0, 1], "1.0": [0, 1], "1.5": [0, 1], "2.5": [1, 2], "4.0": [1, 2], "6.5": [3, 4] },
  F: { "0.65": [0, 1], "1.0": [0, 1], "1.5": [1, 2], "2.5": [1, 2], "4.0": [2, 3], "6.5": [5, 6] },
  G: { "0.65": [0, 1], "1.0": [1, 2], "1.5": [1, 2], "2.5": [2, 3], "4.0": [3, 4], "6.5": [7, 8] },
  H: { "0.65": [0, 1], "1.0": [1, 2], "1.5": [2, 3], "2.5": [3, 4], "4.0": [5, 6], "6.5": [10, 11] },
  J: { "0.65": [1, 2], "1.0": [2, 3], "1.5": [3, 4], "2.5": [5, 6], "4.0": [7, 8], "6.5": [14, 15] },
  K: { "0.65": [1, 2], "1.0": [3, 4], "1.5": [5, 6], "2.5": [7, 8], "4.0": [10, 11], "6.5": [21, 22] },
  L: { "0.65": [2, 3], "1.0": [5, 6], "1.5": [7, 8], "2.5": [10, 11], "4.0": [14, 15], "6.5": [21, 22] },
  M: { "0.65": [3, 4], "1.0": [7, 8], "1.5": [10, 11], "2.5": [14, 15], "4.0": [21, 22], "6.5": [21, 22] },
  N: { "0.65": [5, 6], "1.0": [10, 11], "1.5": [14, 15], "2.5": [21, 22], "4.0": [21, 22], "6.5": [21, 22] },
  P: { "0.65": [7, 8], "1.0": [14, 15], "1.5": [21, 22], "2.5": [21, 22], "4.0": [21, 22], "6.5": [21, 22] },
  Q: { "0.65": [10, 11], "1.0": [21, 22], "1.5": [21, 22], "2.5": [21, 22], "4.0": [21, 22], "6.5": [21, 22] },
};

// ============================================
// MALZEME TÜRLERİ
// ============================================

export const labelMaterial: MaterialType = {
  id: "mat-label",
  name: "Etiket",
  code: "ETK",
  unit: "adet",
  defaultAQL: "2.5",
  criteria: [
    {
      id: "L01",
      name: "Baskı Kalitesi",
      description: "Baskının netliği ve okunabilirliği",
      acceptanceCriteria: "Net, okunaklı, lekesiz olmalı",
      isCritical: true,
    },
    {
      id: "L02",
      name: "Renk Uyumu",
      description: "Referans numuneye göre renk kontrolü",
      acceptanceCriteria: "Onaylı numuneye uygun olmalı",
      isCritical: true,
    },
    {
      id: "L03",
      name: "Boyut/Ölçü",
      description: "Etiket boyutlarının kontrolü",
      acceptanceCriteria: "Tolerans: ±1mm",
      isCritical: false,
    },
    {
      id: "L04",
      name: "Kesim Kalitesi",
      description: "Kesim kenarlarının düzgünlüğü",
      acceptanceCriteria: "Düzgün kenarlar, çapaksız",
      isCritical: false,
    },
    {
      id: "L05",
      name: "Yazı/Logo Doğruluğu",
      description: "Yazım ve logo kontrolü",
      acceptanceCriteria: "Hatasız yazım, doğru logo",
      isCritical: true,
    },
    {
      id: "L06",
      name: "Malzeme Kalitesi",
      description: "Etiket malzemesinin fiziksel durumu",
      acceptanceCriteria: "Yırtık, delik, katlama yok",
      isCritical: true,
    },
    {
      id: "L07",
      name: "Yapışkanlık",
      description: "Yapışkanlı etiketler için yapışma testi",
      acceptanceCriteria: "Tam yapışma, kalıntısız çıkma",
      isCritical: false,
    },
    {
      id: "L08",
      name: "Barkod Okunabilirliği",
      description: "Barkod tarama testi",
      acceptanceCriteria: "Tarayıcıda %100 okuma",
      isCritical: true,
    },
  ],
  defectTypes: [
    { id: "E01", code: "E01", name: "Baskı Hatası", description: "Silik, bulanık, eksik baskı", severity: "major" },
    { id: "E02", code: "E02", name: "Renk Kayması", description: "Renk tonu farklı, soluk", severity: "major" },
    { id: "E03", code: "E03", name: "Boyut Hatası", description: "Ölçü tolerans dışı", severity: "major" },
    { id: "E04", code: "E04", name: "Kesim Hatası", description: "Eğri kesim, çapak", severity: "minor" },
    { id: "E05", code: "E05", name: "Yazım Hatası", description: "Yanlış yazı, eksik harf", severity: "critical" },
    { id: "E06", code: "E06", name: "Malzeme Hasarı", description: "Yırtık, delik, kırışık", severity: "major" },
    { id: "E07", code: "E07", name: "Yapışma Sorunu", description: "Yapışmıyor veya kalıntı bırakıyor", severity: "major" },
    { id: "E08", code: "E08", name: "Barkod Hatası", description: "Okunamıyor, yanlış kod", severity: "critical" },
  ],
};

export const yarnMaterial: MaterialType = {
  id: "mat-yarn",
  name: "İplik",
  code: "IPL",
  unit: "bobin",
  defaultAQL: "2.5",
  criteria: [
    {
      id: "Y01",
      name: "Sarım Kalitesi",
      description: "Bobinin sarım düzgünlüğü kontrolü",
      acceptanceCriteria: "Düzgün sarım, gevşeklik veya aşırı sıkışma yok",
      inspectionMethod: "Görsel",
      isCritical: true,
    },
    {
      id: "Y02",
      name: "Bobin Formu",
      description: "Bobinin fiziksel form kontrolü",
      acceptanceCriteria: "Deforme değil, ezik veya çarpık değil",
      inspectionMethod: "Görsel",
      isCritical: false,
    },
    {
      id: "Y03",
      name: "Renk Homojenliği",
      description: "Parti içi renk uyumu kontrolü",
      acceptanceCriteria: "Parti içinde renk farkı yok, referansa uygun",
      inspectionMethod: "Görsel karşılaştırma",
      isCritical: true,
    },
    {
      id: "Y04",
      name: "Yabancı Madde",
      description: "Kontaminasyon kontrolü",
      acceptanceCriteria: "Kir, yağ, toz veya leke yok",
      inspectionMethod: "Görsel",
      isCritical: true,
    },
    {
      id: "Y05",
      name: "Nem/Koku",
      description: "Nem durumu ve koku kontrolü",
      acceptanceCriteria: "Kuru, küf veya kötü koku yok",
      inspectionMethod: "Dokunma ve koku",
      isCritical: true,
    },
    {
      id: "Y06",
      name: "Etiket Bilgisi",
      description: "Bobin etiketi doğrulama",
      acceptanceCriteria: "Lot numarası, iplik numarası ve renk kodu doğru",
      inspectionMethod: "Görsel",
      isCritical: false,
    },
    {
      id: "Y07",
      name: "Neps (Topaklanma)",
      description: "Yüzeyde topaklanma kontrolü",
      acceptanceCriteria: "Yüzeyde belirgin topaklanma yok",
      inspectionMethod: "Görsel (bobin yüzeyi)",
      isCritical: true,
    },
    {
      id: "Y08",
      name: "Düğüm/Ek Yeri",
      description: "İplik ek noktaları kontrolü",
      acceptanceCriteria: "Aşırı düğüm veya kötü yapılmış ek yeri yok",
      inspectionMethod: "Görsel",
      isCritical: false,
    },
  ],
  defectTypes: [
    { id: "I01", code: "I01", name: "Sarım Hatası", description: "Gevşek sarım, sıkı sarım, düzensiz sarım", severity: "major" },
    { id: "I02", code: "I02", name: "Bobin Deformasyonu", description: "Ezik, çarpık veya hasarlı bobin", severity: "major" },
    { id: "I03", code: "I03", name: "Renk Farkı", description: "Parti içi renk uyumsuzluğu, ton farkı", severity: "critical" },
    { id: "I04", code: "I04", name: "Yabancı Madde", description: "Kir, yağ, toz, leke kontaminasyonu", severity: "major" },
    { id: "I05", code: "I05", name: "Nem/Küf", description: "Islak, nemli, küflü veya kötü kokulu", severity: "critical" },
    { id: "I06", code: "I06", name: "Etiket Hatası", description: "Yanlış veya eksik etiket bilgisi", severity: "minor" },
    { id: "I07", code: "I07", name: "Görünür Neps", description: "Bobin yüzeyinde belirgin topaklanma", severity: "major" },
    { id: "I08", code: "I08", name: "Aşırı Düğüm", description: "Çok sayıda düğüm veya kötü yapılmış ek", severity: "major" },
  ],
};

export const materialTypes: MaterialType[] = [labelMaterial, yarnMaterial];

// ============================================
// AQL SEÇENEKLERİ
// ============================================

export const aqlOptions = [
  { value: "0.65", label: "%0.65 - Çok Sıkı" },
  { value: "1.0", label: "%1.0 - Sıkı" },
  { value: "1.5", label: "%1.5 - Normal-Sıkı" },
  { value: "2.5", label: "%2.5 - Normal (Önerilen)" },
  { value: "4.0", label: "%4.0 - Gevşek" },
  { value: "6.5", label: "%6.5 - Çok Gevşek" },
];

// ============================================
// MUAYENE SEVİYELERİ
// ============================================

export const inspectionLevels = [
  { value: "I", label: "Seviye I - Azaltılmış" },
  { value: "II", label: "Seviye II - Normal (Önerilen)" },
  { value: "III", label: "Seviye III - Sıkılaştırılmış" },
];

// ============================================
// ÖRNEK TEDARİKÇİLER
// ============================================

export const sampleSuppliers: Supplier[] = [
  {
    id: "sup-001",
    name: "ABC Etiket Ltd. Şti.",
    code: "ABC",
    contactPerson: "Ahmet Yılmaz",
    phone: "0212 555 1234",
    email: "info@abcetiket.com",
    address: "İstanbul, Türkiye",
    createdAt: new Date().toISOString(),
    isActive: true,
  },
  {
    id: "sup-002",
    name: "XYZ İplik San. A.Ş.",
    code: "XYZ",
    contactPerson: "Mehmet Demir",
    phone: "0216 444 5678",
    email: "satis@xyziplik.com",
    address: "Bursa, Türkiye",
    createdAt: new Date().toISOString(),
    isActive: true,
  },
  {
    id: "sup-003",
    name: "Tekstil Malzeme Tic.",
    code: "TMT",
    contactPerson: "Ayşe Kaya",
    phone: "0224 333 9012",
    email: "ayse@tekstilmalzeme.com",
    address: "Bursa, Türkiye",
    createdAt: new Date().toISOString(),
    isActive: true,
  },
];

// ============================================
// YARDIMCI FONKSİYONLAR
// ============================================

export function calculateSampling(lotSize: number, aql: string, inspectionLevel: string = "II"): {
  sampleCode: string;
  sampleSize: number;
  acceptanceNumber: number;
  rejectionNumber: number;
} | null {
  let sampleCode = "";
  let sampleSize = 0;

  for (const [range, data] of Object.entries(sampleSizeTable)) {
    const [min, max] = range.split("-").map(Number);
    if (lotSize >= min && lotSize <= max) {
      sampleCode = data.code;
      sampleSize = data.size;
      break;
    }
  }

  if (!sampleCode) return null;

  // Muayene seviyesine göre ayarlama
  const multiplier = inspectionLevelMultipliers[inspectionLevel] || 1;
  sampleSize = Math.round(sampleSize * multiplier);

  const acceptance = acceptanceTable[sampleCode]?.[aql];
  if (!acceptance) return null;

  return {
    sampleCode,
    sampleSize,
    acceptanceNumber: acceptance[0],
    rejectionNumber: acceptance[1],
  };
}

export function generateLotNumber(): string {
  const year = new Date().getFullYear();
  const random = Math.floor(Math.random() * 1000).toString().padStart(3, "0");
  return `LOT-${year}-${random}`;
}

export function formatDate(date: Date | string): string {
  const d = typeof date === "string" ? new Date(date) : date;
  return d.toLocaleDateString("tr-TR", {
    day: "2-digit",
    month: "2-digit",
    year: "numeric",
  });
}

export function formatDateTime(date: Date | string): string {
  const d = typeof date === "string" ? new Date(date) : date;
  return d.toLocaleDateString("tr-TR", {
    day: "2-digit",
    month: "2-digit",
    year: "numeric",
    hour: "2-digit",
    minute: "2-digit",
  });
}

export function calculatePercentage(value: number, total: number): string {
  if (total === 0) return "0.0";
  return ((value / total) * 100).toFixed(1);
}

export function makeDecision(
  defectCount: number,
  acceptanceNumber: number,
  rejectionNumber: number
): "accepted" | "rejected" | "continue" {
  if (defectCount <= acceptanceNumber) return "accepted";
  if (defectCount >= rejectionNumber) return "rejected";
  return "continue";
}

export function getSeverityColor(severity: "critical" | "major" | "minor"): string {
  switch (severity) {
    case "critical":
      return "#EF4444";
    case "major":
      return "#F59E0B";
    case "minor":
      return "#6B7280";
  }
}

export function getSeverityLabel(severity: "critical" | "major" | "minor"): string {
  switch (severity) {
    case "critical":
      return "Kritik";
    case "major":
      return "Büyük";
    case "minor":
      return "Küçük";
  }
}


========================================
DOSYA: ./main.tsx
========================================
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.tsx'

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <App />
  </StrictMode>,
)


========================================
DOSYA: ./pages/Analytics.tsx
========================================
import { useState } from 'react';
import {
  BarChart,
  Bar,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  ResponsiveContainer,
  Line,
  PieChart,
  Pie,
  Cell,
  Legend,
  AreaChart,
  Area,
  ComposedChart
} from 'recharts';
import {
  TrendingUp,
  BarChart3,
  PieChart as PieChartIcon,
  Activity,
  Building2
} from 'lucide-react';
import Card, { CardHeader } from '../components/common/Card';
import { Select } from '../components/common/Input';
import {
  useAnalytics,
  useLotStore,
  useMaterialStore
} from '../store/useStore';

const COLORS = ['#10B981', '#EF4444', '#F59E0B', '#3B82F6', '#8B5CF6', '#EC4899', '#14B8A6', '#F97316'];

export default function Analytics() {
  const [timeRange, setTimeRange] = useState('30');
  const { getSupplierPerformance, getDefectAnalysis, getTrendData } = useAnalytics();
  const lots = useLotStore((state) => state.lots);
  const materials = useMaterialStore((state) => state.materials);
  const supplierPerformance = getSupplierPerformance().filter(p => p.totalLots > 0);
  const defectAnalysis = getDefectAnalysis();
  const trendData = getTrendData(parseInt(timeRange));

  // Prepare Pareto data
  const paretoData = defectAnalysis.map((item, index) => {
    const cumulative = defectAnalysis
      .slice(0, index + 1)
      .reduce((sum, d) => sum + d.percentage, 0);
    return {
      ...item,
      cumulative,
    };
  });

  // OC Curve simulation data (simplified)
  const ocCurveData = [
    { p: 0, pa: 100 },
    { p: 1, pa: 98 },
    { p: 2, pa: 92 },
    { p: 2.5, pa: 85 },
    { p: 3, pa: 75 },
    { p: 4, pa: 55 },
    { p: 5, pa: 35 },
    { p: 6, pa: 20 },
    { p: 7, pa: 10 },
    { p: 8, pa: 5 },
    { p: 10, pa: 1 },
  ];

  // Material distribution
  const materialDistribution = materials.map(m => {
    const count = lots.filter(l => l.materialTypeId === m.id && l.status === 'completed').length;
    return { name: m.name, value: count };
  }).filter(m => m.value > 0);

  return (
    <div className="space-y-6">
      {/* Time Range Filter */}
      <div className="flex justify-end">
        <Select
          value={timeRange}
          onChange={(e) => setTimeRange(e.target.value)}
          options={[
            { value: '7', label: 'Son 7 Gün' },
            { value: '14', label: 'Son 14 Gün' },
            { value: '30', label: 'Son 30 Gün' },
            { value: '90', label: 'Son 90 Gün' },
          ]}
        />
      </div>

      {/* Trend Chart */}
      <Card>
        <CardHeader
          title="Kontrol Trendi"
          subtitle={`Son ${timeRange} gün`}
          action={<Activity className="w-5 h-5 text-blue-500" />}
        />
        <div className="h-80">
          <ResponsiveContainer width="100%" height="100%">
            <AreaChart data={trendData}>
              <defs>
                <linearGradient id="colorInspections" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="5%" stopColor="#3B82F6" stopOpacity={0.3}/>
                  <stop offset="95%" stopColor="#3B82F6" stopOpacity={0}/>
                </linearGradient>
              </defs>
              <CartesianGrid strokeDasharray="3 3" className="stroke-gray-200 dark:stroke-slate-700" />
              <XAxis
                dataKey="date"
                tickFormatter={(value) => {
                  const date = new Date(value);
                  return `${date.getDate()}/${date.getMonth() + 1}`;
                }}
              />
              <YAxis />
              <Tooltip
                contentStyle={{
                  backgroundColor: 'var(--tooltip-bg, #fff)',
                  border: '1px solid var(--tooltip-border, #e5e7eb)',
                  borderRadius: '8px',
                }}
              />
              <Area
                type="monotone"
                dataKey="inspections"
                name="Kontrol"
                stroke="#3B82F6"
                fillOpacity={1}
                fill="url(#colorInspections)"
              />
              <Line
                type="monotone"
                dataKey="accepted"
                name="Kabul"
                stroke="#10B981"
                strokeWidth={2}
                dot={false}
              />
              <Line
                type="monotone"
                dataKey="rejected"
                name="Red"
                stroke="#EF4444"
                strokeWidth={2}
                dot={false}
              />
            </AreaChart>
          </ResponsiveContainer>
        </div>
      </Card>

      {/* Charts Row */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* Pareto Analysis */}
        <Card>
          <CardHeader
            title="Pareto Analizi (80/20)"
            subtitle="En sık görülen hatalar"
            action={<BarChart3 className="w-5 h-5 text-amber-500" />}
          />
          {paretoData.length > 0 ? (
            <div className="h-80">
              <ResponsiveContainer width="100%" height="100%">
                <ComposedChart data={paretoData}>
                  <CartesianGrid strokeDasharray="3 3" className="stroke-gray-200 dark:stroke-slate-700" />
                  <XAxis dataKey="defectName" tick={{ fontSize: 10 }} angle={-45} textAnchor="end" height={80} />
                  <YAxis yAxisId="left" />
                  <YAxis yAxisId="right" orientation="right" domain={[0, 100]} />
                  <Tooltip />
                  <Bar yAxisId="left" dataKey="count" name="Adet" fill="#3B82F6" radius={[4, 4, 0, 0]}>
                    {paretoData.map((_, index) => (
                      <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                    ))}
                  </Bar>
                  <Line
                    yAxisId="right"
                    type="monotone"
                    dataKey="cumulative"
                    name="Kümülatif %"
                    stroke="#EF4444"
                    strokeWidth={2}
                    dot={{ fill: '#EF4444' }}
                  />
                </ComposedChart>
              </ResponsiveContainer>
            </div>
          ) : (
            <div className="h-80 flex items-center justify-center text-gray-500">
              Henüz hata verisi yok
            </div>
          )}
        </Card>

        {/* OC Curve */}
        <Card>
          <CardHeader
            title="OC Eğrisi (İşletme Karakteristiği)"
            subtitle="AQL %2.5, n=200 için"
            action={<TrendingUp className="w-5 h-5 text-purple-500" />}
          />
          <div className="h-80">
            <ResponsiveContainer width="100%" height="100%">
              <AreaChart data={ocCurveData}>
                <defs>
                  <linearGradient id="colorOC" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="5%" stopColor="#8B5CF6" stopOpacity={0.3}/>
                    <stop offset="95%" stopColor="#8B5CF6" stopOpacity={0}/>
                  </linearGradient>
                </defs>
                <CartesianGrid strokeDasharray="3 3" className="stroke-gray-200 dark:stroke-slate-700" />
                <XAxis
                  dataKey="p"
                  label={{ value: 'Hata Oranı (%)', position: 'bottom', offset: -5 }}
                />
                <YAxis
                  domain={[0, 100]}
                  label={{ value: 'Kabul Olasılığı (%)', angle: -90, position: 'insideLeft' }}
                />
                <Tooltip />
                <Area
                  type="monotone"
                  dataKey="pa"
                  name="Pa"
                  stroke="#8B5CF6"
                  fillOpacity={1}
                  fill="url(#colorOC)"
                />
                {/* AQL line */}
                <Line
                  type="monotone"
                  data={[{ p: 2.5, pa: 0 }, { p: 2.5, pa: 100 }]}
                  dataKey="pa"
                  stroke="#10B981"
                  strokeDasharray="5 5"
                />
              </AreaChart>
            </ResponsiveContainer>
          </div>
          <div className="mt-4 text-sm text-gray-500 dark:text-gray-400 space-y-1">
            <p><span className="inline-block w-3 h-3 bg-emerald-500 rounded mr-2"></span>AQL = %2.5 (Kabul Kalite Düzeyi)</p>
            <p><span className="inline-block w-3 h-3 bg-red-500 rounded mr-2"></span>LTPD ≈ %8 (Lot Tolerans Hatalı Oranı)</p>
          </div>
        </Card>
      </div>

      {/* Supplier Performance & Material Distribution */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* Supplier Performance */}
        <Card>
          <CardHeader
            title="Tedarikçi Performansı"
            subtitle="Kabul oranlarına göre"
            action={<Building2 className="w-5 h-5 text-blue-500" />}
          />
          {supplierPerformance.length > 0 ? (
            <div className="h-80">
              <ResponsiveContainer width="100%" height="100%">
                <BarChart data={supplierPerformance} layout="vertical">
                  <CartesianGrid strokeDasharray="3 3" className="stroke-gray-200 dark:stroke-slate-700" />
                  <XAxis type="number" domain={[0, 100]} />
                  <YAxis type="category" dataKey="supplierName" width={120} tick={{ fontSize: 12 }} />
                  <Tooltip
                    formatter={(value: number) => [`%${value.toFixed(1)}`, 'Kabul Oranı']}
                  />
                  <Bar dataKey="acceptanceRate" name="Kabul Oranı" radius={[0, 4, 4, 0]}>
                    {supplierPerformance.map((entry, index) => (
                      <Cell
                        key={`cell-${index}`}
                        fill={
                          entry.acceptanceRate >= 90
                            ? '#10B981'
                            : entry.acceptanceRate >= 70
                            ? '#F59E0B'
                            : '#EF4444'
                        }
                      />
                    ))}
                  </Bar>
                </BarChart>
              </ResponsiveContainer>
            </div>
          ) : (
            <div className="h-80 flex items-center justify-center text-gray-500">
              Henüz tedarikçi performans verisi yok
            </div>
          )}
        </Card>

        {/* Material Distribution */}
        <Card>
          <CardHeader
            title="Malzeme Dağılımı"
            subtitle="Kontrol edilen partiler"
            action={<PieChartIcon className="w-5 h-5 text-emerald-500" />}
          />
          {materialDistribution.length > 0 ? (
            <div className="h-80">
              <ResponsiveContainer width="100%" height="100%">
                <PieChart>
                  <Pie
                    data={materialDistribution}
                    cx="50%"
                    cy="50%"
                    innerRadius={60}
                    outerRadius={100}
                    paddingAngle={5}
                    dataKey="value"
                    label={({ name, percent }) => `${name} ${((percent ?? 0) * 100).toFixed(0)}%`}
                  >
                    {materialDistribution.map((_, index) => (
                      <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                    ))}
                  </Pie>
                  <Tooltip />
                  <Legend />
                </PieChart>
              </ResponsiveContainer>
            </div>
          ) : (
            <div className="h-80 flex items-center justify-center text-gray-500">
              Henüz kontrol verisi yok
            </div>
          )}
        </Card>
      </div>

      {/* Supplier Scorecard Table */}
      {supplierPerformance.length > 0 && (
        <Card>
          <CardHeader
            title="Tedarikçi Karnesi"
            subtitle="Detaylı performans metrikleri"
          />
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead>
                <tr className="border-b border-gray-200 dark:border-slate-700">
                  <th className="text-left py-3 px-4 text-sm font-semibold text-gray-600 dark:text-gray-400">
                    Tedarikçi
                  </th>
                  <th className="text-center py-3 px-4 text-sm font-semibold text-gray-600 dark:text-gray-400">
                    Toplam Parti
                  </th>
                  <th className="text-center py-3 px-4 text-sm font-semibold text-gray-600 dark:text-gray-400">
                    Kabul
                  </th>
                  <th className="text-center py-3 px-4 text-sm font-semibold text-gray-600 dark:text-gray-400">
                    Red
                  </th>
                  <th className="text-center py-3 px-4 text-sm font-semibold text-gray-600 dark:text-gray-400">
                    Kabul Oranı
                  </th>
                  <th className="text-center py-3 px-4 text-sm font-semibold text-gray-600 dark:text-gray-400">
                    Ort. Hata
                  </th>
                  <th className="text-center py-3 px-4 text-sm font-semibold text-gray-600 dark:text-gray-400">
                    Puan
                  </th>
                </tr>
              </thead>
              <tbody>
                {supplierPerformance
                  .sort((a, b) => b.acceptanceRate - a.acceptanceRate)
                  .map((supplier) => {
                    const score = Math.round(supplier.acceptanceRate);
                    return (
                      <tr
                        key={supplier.supplierId}
                        className="border-b border-gray-100 dark:border-slate-700/50"
                      >
                        <td className="py-3 px-4 font-medium text-gray-900 dark:text-white">
                          {supplier.supplierName}
                        </td>
                        <td className="py-3 px-4 text-center text-gray-600 dark:text-gray-400">
                          {supplier.totalLots}
                        </td>
                        <td className="py-3 px-4 text-center text-emerald-600 dark:text-emerald-400">
                          {supplier.acceptedLots}
                        </td>
                        <td className="py-3 px-4 text-center text-red-600 dark:text-red-400">
                          {supplier.rejectedLots}
                        </td>
                        <td className="py-3 px-4 text-center">
                          <span
                            className={`font-medium ${
                              supplier.acceptanceRate >= 90
                                ? 'text-emerald-600 dark:text-emerald-400'
                                : supplier.acceptanceRate >= 70
                                ? 'text-amber-600 dark:text-amber-400'
                                : 'text-red-600 dark:text-red-400'
                            }`}
                          >
                            %{supplier.acceptanceRate.toFixed(1)}
                          </span>
                        </td>
                        <td className="py-3 px-4 text-center text-gray-600 dark:text-gray-400">
                          {supplier.avgDefectsPerLot.toFixed(1)}
                        </td>
                        <td className="py-3 px-4 text-center">
                          <span
                            className={`inline-flex items-center justify-center w-10 h-10 rounded-full font-bold text-white ${
                              score >= 90
                                ? 'bg-emerald-500'
                                : score >= 70
                                ? 'bg-amber-500'
                                : 'bg-red-500'
                            }`}
                          >
                            {score}
                          </span>
                        </td>
                      </tr>
                    );
                  })}
              </tbody>
            </table>
          </div>
        </Card>
      )}
    </div>
  );
}


========================================
DOSYA: ./pages/Dashboard.tsx
========================================
import { useNavigate } from 'react-router-dom';
import {
  ClipboardCheck,
  Package,
  CheckCircle,
  XCircle,
  Clock,
  TrendingUp,
  Plus,
  ArrowRight,
  Shuffle
} from 'lucide-react';
import {
  AreaChart,
  Area,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  ResponsiveContainer,
  PieChart,
  Pie,
  Cell,
  Legend
} from 'recharts';
import Card, { CardHeader } from '../components/common/Card';
import StatsCard from '../components/common/StatsCard';
import Button from '../components/common/Button';
import { DecisionBadge } from '../components/common/Badge';
import {
  useLotStore,
  useSupplierStore,
  useMaterialStore,
  useAnalytics
} from '../store/useStore';
import { formatDate } from '../data/samplingData';
import { selectRandomLot } from '../utils/clusterSampling';
import toast from 'react-hot-toast';

// Pie chart renkleri - kategoriye özel
const PIE_COLORS: Record<string, string> = {
  'Kabul': '#3B82F6', // Mavi
  'Red': '#EF4444',   // Kırmızı
};

export default function Dashboard() {
  const navigate = useNavigate();
  const lots = useLotStore((state) => state.lots);
  const suppliers = useSupplierStore((state) => state.suppliers);
  const materials = useMaterialStore((state) => state.materials);
  const { getStats, getTrendData } = useAnalytics();

  const stats = getStats();
  const trendData = getTrendData(14);

  // Pie chart data - her kategorinin kendi rengi var
  const pieData = [
    { name: 'Kabul', value: stats.totalAccepted, color: PIE_COLORS['Kabul'] },
    { name: 'Red', value: stats.totalRejected, color: PIE_COLORS['Red'] },
  ].filter(d => d.value > 0);

  // Recent lots
  const recentLots = lots.slice(0, 5);

  // Get supplier and material names
  const getSupplierName = (id: string) =>
    suppliers.find(s => s.id === id)?.name || 'Bilinmiyor';
  const getMaterialName = (id: string) =>
    materials.find(m => m.id === id)?.name || 'Bilinmiyor';

  // Rastgele lot seç ve kontrole başla
  const handleRandomLot = () => {
    const randomLot = selectRandomLot(lots);
    if (randomLot) {
      toast.success(`Rastgele seçilen: ${randomLot.lotNumber}`);
      navigate('/inspection', { state: { lotId: randomLot.id } });
    } else {
      toast.error('Bekleyen parti bulunamadı');
    }
  };

  return (
    <div className="space-y-6">
      {/* Quick Actions */}
      <div className="flex flex-wrap gap-3">
        <Button
          icon={<Plus className="w-4 h-4" />}
          onClick={() => navigate('/lot-entry')}
        >
          Yeni Parti Girişi
        </Button>
        <Button
          variant="secondary"
          icon={<ClipboardCheck className="w-4 h-4" />}
          onClick={() => navigate('/inspection')}
        >
          Kontrol Yap
        </Button>
        {stats.pendingLots > 0 && (
          <Button
            variant="secondary"
            icon={<Shuffle className="w-4 h-4" />}
            onClick={handleRandomLot}
            className="bg-purple-50 hover:bg-purple-100 text-purple-700 border-purple-200 dark:bg-purple-900/20 dark:hover:bg-purple-900/30 dark:text-purple-300 dark:border-purple-800"
          >
            Rastgele Lot Başlat
          </Button>
        )}
      </div>

      {/* Stats Cards */}
      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <StatsCard
          title="Bugün Kontrol"
          value={stats.todayInspections}
          icon={<ClipboardCheck className="w-6 h-6" />}
          color="blue"
        />
        <StatsCard
          title="Bu Hafta"
          value={stats.weeklyInspections}
          icon={<Package className="w-6 h-6" />}
          color="purple"
        />
        <StatsCard
          title="Kabul Oranı"
          value={`%${stats.acceptanceRate.toFixed(1)}`}
          icon={<CheckCircle className="w-6 h-6" />}
          color="green"
        />
        <StatsCard
          title="Bekleyen Parti"
          value={stats.pendingLots}
          icon={<Clock className="w-6 h-6" />}
          color="amber"
        />
      </div>

      {/* Charts Row */}
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        {/* Trend Chart */}
        <Card className="lg:col-span-2">
          <CardHeader
            title="Kontrol Trendi"
            subtitle="Son 14 gün"
          />
          <div className="h-80">
            <ResponsiveContainer width="100%" height="100%">
              <AreaChart data={trendData}>
                <defs>
                  <linearGradient id="colorAccepted" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="5%" stopColor="#10B981" stopOpacity={0.3}/>
                    <stop offset="95%" stopColor="#10B981" stopOpacity={0}/>
                  </linearGradient>
                  <linearGradient id="colorRejected" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="5%" stopColor="#EF4444" stopOpacity={0.3}/>
                    <stop offset="95%" stopColor="#EF4444" stopOpacity={0}/>
                  </linearGradient>
                </defs>
                <CartesianGrid strokeDasharray="3 3" className="stroke-gray-200 dark:stroke-slate-700" />
                <XAxis
                  dataKey="date"
                  tickFormatter={(value) => {
                    const date = new Date(value);
                    return `${date.getDate()}/${date.getMonth() + 1}`;
                  }}
                  className="text-gray-500"
                />
                <YAxis className="text-gray-500" />
                <Tooltip
                  contentStyle={{
                    backgroundColor: 'var(--tooltip-bg, #fff)',
                    border: '1px solid var(--tooltip-border, #e5e7eb)',
                    borderRadius: '8px',
                  }}
                  labelFormatter={(value) => formatDate(value)}
                />
                <Area
                  type="monotone"
                  dataKey="accepted"
                  name="Kabul"
                  stroke="#10B981"
                  fillOpacity={1}
                  fill="url(#colorAccepted)"
                />
                <Area
                  type="monotone"
                  dataKey="rejected"
                  name="Red"
                  stroke="#EF4444"
                  fillOpacity={1}
                  fill="url(#colorRejected)"
                />
              </AreaChart>
            </ResponsiveContainer>
          </div>
        </Card>

        {/* Pie Chart */}
        <Card>
          <CardHeader
            title="Kabul/Red Dağılımı"
            subtitle="Toplam sonuçlar"
          />
          <div className="h-80">
            {pieData.length > 0 ? (
              <ResponsiveContainer width="100%" height="100%">
                <PieChart>
                  <Pie
                    data={pieData}
                    cx="50%"
                    cy="50%"
                    innerRadius={60}
                    outerRadius={100}
                    paddingAngle={5}
                    dataKey="value"
                    label={({ name, percent }) => `${name} ${((percent ?? 0) * 100).toFixed(0)}%`}
                  >
                    {pieData.map((entry, index) => (
                      <Cell key={`cell-${index}`} fill={entry.color} />
                    ))}
                  </Pie>
                  <Tooltip />
                  <Legend />
                </PieChart>
              </ResponsiveContainer>
            ) : (
              <div className="h-full flex items-center justify-center">
                <div className="text-center text-gray-500">
                  <Package className="w-12 h-12 mx-auto mb-2 opacity-50" />
                  <p>Henüz kontrol verisi yok</p>
                </div>
              </div>
            )}
          </div>
        </Card>
      </div>

      {/* Summary Cards */}
      <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
        <Card className="bg-gradient-to-br from-emerald-500 to-emerald-600 border-0">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-emerald-100 text-sm">Kabul Edilen</p>
              <p className="text-3xl font-bold text-white mt-1">{stats.totalAccepted}</p>
            </div>
            <CheckCircle className="w-12 h-12 text-emerald-200 opacity-80" />
          </div>
        </Card>
        <Card className="bg-gradient-to-br from-red-500 to-red-600 border-0">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-red-100 text-sm">Reddedilen</p>
              <p className="text-3xl font-bold text-white mt-1">{stats.totalRejected}</p>
            </div>
            <XCircle className="w-12 h-12 text-red-200 opacity-80" />
          </div>
        </Card>
        <Card className="bg-gradient-to-br from-blue-500 to-blue-600 border-0">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-blue-100 text-sm">Toplam Parti</p>
              <p className="text-3xl font-bold text-white mt-1">{stats.totalLots}</p>
            </div>
            <TrendingUp className="w-12 h-12 text-blue-200 opacity-80" />
          </div>
        </Card>
      </div>

      {/* Recent Inspections */}
      <Card>
        <CardHeader
          title="Son Kontroller"
          action={
            <Button variant="ghost" size="sm" onClick={() => navigate('/reports')}>
              Tümünü Gör
              <ArrowRight className="w-4 h-4 ml-1" />
            </Button>
          }
        />
        {recentLots.length > 0 ? (
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead>
                <tr className="border-b border-gray-200 dark:border-slate-700">
                  <th className="text-left py-3 px-4 text-sm font-semibold text-gray-600 dark:text-gray-400">Parti No</th>
                  <th className="text-left py-3 px-4 text-sm font-semibold text-gray-600 dark:text-gray-400">Malzeme</th>
                  <th className="text-left py-3 px-4 text-sm font-semibold text-gray-600 dark:text-gray-400">Tedarikçi</th>
                  <th className="text-left py-3 px-4 text-sm font-semibold text-gray-600 dark:text-gray-400">Tarih</th>
                  <th className="text-left py-3 px-4 text-sm font-semibold text-gray-600 dark:text-gray-400">Sonuç</th>
                </tr>
              </thead>
              <tbody>
                {recentLots.map((lot) => (
                  <tr
                    key={lot.id}
                    className="border-b border-gray-100 dark:border-slate-700/50 hover:bg-gray-50 dark:hover:bg-slate-700/30 cursor-pointer transition-colors"
                    onClick={() => navigate(`/reports?lot=${lot.id}`)}
                  >
                    <td className="py-3 px-4">
                      <span className="font-medium text-gray-900 dark:text-white">
                        {lot.lotNumber}
                      </span>
                    </td>
                    <td className="py-3 px-4 text-gray-600 dark:text-gray-400">
                      {getMaterialName(lot.materialTypeId)}
                    </td>
                    <td className="py-3 px-4 text-gray-600 dark:text-gray-400">
                      {getSupplierName(lot.supplierId)}
                    </td>
                    <td className="py-3 px-4 text-gray-600 dark:text-gray-400">
                      {formatDate(lot.createdAt)}
                    </td>
                    <td className="py-3 px-4">
                      <DecisionBadge decision={lot.decision} />
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        ) : (
          <div className="text-center py-12">
            <Package className="w-16 h-16 mx-auto text-gray-300 dark:text-gray-600 mb-4" />
            <h3 className="text-lg font-medium text-gray-900 dark:text-white mb-2">
              Henüz kontrol yapılmadı
            </h3>
            <p className="text-gray-500 dark:text-gray-400 mb-4">
              İlk partinizi girerek kalite kontrole başlayın
            </p>
            <Button onClick={() => navigate('/lot-entry')}>
              <Plus className="w-4 h-4 mr-2" />
              Yeni Parti Girişi
            </Button>
          </div>
        )}
      </Card>
    </div>
  );
}


========================================
DOSYA: ./pages/Inspection.tsx
========================================
import { useState, useEffect } from 'react';
import { useNavigate, useLocation } from 'react-router-dom';
import {
  CheckCircle,
  XCircle,
  Camera,
  Pause,
  RotateCcw,
  ChevronRight,
  Package,
  Layers
} from 'lucide-react';
import Card, { CardHeader } from '../components/common/Card';
import Button from '../components/common/Button';
import { TextArea } from '../components/common/Input';
import Modal from '../components/common/Modal';
import { SeverityBadge } from '../components/common/Badge';
import {
  useLotStore,
  useInspectionStore,
  useMaterialStore,
  useSupplierStore
} from '../store/useStore';
import { useSwitchingStore } from '../store/switchingStore';
import { makeDecision } from '../data/samplingData';
import { SWITCHING_LEVEL_LABELS } from '../types/switching';
import SwitchingBadge from '../components/switching/SwitchingBadge';
import StopProductionModal from '../components/switching/StopProductionModal';
import toast from 'react-hot-toast';

interface DefectSelection {
  defectTypeId: string;
  description: string;
}

export default function Inspection() {
  const navigate = useNavigate();
  const location = useLocation();
  const lotId = location.state?.lotId;

  const { lots, currentLot, setCurrentLot, updateLot, completeLot, getLotById, updateCurrentSampleIndex } = useLotStore();
  const { addInspection, clearCurrentInspections } = useInspectionStore();
  const materials = useMaterialStore((state) => state.materials);
  const suppliers = useSupplierStore((state) => state.suppliers);
  const updateSwitchingState = useSwitchingStore((state) => state.updateState);

  const [currentSampleNumber, setCurrentSampleNumber] = useState(1);
  const [defectCount, setDefectCount] = useState(0);
  const [showDefectModal, setShowDefectModal] = useState(false);
  const [selectedDefects, setSelectedDefects] = useState<DefectSelection[]>([]);
  const [notes, setNotes] = useState('');
  const [photoBase64, setPhotoBase64] = useState<string | null>(null);
  const [isPaused, setIsPaused] = useState(false);
  const [showResultModal, setShowResultModal] = useState(false);
  const [finalDecision, setFinalDecision] = useState<'accepted' | 'rejected' | null>(null);
  const [showStopModal, setShowStopModal] = useState(false);

  // Initialize lot
  useEffect(() => {
    if (lotId) {
      const lot = getLotById(lotId);
      if (lot) {
        setCurrentLot(lot);
        if (lot.status === 'pending') {
          updateLot(lot.id, { status: 'in-progress' });
        }
        clearCurrentInspections();
      }
    }
  }, [lotId]);

  // Get material info
  const material = currentLot
    ? materials.find((m) => m.id === currentLot.materialTypeId)
    : null;

  const supplier = currentLot
    ? suppliers.find((s) => s.id === currentLot.supplierId)
    : null;

  // Calculate progress and status
  const progress = currentLot
    ? (currentSampleNumber - 1) / currentLot.sampleSize * 100
    : 0;

  const remainingToAccept = currentLot
    ? currentLot.acceptanceNumber - defectCount
    : 0;

  const currentDecision = currentLot
    ? makeDecision(defectCount, currentLot.acceptanceNumber, currentLot.rejectionNumber)
    : 'continue';

  // Handle conforming sample
  const handleConforming = () => {
    if (!currentLot) return;

    addInspection({
      lotId: currentLot.id,
      sampleNumber: currentSampleNumber,
      isDefective: false,
      defects: [],
      notes: '',
      photoBase64: null,
    });

    if (currentSampleNumber >= currentLot.sampleSize) {
      finishInspection();
    } else {
      const nextIndex = currentSampleNumber;
      setCurrentSampleNumber((prev) => prev + 1);
      // Store'da güncel indeksi kaydet
      updateCurrentSampleIndex(currentLot.id, nextIndex);
    }
  };

  // Handle defective sample
  const handleDefective = () => {
    setShowDefectModal(true);
  };

  const confirmDefect = () => {
    if (!currentLot) return;

    const newDefectCount = defectCount + 1;
    setDefectCount(newDefectCount);

    addInspection({
      lotId: currentLot.id,
      sampleNumber: currentSampleNumber,
      isDefective: true,
      defects: selectedDefects.map((d) => ({
        criterionId: '',
        defectTypeId: d.defectTypeId,
        description: d.description,
      })),
      notes,
      photoBase64,
    });

    // Check if rejection threshold reached
    if (newDefectCount >= currentLot.rejectionNumber) {
      setFinalDecision('rejected');
      setShowResultModal(true);
    } else if (currentSampleNumber >= currentLot.sampleSize) {
      finishInspection();
    } else {
      const nextIndex = currentSampleNumber;
      setCurrentSampleNumber((prev) => prev + 1);
      // Store'da güncel indeksi kaydet
      updateCurrentSampleIndex(currentLot.id, nextIndex);
    }

    // Reset modal state
    setShowDefectModal(false);
    setSelectedDefects([]);
    setNotes('');
    setPhotoBase64(null);
  };

  const finishInspection = () => {
    if (!currentLot) return;

    const decision: 'accepted' | 'rejected' =
      defectCount <= currentLot.acceptanceNumber ? 'accepted' : 'rejected';

    setFinalDecision(decision);
    setShowResultModal(true);
  };

  const completeInspection = () => {
    if (!currentLot || !finalDecision) return;

    completeLot(currentLot.id, finalDecision, defectCount);

    // Switching kurallarını güncelle
    const { transition, shouldStop } = updateSwitchingState(
      currentLot.supplierId,
      currentLot.materialTypeId,
      finalDecision,
      currentLot.id,
      currentLot.lotNumber
    );

    // Seviye değişimi bildirimi
    if (transition) {
      const fromLabel = SWITCHING_LEVEL_LABELS[transition.fromLevel];
      const toLabel = SWITCHING_LEVEL_LABELS[transition.toLevel];
      toast(
        `Kontrol seviyesi değişti: ${fromLabel} → ${toLabel}`,
        {
          icon: transition.toLevel === 'tightened' ? '⚠️' : transition.toLevel === 'reduced' ? '✅' : 'ℹ️',
          duration: 5000,
        }
      );
    }

    toast.success(
      finalDecision === 'accepted'
        ? 'Parti kabul edildi!'
        : 'Parti reddedildi.'
    );

    // Üretim durdurma uyarısı
    if (shouldStop) {
      setShowStopModal(true);
    } else {
      navigate('/result', {
        state: {
          lotId: currentLot.id,
          decision: finalDecision,
          defectCount,
          sampleSize: currentLot.sampleSize,
        },
      });
    }
  };

  const handleStopModalClose = () => {
    setShowStopModal(false);
    navigate('/result', {
      state: {
        lotId: currentLot?.id,
        decision: finalDecision,
        defectCount,
        sampleSize: currentLot?.sampleSize,
      },
    });
  };

  const toggleDefectType = (defectTypeId: string) => {
    setSelectedDefects((prev) => {
      const exists = prev.find((d) => d.defectTypeId === defectTypeId);
      if (exists) {
        return prev.filter((d) => d.defectTypeId !== defectTypeId);
      }
      return [...prev, { defectTypeId, description: '' }];
    });
  };

  const handlePhotoCapture = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (file) {
      const reader = new FileReader();
      reader.onloadend = () => {
        setPhotoBase64(reader.result as string);
      };
      reader.readAsDataURL(file);
    }
  };

  // No lot selected
  if (!currentLot) {
    const pendingLots = lots.filter((l) => l.status !== 'completed');

    return (
      <div className="max-w-4xl mx-auto">
        <Card>
          <div className="text-center py-8">
            <Package className="w-16 h-16 mx-auto text-gray-300 dark:text-gray-600 mb-4" />
            <h2 className="text-xl font-semibold text-gray-900 dark:text-white mb-2">
              Kontrol Edilecek Parti Seçin
            </h2>
            <p className="text-gray-500 dark:text-gray-400 mb-6">
              Aşağıdaki bekleyen partilerden birini seçin veya yeni parti oluşturun
            </p>

            {pendingLots.length > 0 ? (
              <div className="space-y-3 max-w-md mx-auto">
                {pendingLots.map((lot) => (
                  <button
                    key={lot.id}
                    onClick={() => {
                      setCurrentLot(lot);
                      if (lot.status === 'pending') {
                        updateLot(lot.id, { status: 'in-progress' });
                      }
                      clearCurrentInspections();
                      setCurrentSampleNumber(1);
                      setDefectCount(0);
                    }}
                    className="w-full p-4 bg-gray-50 dark:bg-slate-700 rounded-xl hover:bg-gray-100 dark:hover:bg-slate-600 transition-colors text-left flex items-center justify-between"
                  >
                    <div>
                      <p className="font-medium text-gray-900 dark:text-white">
                        {lot.lotNumber}
                      </p>
                      <p className="text-sm text-gray-500 dark:text-gray-400">
                        {materials.find((m) => m.id === lot.materialTypeId)?.name} -{' '}
                        {lot.quantity.toLocaleString('tr-TR')} {materials.find((m) => m.id === lot.materialTypeId)?.unit || 'adet'}
                      </p>
                    </div>
                    <ChevronRight className="w-5 h-5 text-gray-400" />
                  </button>
                ))}
              </div>
            ) : (
              <Button onClick={() => navigate('/lot-entry')}>
                Yeni Parti Girişi
              </Button>
            )}
          </div>
        </Card>
      </div>
    );
  }

  return (
    <div className="max-w-4xl mx-auto space-y-6">
      {/* Lot Info Header */}
      <Card padding="sm">
        <div className="flex flex-wrap items-center justify-between gap-4">
          <div>
            <div className="flex items-center gap-3">
              <h2 className="text-lg font-bold text-gray-900 dark:text-white">
                {currentLot.lotNumber}
              </h2>
              {supplier && material && (
                <SwitchingBadge
                  supplierId={currentLot.supplierId}
                  materialTypeId={currentLot.materialTypeId}
                  supplierName={supplier.name}
                  materialName={material.name}
                  size="sm"
                />
              )}
            </div>
            <p className="text-sm text-gray-500 dark:text-gray-400">
              {supplier?.name} | {material?.name} | {currentLot.quantity.toLocaleString('tr-TR')} {material?.unit || 'adet'}
            </p>
          </div>
          <Button
            variant={isPaused ? 'primary' : 'secondary'}
            onClick={() => setIsPaused(!isPaused)}
          >
            {isPaused ? (
              <>
                <RotateCcw className="w-4 h-4 mr-2" />
                Devam Et
              </>
            ) : (
              <>
                <Pause className="w-4 h-4 mr-2" />
                Durdur
              </>
            )}
          </Button>
        </div>
      </Card>

      {/* Progress Bar */}
      <Card>
        <div className="space-y-2">
          <div className="flex justify-between text-sm">
            <span className="text-gray-600 dark:text-gray-400">İlerleme</span>
            <span className="font-medium text-gray-900 dark:text-white">
              {currentSampleNumber - 1}/{currentLot.sampleSize} {material?.unit || 'adet'} (%{progress.toFixed(1)})
            </span>
          </div>
          <div className="h-3 bg-gray-200 dark:bg-slate-700 rounded-full overflow-hidden">
            <div
              className="h-full bg-gradient-to-r from-blue-500 to-blue-600 rounded-full transition-all duration-500"
              style={{ width: `${progress}%` }}
            />
          </div>
        </div>
      </Card>

      {/* Status Cards */}
      <div className="grid grid-cols-2 gap-4">
        {/* Defect Counter */}
        <Card className="text-center">
          <p className="text-sm text-gray-500 dark:text-gray-400 mb-1">Hatalı</p>
          <p className="text-4xl font-bold text-gray-900 dark:text-white">
            {defectCount}
          </p>
          <div className="mt-2 h-2 bg-gray-200 dark:bg-slate-700 rounded-full overflow-hidden">
            <div
              className={`h-full rounded-full transition-all duration-300 ${
                currentDecision === 'rejected'
                  ? 'bg-red-500'
                  : defectCount > currentLot.acceptanceNumber * 0.7
                  ? 'bg-amber-500'
                  : 'bg-emerald-500'
              }`}
              style={{
                width: `${Math.min((defectCount / currentLot.rejectionNumber) * 100, 100)}%`,
              }}
            />
          </div>
        </Card>

        {/* Status Indicator */}
        <Card
          className={`text-center ${
            currentDecision === 'accepted'
              ? 'bg-emerald-50 dark:bg-emerald-900/20 border-emerald-200 dark:border-emerald-800'
              : currentDecision === 'rejected'
              ? 'bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800'
              : ''
          }`}
        >
          <p className="text-sm text-gray-500 dark:text-gray-400 mb-1">Durum</p>
          {currentDecision === 'rejected' ? (
            <>
              <p className="text-2xl font-bold text-red-600 dark:text-red-400">RED</p>
              <p className="text-xs text-red-500 mt-1">Limit aşıldı</p>
            </>
          ) : (
            <>
              <p className="text-2xl font-bold text-emerald-600 dark:text-emerald-400">
                {remainingToAccept}
              </p>
              <p className="text-xs text-gray-500 dark:text-gray-400 mt-1">
                Kabul için kalan hak
              </p>
            </>
          )}
        </Card>
      </div>

      {/* Sample Control */}
      {!isPaused && currentDecision !== 'rejected' && (
        <Card>
          {/* Position Code Display - Küme örneklemesi için */}
          {currentLot.samplePositions && currentLot.samplePositions.length > 0 && (
            <div className="mb-6">
              {(() => {
                const currentPosition = currentLot.samplePositions[currentSampleNumber - 1];
                if (!currentPosition) return null;

                // Bu poşetten kaç numune alınacağını hesapla
                // Aynı poşetten önceki numuneleri say (pozisyon listesinde sırayla)
                const allPositions = currentLot.samplePositions;
                let samplesInPackageTotal = 0;
                let currentIndexInPackage = 0;

                for (let i = 0; i < allPositions.length; i++) {
                  const pos = allPositions[i];
                  if (pos.pallet === currentPosition.pallet && pos.package === currentPosition.package) {
                    samplesInPackageTotal++;
                    if (i < currentSampleNumber - 1) {
                      // Bu pozisyon şu anki numuneden önce geliyorsa
                      currentIndexInPackage++;
                    } else if (i === currentSampleNumber - 1) {
                      // Bu tam şu anki numune
                      currentIndexInPackage++;
                    }
                  }
                }

                const samplesInPackage = { length: samplesInPackageTotal };

                // Sonraki pozisyon
                const nextPosition = currentLot.samplePositions[currentSampleNumber];
                const isNewPackageNext = nextPosition && (
                  nextPosition.pallet !== currentPosition.pallet ||
                  nextPosition.package !== currentPosition.package
                );

                return (
                  <div className="p-4 bg-gradient-to-r from-purple-50 to-indigo-50 dark:from-purple-900/20 dark:to-indigo-900/20 rounded-xl border border-purple-200 dark:border-purple-800">
                    <div className="flex items-center justify-between mb-4">
                      <span className="text-sm text-purple-600 dark:text-purple-400 font-medium">
                        Numune {currentSampleNumber} / {currentLot.sampleSize}
                      </span>
                      <span className="text-xs px-2 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded-full">
                        Poşetten: {currentIndexInPackage}/{samplesInPackage.length}
                      </span>
                    </div>

                    {/* Pozisyon Kodu */}
                    <div className="text-center py-4">
                      <div className="inline-flex items-center gap-2 px-6 py-3 bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-purple-100 dark:border-purple-700">
                        <Package className="w-6 h-6 text-purple-500" />
                        <span className="text-3xl font-mono font-bold text-gray-900 dark:text-white tracking-wider">
                          {currentPosition.code}
                        </span>
                      </div>

                      <div className="mt-3 flex items-center justify-center gap-4 text-sm text-gray-600 dark:text-gray-400">
                        <span>Palet {currentPosition.pallet}</span>
                        <span>•</span>
                        <span>Poşet {currentPosition.package}</span>
                      </div>
                    </div>

                    {/* Pozisyon Etiketi */}
                    <div className={`text-center py-3 rounded-lg mt-3 ${
                      currentPosition.position === '01'
                        ? 'bg-blue-100 dark:bg-blue-900/30'
                        : currentPosition.position === '02'
                        ? 'bg-amber-100 dark:bg-amber-900/30'
                        : 'bg-emerald-100 dark:bg-emerald-900/30'
                    }`}>
                      <Layers className={`w-5 h-5 mx-auto mb-1 ${
                        currentPosition.position === '01'
                          ? 'text-blue-600 dark:text-blue-400'
                          : currentPosition.position === '02'
                          ? 'text-amber-600 dark:text-amber-400'
                          : 'text-emerald-600 dark:text-emerald-400'
                      }`} />
                      <span className={`text-lg font-bold ${
                        currentPosition.position === '01'
                          ? 'text-blue-700 dark:text-blue-300'
                          : currentPosition.position === '02'
                          ? 'text-amber-700 dark:text-amber-300'
                          : 'text-emerald-700 dark:text-emerald-300'
                      }`}>
                        {currentPosition.positionLabel}
                      </span>
                      <p className="text-xs text-gray-500 dark:text-gray-400 mt-1">
                        {currentPosition.position === '01' && 'Yığının en üstünden alın'}
                        {currentPosition.position === '02' && 'Yığının ortasından alın'}
                        {currentPosition.position === '03' && 'Yığının en altından alın'}
                      </p>
                    </div>

                    {/* Sonraki pozisyon bilgisi */}
                    {nextPosition && (
                      <div className="mt-3 pt-3 border-t border-purple-200 dark:border-purple-700 text-center text-sm text-gray-500 dark:text-gray-400">
                        Sonraki: <span className="font-mono font-medium">{nextPosition.code}</span>
                        {isNewPackageNext && (
                          <span className="ml-2 text-purple-600 dark:text-purple-400">
                            (yeni poşet)
                          </span>
                        )}
                      </div>
                    )}
                  </div>
                );
              })()}
            </div>
          )}

          {!currentLot.samplePositions && (
            <CardHeader
              title={`Numune #${currentSampleNumber}`}
              subtitle="Kontrol sonucunu işaretleyin"
            />
          )}

          {/* Criteria Checklist */}
          {material && (
            <div className="mb-6">
              <p className="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
                Kontrol Kriterleri:
              </p>
              <div className="grid grid-cols-2 gap-2">
                {material.criteria.map((criterion) => (
                  <div
                    key={criterion.id}
                    className={`flex items-center gap-2 p-2 rounded-lg text-sm ${
                      criterion.isCritical
                        ? 'bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300'
                        : 'bg-gray-50 dark:bg-slate-700 text-gray-700 dark:text-gray-300'
                    }`}
                  >
                    <CheckCircle className="w-4 h-4 flex-shrink-0" />
                    <span>{criterion.name}</span>
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* Action Buttons */}
          <div className="grid grid-cols-2 gap-4">
            <button
              onClick={handleConforming}
              className="flex flex-col items-center justify-center p-6 bg-emerald-50 dark:bg-emerald-900/20 hover:bg-emerald-100 dark:hover:bg-emerald-900/30 border-2 border-emerald-200 dark:border-emerald-800 rounded-xl transition-all duration-200 group"
            >
              <CheckCircle className="w-12 h-12 text-emerald-500 mb-2 group-hover:scale-110 transition-transform" />
              <span className="text-lg font-semibold text-emerald-700 dark:text-emerald-400">
                UYGUN
              </span>
            </button>

            <button
              onClick={handleDefective}
              className="flex flex-col items-center justify-center p-6 bg-red-50 dark:bg-red-900/20 hover:bg-red-100 dark:hover:bg-red-900/30 border-2 border-red-200 dark:border-red-800 rounded-xl transition-all duration-200 group"
            >
              <XCircle className="w-12 h-12 text-red-500 mb-2 group-hover:scale-110 transition-transform" />
              <span className="text-lg font-semibold text-red-700 dark:text-red-400">
                HATALI
              </span>
            </button>
          </div>
        </Card>
      )}

      {/* Paused State */}
      {isPaused && (
        <Card className="text-center py-8">
          <Pause className="w-12 h-12 mx-auto text-amber-500 mb-4" />
          <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-2">
            Kontrol Duraklatıldı
          </h3>
          <p className="text-gray-500 dark:text-gray-400">
            Devam etmek için yukarıdaki butona tıklayın
          </p>
        </Card>
      )}

      {/* Defect Modal */}
      <Modal
        isOpen={showDefectModal}
        onClose={() => setShowDefectModal(false)}
        title="Hata Detayları"
        size="lg"
      >
        <div className="space-y-4">
          <div>
            <p className="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
              Hata Türü Seçin:
            </p>
            <div className="grid grid-cols-2 gap-2">
              {material?.defectTypes.map((defect) => (
                <button
                  key={defect.id}
                  onClick={() => toggleDefectType(defect.id)}
                  className={`p-3 rounded-lg border text-left transition-all ${
                    selectedDefects.find((d) => d.defectTypeId === defect.id)
                      ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20'
                      : 'border-gray-200 dark:border-slate-700 hover:border-gray-300'
                  }`}
                >
                  <div className="flex items-center justify-between mb-1">
                    <span className="font-medium text-gray-900 dark:text-white text-sm">
                      {defect.name}
                    </span>
                    <SeverityBadge severity={defect.severity} />
                  </div>
                  <p className="text-xs text-gray-500 dark:text-gray-400">
                    {defect.description}
                  </p>
                </button>
              ))}
            </div>
          </div>

          <TextArea
            label="Açıklama"
            value={notes}
            onChange={(e) => setNotes(e.target.value)}
            placeholder="Hata hakkında ek bilgi..."
            rows={2}
          />

          <div>
            <p className="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
              Fotoğraf Ekle
            </p>
            <label className="flex items-center justify-center w-full h-24 border-2 border-dashed border-gray-300 dark:border-slate-600 rounded-xl cursor-pointer hover:border-gray-400 transition-colors">
              {photoBase64 ? (
                <img
                  src={photoBase64}
                  alt="Captured"
                  className="h-full object-contain rounded-lg"
                />
              ) : (
                <div className="flex flex-col items-center text-gray-500">
                  <Camera className="w-8 h-8 mb-1" />
                  <span className="text-sm">Fotoğraf Çek/Seç</span>
                </div>
              )}
              <input
                type="file"
                accept="image/*"
                capture="environment"
                onChange={handlePhotoCapture}
                className="hidden"
              />
            </label>
          </div>

          <div className="flex justify-end gap-3 pt-4">
            <Button variant="secondary" onClick={() => setShowDefectModal(false)}>
              İptal
            </Button>
            <Button
              variant="danger"
              onClick={confirmDefect}
              disabled={selectedDefects.length === 0}
            >
              <XCircle className="w-4 h-4 mr-2" />
              Hatalı Olarak İşaretle
            </Button>
          </div>
        </div>
      </Modal>

      {/* Result Modal */}
      <Modal
        isOpen={showResultModal}
        onClose={() => {}}
        title="Kontrol Tamamlandı"
        size="md"
        showCloseButton={false}
      >
        <div className="text-center py-4">
          {finalDecision === 'accepted' ? (
            <>
              <div className="w-20 h-20 mx-auto mb-4 bg-emerald-100 dark:bg-emerald-900/30 rounded-full flex items-center justify-center">
                <CheckCircle className="w-12 h-12 text-emerald-500" />
              </div>
              <h3 className="text-2xl font-bold text-emerald-600 dark:text-emerald-400 mb-2">
                PARTİ KABUL
              </h3>
              <p className="text-gray-500 dark:text-gray-400">
                {defectCount} hatalı ≤ {currentLot.acceptanceNumber} kabul limiti
              </p>
            </>
          ) : (
            <>
              <div className="w-20 h-20 mx-auto mb-4 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center">
                <XCircle className="w-12 h-12 text-red-500" />
              </div>
              <h3 className="text-2xl font-bold text-red-600 dark:text-red-400 mb-2">
                PARTİ RED
              </h3>
              <p className="text-gray-500 dark:text-gray-400">
                {defectCount} hatalı ≥ {currentLot.rejectionNumber} red limiti
              </p>
            </>
          )}

          <div className="mt-6 p-4 bg-gray-50 dark:bg-slate-700 rounded-xl">
            <div className="grid grid-cols-3 gap-4 text-center">
              <div>
                <p className="text-2xl font-bold text-gray-900 dark:text-white">
                  {currentSampleNumber - 1}
                </p>
                <p className="text-xs text-gray-500 dark:text-gray-400">Kontrol Edilen</p>
              </div>
              <div>
                <p className="text-2xl font-bold text-emerald-600 dark:text-emerald-400">
                  {currentSampleNumber - 1 - defectCount}
                </p>
                <p className="text-xs text-gray-500 dark:text-gray-400">Uygun</p>
              </div>
              <div>
                <p className="text-2xl font-bold text-red-600 dark:text-red-400">
                  {defectCount}
                </p>
                <p className="text-xs text-gray-500 dark:text-gray-400">Hatalı</p>
              </div>
            </div>
          </div>

          <div className="mt-6">
            <Button onClick={completeInspection} fullWidth size="lg">
              Sonuç Ekranına Git
            </Button>
          </div>
        </div>
      </Modal>

      {/* Stop Production Modal - 5 ardışık RED */}
      {currentLot && supplier && material && (
        <StopProductionModal
          isOpen={showStopModal}
          onClose={handleStopModalClose}
          supplierId={currentLot.supplierId}
          supplierName={supplier.name}
          materialTypeId={currentLot.materialTypeId}
          materialName={material.name}
        />
      )}
    </div>
  );
}


========================================
DOSYA: ./pages/LotEntry.tsx
========================================
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import {
  Calculator,
  Info,
  ArrowRight,
  Plus,
  Building2,
  Package,
  Layers
} from 'lucide-react';
import Card, { CardHeader } from '../components/common/Card';
import Button from '../components/common/Button';
import Input, { Select, TextArea } from '../components/common/Input';
import Modal from '../components/common/Modal';
import SwitchingBadge from '../components/switching/SwitchingBadge';
import {
  useLotStore,
  useSupplierStore,
  useMaterialStore,
  useSettingsStore
} from '../store/useStore';
import { useSwitchingStore } from '../store/switchingStore';
import {
  calculateSampling,
  aqlOptions,
  inspectionLevels,
} from '../data/samplingData';
import { getAdjustedSampleSize, getAdjustedAcceptance } from '../utils/switchingLogic';
import {
  generateSamplePositions,
  calculateSamplingStats,
} from '../utils/clusterSampling';
import type { PackageConfig } from '../utils/clusterSampling';
import { SWITCHING_LEVEL_LABELS } from '../types/switching';
import toast from 'react-hot-toast';

export default function LotEntry() {
  const navigate = useNavigate();
  const addLot = useLotStore((state) => state.addLot);
  const suppliers = useSupplierStore((state) => state.suppliers);
  const addSupplier = useSupplierStore((state) => state.addSupplier);
  const materials = useMaterialStore((state) => state.materials);
  const { settings } = useSettingsStore();
  const getSwitchingState = useSwitchingStore((state) => state.getState);

  const [formData, setFormData] = useState({
    supplierId: '',
    materialTypeId: '',
    quantity: '',
    orderNumber: '',
    receivedDate: new Date().toISOString().split('T')[0],
    aql: settings.defaultAQL,
    inspectionLevel: settings.defaultInspectionLevel,
    inspectedBy: '',
    notes: '',
  });

  // Parti yapısı konfigürasyonu (Küme örneklemesi için)
  const [packageConfig, setPackageConfig] = useState<PackageConfig>({
    palletCount: 0,
    packagesPerPallet: 0,
    itemsPerPackage: 0,
  });

  // Örnekleme istatistikleri
  const [samplingStats, setSamplingStats] = useState<{
    totalPackages: number;
    totalItems: number;
    samplesPerPackage: number;
    packagesToOpen: number;
  } | null>(null);

  const [samplingResult, setSamplingResult] = useState<{
    sampleCode: string;
    sampleSize: number;
    acceptanceNumber: number;
    rejectionNumber: number;
  } | null>(null);

  const [showSupplierModal, setShowSupplierModal] = useState(false);
  const [newSupplier, setNewSupplier] = useState({
    name: '',
    code: '',
    contactPerson: '',
    phone: '',
    email: '',
    address: '',
  });

  const selectedMaterial = materials.find(m => m.id === formData.materialTypeId);
  const selectedSupplier = suppliers.find(s => s.id === formData.supplierId);

  // Switching state for selected supplier + material
  const switchingState = formData.supplierId && formData.materialTypeId
    ? getSwitchingState(formData.supplierId, formData.materialTypeId)
    : null;

  // Calculate sampling when quantity or AQL changes
  useEffect(() => {
    const quantity = parseInt(formData.quantity);
    if (quantity > 0) {
      const baseResult = calculateSampling(quantity, formData.aql, formData.inspectionLevel);

      if (baseResult && switchingState) {
        // Switching seviyesine göre ayarla
        const adjustedSampleSize = getAdjustedSampleSize(baseResult.sampleSize, switchingState.currentLevel);
        const adjustedAcceptance = getAdjustedAcceptance(
          baseResult.acceptanceNumber,
          baseResult.rejectionNumber,
          switchingState.currentLevel
        );

        setSamplingResult({
          ...baseResult,
          sampleSize: adjustedSampleSize,
          acceptanceNumber: adjustedAcceptance.acceptance,
          rejectionNumber: adjustedAcceptance.rejection,
        });
      } else {
        setSamplingResult(baseResult);
      }
    } else {
      setSamplingResult(null);
    }
  }, [formData.quantity, formData.aql, formData.inspectionLevel, switchingState]);

  // Parti yapısı değiştiğinde örnekleme istatistiklerini hesapla
  useEffect(() => {
    if (samplingResult && packageConfig.palletCount > 0 && packageConfig.packagesPerPallet > 0) {
      const stats = calculateSamplingStats(samplingResult.sampleSize, packageConfig);
      setSamplingStats(stats);
    } else {
      setSamplingStats(null);
    }
  }, [samplingResult, packageConfig]);

  const handleChange = (
    e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>
  ) => {
    setFormData({
      ...formData,
      [e.target.name]: e.target.value,
    });
  };

  const handlePackageConfigChange = (field: keyof PackageConfig, value: string) => {
    const numValue = parseInt(value) || 0;
    setPackageConfig({
      ...packageConfig,
      [field]: numValue,
    });
  };

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();

    if (!formData.supplierId || !formData.materialTypeId || !formData.quantity) {
      toast.error('Lütfen zorunlu alanları doldurun');
      return;
    }

    if (!samplingResult) {
      toast.error('Geçerli bir parti miktarı girin');
      return;
    }

    // Parti yapısı girilmişse numune pozisyonlarını oluştur
    let samplePositions = undefined;
    let lotPackageConfig = undefined;

    if (packageConfig.palletCount > 0 && packageConfig.packagesPerPallet > 0) {
      samplePositions = generateSamplePositions(samplingResult.sampleSize, packageConfig);
      lotPackageConfig = { ...packageConfig };
    }

    const lot = addLot({
      supplierId: formData.supplierId,
      materialTypeId: formData.materialTypeId,
      quantity: parseInt(formData.quantity),
      sampleSize: samplingResult.sampleSize,
      sampleCode: samplingResult.sampleCode,
      aql: formData.aql,
      inspectionLevel: formData.inspectionLevel as 'I' | 'II' | 'III',
      acceptanceNumber: samplingResult.acceptanceNumber,
      rejectionNumber: samplingResult.rejectionNumber,
      orderNumber: formData.orderNumber,
      receivedDate: formData.receivedDate,
      inspectionDate: '',
      inspectedBy: formData.inspectedBy,
      notes: formData.notes,
      packageConfig: lotPackageConfig,
      samplePositions: samplePositions,
      currentSampleIndex: 0,
    });

    toast.success('Parti başarıyla oluşturuldu');
    navigate('/inspection', { state: { lotId: lot.id } });
  };

  const handleAddSupplier = () => {
    if (!newSupplier.name || !newSupplier.code) {
      toast.error('Tedarikçi adı ve kodu zorunludur');
      return;
    }

    addSupplier({
      ...newSupplier,
      isActive: true,
    });

    toast.success('Tedarikçi eklendi');
    setShowSupplierModal(false);
    setNewSupplier({
      name: '',
      code: '',
      contactPerson: '',
      phone: '',
      email: '',
      address: '',
    });
  };

  return (
    <div className="max-w-4xl mx-auto space-y-6">
      <form onSubmit={handleSubmit}>
        {/* General Information */}
        <Card className="mb-6">
          <CardHeader
            title="Genel Bilgiler"
            subtitle="Parti ve tedarikçi bilgilerini girin"
          />

          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div className="space-y-1">
              <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">
                Tedarikçi <span className="text-red-500">*</span>
              </label>
              <div className="flex gap-2">
                <select
                  name="supplierId"
                  value={formData.supplierId}
                  onChange={handleChange}
                  className="flex-1 px-4 py-2.5 border border-gray-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all"
                  required
                >
                  <option value="">Tedarikçi Seçin</option>
                  {suppliers.filter(s => s.isActive).map((supplier) => (
                    <option key={supplier.id} value={supplier.id}>
                      {supplier.name}
                    </option>
                  ))}
                </select>
                <Button
                  type="button"
                  variant="secondary"
                  onClick={() => setShowSupplierModal(true)}
                >
                  <Plus className="w-4 h-4" />
                </Button>
              </div>
            </div>

            <Select
              label="Malzeme Türü"
              name="materialTypeId"
              value={formData.materialTypeId}
              onChange={handleChange}
              options={materials.map((m) => ({ value: m.id, label: m.name }))}
              placeholder="Malzeme Seçin"
              required
            />

            <Input
              label={`Parti Miktarı (${selectedMaterial?.unit ? selectedMaterial.unit.charAt(0).toUpperCase() + selectedMaterial.unit.slice(1) : 'Adet'})`}
              type="number"
              name="quantity"
              value={formData.quantity}
              onChange={handleChange}
              placeholder={selectedMaterial?.unit === 'bobin' ? 'Örn: 500' : 'Örn: 10000'}
              min="2"
              required
            />

            <Input
              label="Sipariş / İrsaliye No"
              name="orderNumber"
              value={formData.orderNumber}
              onChange={handleChange}
              placeholder="Örn: SIP-2024-123"
            />

            <Input
              label="Teslim Tarihi"
              type="date"
              name="receivedDate"
              value={formData.receivedDate}
              onChange={handleChange}
              required
            />

            <Input
              label="Kontrolü Yapan"
              name="inspectedBy"
              value={formData.inspectedBy}
              onChange={handleChange}
              placeholder="Ad Soyad"
            />
          </div>

          {/* Switching Badge - Tedarikçi ve malzeme seçiliyse göster */}
          {switchingState && selectedSupplier && selectedMaterial && (
            <div className="mt-4 p-4 bg-gray-50 dark:bg-slate-800/50 rounded-xl border border-gray-200 dark:border-slate-700">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-sm text-gray-500 dark:text-gray-400">Kontrol Seviyesi</p>
                  <p className="text-xs text-gray-400 dark:text-gray-500 mt-1">
                    {selectedSupplier.name} - {selectedMaterial.name}
                  </p>
                </div>
                <SwitchingBadge
                  supplierId={formData.supplierId}
                  materialTypeId={formData.materialTypeId}
                  supplierName={selectedSupplier.name}
                  materialName={selectedMaterial.name}
                />
              </div>
            </div>
          )}
        </Card>

        {/* Sampling Parameters */}
        <Card className="mb-6">
          <CardHeader
            title="Örnekleme Parametreleri"
            subtitle="ISO 2859-1 standardına göre"
          />

          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <Select
              label="AQL Değeri"
              name="aql"
              value={formData.aql}
              onChange={handleChange}
              options={aqlOptions}
            />

            <Select
              label="Muayene Seviyesi"
              name="inspectionLevel"
              value={formData.inspectionLevel}
              onChange={handleChange}
              options={inspectionLevels}
            />
          </div>

          {/* Calculated Values */}
          {samplingResult && (
            <div className="mt-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl border border-blue-100 dark:border-blue-800">
              <div className="flex items-start gap-3">
                <Calculator className="w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5" />
                <div className="flex-1">
                  <div className="flex items-center justify-between mb-3">
                    <h4 className="font-semibold text-blue-900 dark:text-blue-100">
                      Hesaplanan Değerler
                    </h4>
                    {switchingState && switchingState.currentLevel !== 'normal' && (
                      <span className={`text-xs px-2 py-1 rounded-full ${
                        switchingState.currentLevel === 'tightened'
                          ? 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300'
                          : 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300'
                      }`}>
                        {SWITCHING_LEVEL_LABELS[switchingState.currentLevel]} muayene
                      </span>
                    )}
                  </div>
                  <div className="grid grid-cols-3 gap-4">
                    <div className="text-center p-3 bg-white dark:bg-slate-800 rounded-lg shadow-sm">
                      <p className="text-2xl font-bold text-gray-900 dark:text-white">
                        {samplingResult.sampleSize}
                      </p>
                      <p className="text-sm text-gray-500 dark:text-gray-400">
                        Örneklem
                      </p>
                    </div>
                    <div className="text-center p-3 bg-emerald-50 dark:bg-emerald-900/20 rounded-lg">
                      <p className="text-2xl font-bold text-emerald-600 dark:text-emerald-400">
                        {samplingResult.acceptanceNumber}
                      </p>
                      <p className="text-sm text-gray-500 dark:text-gray-400">
                        Kabul (Ac)
                      </p>
                    </div>
                    <div className="text-center p-3 bg-red-50 dark:bg-red-900/20 rounded-lg">
                      <p className="text-2xl font-bold text-red-600 dark:text-red-400">
                        {samplingResult.rejectionNumber}
                      </p>
                      <p className="text-sm text-gray-500 dark:text-gray-400">
                        Red (Re)
                      </p>
                    </div>
                  </div>
                  <div className="mt-4 flex items-start gap-2 text-sm text-blue-700 dark:text-blue-300">
                    <Info className="w-4 h-4 mt-0.5 flex-shrink-0" />
                    <p>
                      {parseInt(formData.quantity).toLocaleString('tr-TR')} {selectedMaterial?.unit || 'adet'}lik partiden{' '}
                      <strong>{samplingResult.sampleSize}</strong> {selectedMaterial?.unit || 'adet'} rastgele numune alınacak.{' '}
                      <strong>{samplingResult.acceptanceNumber}</strong> veya daha az hatalı çıkarsa
                      parti kabul edilecek.
                    </p>
                  </div>
                </div>
              </div>
            </div>
          )}

          {!samplingResult && formData.quantity && parseInt(formData.quantity) > 0 && (
            <div className="mt-6 p-4 bg-amber-50 dark:bg-amber-900/20 rounded-xl border border-amber-200 dark:border-amber-800">
              <div className="flex items-center gap-2 text-amber-700 dark:text-amber-300">
                <Info className="w-5 h-5" />
                <p>Bu parti büyüklüğü ve AQL kombinasyonu için örnekleme planı bulunamadı.</p>
              </div>
            </div>
          )}
        </Card>

        {/* Parti Yapısı - Küme Örneklemesi */}
        {samplingResult && (
          <Card className="mb-6">
            <CardHeader
              title="Parti Yapısı (İsteğe Bağlı)"
              subtitle="Küme örneklemesi için palet ve poşet bilgilerini girin"
            />

            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                  <Package className="w-4 h-4 inline mr-1" />
                  Palet Sayısı (P)
                </label>
                <input
                  type="number"
                  min="0"
                  value={packageConfig.palletCount || ''}
                  onChange={(e) => handlePackageConfigChange('palletCount', e.target.value)}
                  className="w-full px-4 py-2.5 border border-gray-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all"
                  placeholder="Örn: 4"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                  <Layers className="w-4 h-4 inline mr-1" />
                  Poşet/Palet (B)
                </label>
                <input
                  type="number"
                  min="0"
                  value={packageConfig.packagesPerPallet || ''}
                  onChange={(e) => handlePackageConfigChange('packagesPerPallet', e.target.value)}
                  className="w-full px-4 py-2.5 border border-gray-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all"
                  placeholder="Örn: 16"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                  Etiket/Poşet (L)
                </label>
                <input
                  type="number"
                  min="0"
                  value={packageConfig.itemsPerPackage || ''}
                  onChange={(e) => handlePackageConfigChange('itemsPerPackage', e.target.value)}
                  className="w-full px-4 py-2.5 border border-gray-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all"
                  placeholder="Örn: 250"
                />
              </div>
            </div>

            {/* Örnekleme İstatistikleri */}
            {samplingStats && (
              <div className="mt-6 p-4 bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-xl border border-purple-100 dark:border-purple-800">
                <div className="flex items-start gap-3">
                  <Package className="w-5 h-5 text-purple-600 dark:text-purple-400 mt-0.5" />
                  <div className="flex-1">
                    <h4 className="font-semibold text-purple-900 dark:text-purple-100 mb-3">
                      Küme Örnekleme Planı
                    </h4>
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                      <div className="text-center p-3 bg-white dark:bg-slate-800 rounded-lg shadow-sm">
                        <p className="text-xl font-bold text-gray-900 dark:text-white">
                          {samplingStats.totalPackages}
                        </p>
                        <p className="text-xs text-gray-500 dark:text-gray-400">
                          Toplam Poşet
                        </p>
                      </div>
                      <div className="text-center p-3 bg-white dark:bg-slate-800 rounded-lg shadow-sm">
                        <p className="text-xl font-bold text-gray-900 dark:text-white">
                          {samplingStats.totalItems.toLocaleString('tr-TR')}
                        </p>
                        <p className="text-xs text-gray-500 dark:text-gray-400">
                          Toplam Etiket
                        </p>
                      </div>
                      <div className="text-center p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                        <p className="text-xl font-bold text-purple-600 dark:text-purple-400">
                          {samplingStats.packagesToOpen}
                        </p>
                        <p className="text-xs text-gray-500 dark:text-gray-400">
                          Açılacak Poşet
                        </p>
                      </div>
                      <div className="text-center p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                        <p className="text-xl font-bold text-purple-600 dark:text-purple-400">
                          ~{samplingStats.samplesPerPackage}
                        </p>
                        <p className="text-xs text-gray-500 dark:text-gray-400">
                          Poşet Başı Etiket
                        </p>
                      </div>
                    </div>
                    <div className="mt-4 flex items-start gap-2 text-sm text-purple-700 dark:text-purple-300">
                      <Info className="w-4 h-4 mt-0.5 flex-shrink-0" />
                      <p>
                        <strong>{samplingStats.packagesToOpen}</strong> rastgele poşet açılacak ve her poşetten{' '}
                        <strong>~{samplingStats.samplesPerPackage}</strong> etiket kontrol edilecek.
                        Pozisyon kodları: <span className="font-mono">PP-BB-NN</span>{' '}
                        (01=Üst, 02=Orta, 03=Alt)
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            )}
          </Card>
        )}

        {/* Material Criteria Preview */}
        {selectedMaterial && (
          <Card className="mb-6">
            <CardHeader
              title="Kontrol Kriterleri"
              subtitle={`${selectedMaterial.name} için kontrol edilecek özellikler`}
            />
            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
              {selectedMaterial.criteria.map((criterion) => (
                <div
                  key={criterion.id}
                  className={`p-3 rounded-lg border ${
                    criterion.isCritical
                      ? 'border-red-200 bg-red-50 dark:border-red-800 dark:bg-red-900/20'
                      : 'border-gray-200 bg-gray-50 dark:border-slate-700 dark:bg-slate-800'
                  }`}
                >
                  <div className="flex items-center gap-2">
                    <span className="font-medium text-gray-900 dark:text-white">
                      {criterion.name}
                    </span>
                    {criterion.isCritical && (
                      <span className="text-xs px-2 py-0.5 bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300 rounded-full">
                        Kritik
                      </span>
                    )}
                  </div>
                  <p className="text-sm text-gray-500 dark:text-gray-400 mt-1">
                    {criterion.acceptanceCriteria}
                  </p>
                </div>
              ))}
            </div>
          </Card>
        )}

        {/* Notes */}
        <Card className="mb-6">
          <TextArea
            label="Notlar"
            name="notes"
            value={formData.notes}
            onChange={handleChange}
            placeholder="Ek notlar..."
            rows={3}
          />
        </Card>

        {/* Submit Button */}
        <div className="flex justify-end">
          <Button
            type="submit"
            size="lg"
            disabled={!samplingResult}
            icon={<ArrowRight className="w-5 h-5" />}
          >
            Kontrole Başla
          </Button>
        </div>
      </form>

      {/* Add Supplier Modal */}
      <Modal
        isOpen={showSupplierModal}
        onClose={() => setShowSupplierModal(false)}
        title="Yeni Tedarikçi Ekle"
        size="md"
      >
        <div className="space-y-4">
          <div className="grid grid-cols-2 gap-4">
            <Input
              label="Tedarikçi Adı"
              value={newSupplier.name}
              onChange={(e) => setNewSupplier({ ...newSupplier, name: e.target.value })}
              placeholder="Örn: ABC Ltd. Şti."
              required
            />
            <Input
              label="Kısa Kod"
              value={newSupplier.code}
              onChange={(e) => setNewSupplier({ ...newSupplier, code: e.target.value.toUpperCase() })}
              placeholder="Örn: ABC"
              required
            />
          </div>
          <Input
            label="Yetkili Kişi"
            value={newSupplier.contactPerson}
            onChange={(e) => setNewSupplier({ ...newSupplier, contactPerson: e.target.value })}
            placeholder="Ad Soyad"
          />
          <div className="grid grid-cols-2 gap-4">
            <Input
              label="Telefon"
              value={newSupplier.phone}
              onChange={(e) => setNewSupplier({ ...newSupplier, phone: e.target.value })}
              placeholder="0212 555 1234"
            />
            <Input
              label="E-posta"
              type="email"
              value={newSupplier.email}
              onChange={(e) => setNewSupplier({ ...newSupplier, email: e.target.value })}
              placeholder="info@firma.com"
            />
          </div>
          <Input
            label="Adres"
            value={newSupplier.address}
            onChange={(e) => setNewSupplier({ ...newSupplier, address: e.target.value })}
            placeholder="İstanbul, Türkiye"
          />

          <div className="flex justify-end gap-3 pt-4">
            <Button variant="secondary" onClick={() => setShowSupplierModal(false)}>
              İptal
            </Button>
            <Button onClick={handleAddSupplier}>
              <Building2 className="w-4 h-4 mr-2" />
              Tedarikçi Ekle
            </Button>
          </div>
        </div>
      </Modal>
    </div>
  );
}


========================================
DOSYA: ./pages/Reports.tsx
========================================
import { useState, useMemo } from 'react';
import { useNavigate } from 'react-router-dom';
import {
  Search,
  Download,
  FileText,
  Eye,
  Package
} from 'lucide-react';
import Card, { CardHeader } from '../components/common/Card';
import Button from '../components/common/Button';
import Input, { Select } from '../components/common/Input';
import { StatusBadge, DecisionBadge } from '../components/common/Badge';
import {
  useLotStore,
  useSupplierStore,
  useMaterialStore,
  useInspectionStore
} from '../store/useStore';
import { formatDate } from '../data/samplingData';
import { generatePDF, generateBulkPDF } from '../utils/pdf';
import toast from 'react-hot-toast';
import * as XLSX from 'xlsx';

export default function Reports() {
  const navigate = useNavigate();
  const lots = useLotStore((state) => state.lots);
  const suppliers = useSupplierStore((state) => state.suppliers);
  const materials = useMaterialStore((state) => state.materials);
  const inspections = useInspectionStore((state) => state.inspections);

  const [search, setSearch] = useState('');
  const [filterSupplier, setFilterSupplier] = useState('');
  const [filterMaterial, setFilterMaterial] = useState('');
  const [filterDecision, setFilterDecision] = useState('');
  const [filterDateFrom, setFilterDateFrom] = useState('');
  const [filterDateTo, setFilterDateTo] = useState('');

  // Filter lots
  const filteredLots = useMemo(() => {
    return lots.filter((lot) => {
      // Search filter
      if (search) {
        const searchLower = search.toLowerCase();
        const supplier = suppliers.find((s) => s.id === lot.supplierId);
        const material = materials.find((m) => m.id === lot.materialTypeId);
        const searchMatch =
          lot.lotNumber.toLowerCase().includes(searchLower) ||
          supplier?.name.toLowerCase().includes(searchLower) ||
          material?.name.toLowerCase().includes(searchLower) ||
          lot.orderNumber?.toLowerCase().includes(searchLower);
        if (!searchMatch) return false;
      }

      // Supplier filter
      if (filterSupplier && lot.supplierId !== filterSupplier) return false;

      // Material filter
      if (filterMaterial && lot.materialTypeId !== filterMaterial) return false;

      // Decision filter
      if (filterDecision) {
        if (filterDecision === 'pending' && lot.status === 'completed') return false;
        if (filterDecision === 'accepted' && lot.decision !== 'accepted') return false;
        if (filterDecision === 'rejected' && lot.decision !== 'rejected') return false;
      }

      // Date filter
      if (filterDateFrom) {
        const lotDate = new Date(lot.createdAt);
        const fromDate = new Date(filterDateFrom);
        if (lotDate < fromDate) return false;
      }
      if (filterDateTo) {
        const lotDate = new Date(lot.createdAt);
        const toDate = new Date(filterDateTo);
        toDate.setHours(23, 59, 59);
        if (lotDate > toDate) return false;
      }

      return true;
    });
  }, [lots, search, filterSupplier, filterMaterial, filterDecision, filterDateFrom, filterDateTo, suppliers, materials]);

  const getSupplierName = (id: string) =>
    suppliers.find((s) => s.id === id)?.name || '-';
  const getMaterialName = (id: string) =>
    materials.find((m) => m.id === id)?.name || '-';

  const handleExportExcel = () => {
    const data = filteredLots.map((lot) => ({
      'Parti No': lot.lotNumber,
      'Tedarikçi': getSupplierName(lot.supplierId),
      'Malzeme': getMaterialName(lot.materialTypeId),
      'Miktar': lot.quantity,
      'Örneklem': lot.sampleSize,
      'Hatalı': lot.defectCount,
      'AQL': lot.aql,
      'Sonuç': lot.decision === 'accepted' ? 'KABUL' : lot.decision === 'rejected' ? 'RED' : 'Bekliyor',
      'Sipariş No': lot.orderNumber,
      'Tarih': formatDate(lot.createdAt),
    }));

    const ws = XLSX.utils.json_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'Kontrol Raporu');
    XLSX.writeFile(wb, `Kalite_Kontrol_Raporu_${formatDate(new Date()).replace(/\//g, '-')}.xlsx`);
    toast.success('Excel raporu oluşturuldu');
  };

  const handleExportPDF = async () => {
    try {
      await generateBulkPDF(filteredLots, suppliers, materials);
      toast.success('PDF raporu oluşturuldu');
    } catch (error) {
      toast.error('PDF oluşturulamadı');
    }
  };

  const handleViewLot = (lotId: string) => {
    const lot = lots.find((l) => l.id === lotId);
    if (lot && lot.status === 'completed') {
      navigate('/result', {
        state: {
          lotId: lot.id,
          decision: lot.decision,
          defectCount: lot.defectCount,
          sampleSize: lot.sampleSize,
        },
      });
    }
  };

  const handleSinglePDF = async (lotId: string) => {
    const lot = lots.find((l) => l.id === lotId);
    if (!lot) return;

    const supplier = suppliers.find((s) => s.id === lot.supplierId);
    const material = materials.find((m) => m.id === lot.materialTypeId);
    const lotInspections = inspections.filter((i) => i.lotId === lotId);

    // Calculate defect distribution
    const defectDistribution: Record<string, number> = {};
    lotInspections.forEach((inspection) => {
      inspection.defects.forEach((defect) => {
        const defectType = material?.defectTypes.find(
          (d) => d.id === defect.defectTypeId
        );
        const name = defectType?.name || defect.defectTypeId;
        defectDistribution[name] = (defectDistribution[name] || 0) + 1;
      });
    });

    const chartData = Object.entries(defectDistribution)
      .map(([name, count]) => ({ name, count }))
      .sort((a, b) => b.count - a.count);

    try {
      await generatePDF({
        lot,
        supplier,
        material,
        inspections: lotInspections,
        defectDistribution: chartData,
      });
      toast.success('PDF raporu oluşturuldu');
    } catch (error) {
      toast.error('PDF oluşturulamadı');
    }
  };

  const clearFilters = () => {
    setSearch('');
    setFilterSupplier('');
    setFilterMaterial('');
    setFilterDecision('');
    setFilterDateFrom('');
    setFilterDateTo('');
  };

  return (
    <div className="space-y-6">
      {/* Filters */}
      <Card>
        <CardHeader
          title="Filtreler"
          action={
            <Button variant="ghost" size="sm" onClick={clearFilters}>
              Temizle
            </Button>
          }
        />
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          <div className="relative">
            <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400" />
            <input
              type="text"
              value={search}
              onChange={(e) => setSearch(e.target.value)}
              placeholder="Parti no, tedarikçi ara..."
              className="w-full pl-10 pr-4 py-2.5 border border-gray-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
            />
          </div>

          <Select
            value={filterSupplier}
            onChange={(e) => setFilterSupplier(e.target.value)}
            options={suppliers.map((s) => ({ value: s.id, label: s.name }))}
            placeholder="Tüm Tedarikçiler"
          />

          <Select
            value={filterMaterial}
            onChange={(e) => setFilterMaterial(e.target.value)}
            options={materials.map((m) => ({ value: m.id, label: m.name }))}
            placeholder="Tüm Malzemeler"
          />

          <Select
            value={filterDecision}
            onChange={(e) => setFilterDecision(e.target.value)}
            options={[
              { value: 'pending', label: 'Bekliyor' },
              { value: 'accepted', label: 'Kabul' },
              { value: 'rejected', label: 'Red' },
            ]}
            placeholder="Tüm Sonuçlar"
          />

          <Input
            type="date"
            value={filterDateFrom}
            onChange={(e) => setFilterDateFrom(e.target.value)}
            label="Başlangıç Tarihi"
          />

          <Input
            type="date"
            value={filterDateTo}
            onChange={(e) => setFilterDateTo(e.target.value)}
            label="Bitiş Tarihi"
          />
        </div>
      </Card>

      {/* Actions */}
      <div className="flex flex-wrap justify-between items-center gap-4">
        <p className="text-sm text-gray-500 dark:text-gray-400">
          {filteredLots.length} kayıt bulundu
        </p>
        <div className="flex gap-2">
          <Button variant="secondary" onClick={handleExportExcel}>
            <Download className="w-4 h-4 mr-2" />
            Excel
          </Button>
          <Button variant="secondary" onClick={handleExportPDF}>
            <FileText className="w-4 h-4 mr-2" />
            PDF
          </Button>
        </div>
      </div>

      {/* Table */}
      <Card padding="none">
        {filteredLots.length > 0 ? (
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead>
                <tr className="border-b border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800">
                  <th className="text-left py-3 px-4 text-sm font-semibold text-gray-600 dark:text-gray-400">
                    Parti No
                  </th>
                  <th className="text-left py-3 px-4 text-sm font-semibold text-gray-600 dark:text-gray-400">
                    Tedarikçi
                  </th>
                  <th className="text-left py-3 px-4 text-sm font-semibold text-gray-600 dark:text-gray-400">
                    Malzeme
                  </th>
                  <th className="text-right py-3 px-4 text-sm font-semibold text-gray-600 dark:text-gray-400">
                    Miktar
                  </th>
                  <th className="text-right py-3 px-4 text-sm font-semibold text-gray-600 dark:text-gray-400">
                    Hatalı
                  </th>
                  <th className="text-center py-3 px-4 text-sm font-semibold text-gray-600 dark:text-gray-400">
                    Durum
                  </th>
                  <th className="text-center py-3 px-4 text-sm font-semibold text-gray-600 dark:text-gray-400">
                    Sonuç
                  </th>
                  <th className="text-left py-3 px-4 text-sm font-semibold text-gray-600 dark:text-gray-400">
                    Tarih
                  </th>
                  <th className="text-center py-3 px-4 text-sm font-semibold text-gray-600 dark:text-gray-400">
                    İşlem
                  </th>
                </tr>
              </thead>
              <tbody>
                {filteredLots.map((lot) => (
                  <tr
                    key={lot.id}
                    className="border-b border-gray-100 dark:border-slate-700/50 hover:bg-gray-50 dark:hover:bg-slate-700/30 transition-colors"
                  >
                    <td className="py-3 px-4">
                      <span className="font-medium text-gray-900 dark:text-white">
                        {lot.lotNumber}
                      </span>
                    </td>
                    <td className="py-3 px-4 text-gray-600 dark:text-gray-400">
                      {getSupplierName(lot.supplierId)}
                    </td>
                    <td className="py-3 px-4 text-gray-600 dark:text-gray-400">
                      {getMaterialName(lot.materialTypeId)}
                    </td>
                    <td className="py-3 px-4 text-right text-gray-600 dark:text-gray-400">
                      {lot.quantity.toLocaleString('tr-TR')}
                    </td>
                    <td className="py-3 px-4 text-right">
                      <span className={lot.defectCount > 0 ? 'text-red-600 dark:text-red-400 font-medium' : 'text-gray-600 dark:text-gray-400'}>
                        {lot.defectCount}/{lot.sampleSize}
                      </span>
                    </td>
                    <td className="py-3 px-4 text-center">
                      <StatusBadge status={lot.status} />
                    </td>
                    <td className="py-3 px-4 text-center">
                      <DecisionBadge decision={lot.decision} />
                    </td>
                    <td className="py-3 px-4 text-gray-600 dark:text-gray-400">
                      {formatDate(lot.createdAt)}
                    </td>
                    <td className="py-3 px-4">
                      <div className="flex items-center justify-center gap-1">
                        {lot.status === 'completed' && (
                          <>
                            <button
                              onClick={() => handleViewLot(lot.id)}
                              className="p-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700 text-gray-500 hover:text-blue-600 transition-colors"
                              title="Görüntüle"
                            >
                              <Eye className="w-4 h-4" />
                            </button>
                            <button
                              onClick={() => handleSinglePDF(lot.id)}
                              className="p-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700 text-gray-500 hover:text-blue-600 transition-colors"
                              title="PDF"
                            >
                              <FileText className="w-4 h-4" />
                            </button>
                          </>
                        )}
                      </div>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        ) : (
          <div className="text-center py-12">
            <Package className="w-16 h-16 mx-auto text-gray-300 dark:text-gray-600 mb-4" />
            <h3 className="text-lg font-medium text-gray-900 dark:text-white mb-2">
              Kayıt bulunamadı
            </h3>
            <p className="text-gray-500 dark:text-gray-400">
              Filtreleri değiştirerek tekrar deneyin
            </p>
          </div>
        )}
      </Card>
    </div>
  );
}


========================================
DOSYA: ./pages/Result.tsx
========================================
import { useNavigate, useLocation } from 'react-router-dom';
import {
  CheckCircle,
  XCircle,
  FileText,
  Home,
  Plus,
  Printer
} from 'lucide-react';
import {
  BarChart,
  Bar,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  ResponsiveContainer,
  Cell
} from 'recharts';
import Card, { CardHeader } from '../components/common/Card';
import Button from '../components/common/Button';
import {
  useLotStore,
  useInspectionStore,
  useMaterialStore,
  useSupplierStore
} from '../store/useStore';
import { useSwitchingStore } from '../store/switchingStore';
import SwitchingBadge from '../components/switching/SwitchingBadge';
import { formatDate } from '../data/samplingData';
import { generatePDF } from '../utils/pdf';
import toast from 'react-hot-toast';

const COLORS = ['#EF4444', '#F59E0B', '#10B981', '#3B82F6', '#8B5CF6', '#EC4899'];

export default function Result() {
  const navigate = useNavigate();
  const location = useLocation();

  // Safely get state data
  const stateData = (location.state as {
    lotId?: string;
    decision?: 'accepted' | 'rejected';
    defectCount?: number;
    sampleSize?: number;
  }) || {};

  // Get stores
  const lots = useLotStore((state) => state.lots);
  const allInspections = useInspectionStore((state) => state.inspections);
  const materials = useMaterialStore((state) => state.materials);
  const suppliers = useSupplierStore((state) => state.suppliers);
  const getSwitchingState = useSwitchingStore((state) => state.getState);

  // Find the lot
  const lotId = stateData.lotId;
  const lot = lotId ? lots.find((l) => l.id === lotId) : undefined;

  // Filter inspections for this lot
  const inspections = lotId ? allInspections.filter((i) => i.lotId === lotId) : [];

  // Use state values or fallback to lot values
  const decision = stateData.decision || lot?.decision;
  const defectCount = stateData.defectCount ?? lot?.defectCount ?? 0;
  const sampleSize = stateData.sampleSize || lot?.sampleSize || 0;

  // Show not found message if no lot
  if (!lot) {
    return (
      <div className="max-w-4xl mx-auto">
        <Card className="text-center py-12">
          <p className="text-gray-500 dark:text-gray-400 mb-4">
            Kontrol sonucu bulunamadı
          </p>
          <p className="text-sm text-gray-400 dark:text-gray-500 mb-4">
            Lütfen bir parti kontrolü tamamladıktan sonra bu sayfayı ziyaret edin.
          </p>
          <Button onClick={() => navigate('/')} className="mt-4">
            <Home className="w-4 h-4 mr-2" />
            Ana Sayfaya Dön
          </Button>
        </Card>
      </div>
    );
  }

  const material = materials.find((m) => m.id === lot.materialTypeId);
  const supplier = suppliers.find((s) => s.id === lot.supplierId);
  const switchingState = getSwitchingState(lot.supplierId, lot.materialTypeId);

  // Calculate defect distribution
  const defectDistribution: Record<string, number> = {};
  inspections.forEach((inspection) => {
    inspection.defects.forEach((defect) => {
      const defectType = material?.defectTypes.find(
        (d) => d.id === defect.defectTypeId
      );
      const name = defectType?.name || defect.defectTypeId;
      defectDistribution[name] = (defectDistribution[name] || 0) + 1;
    });
  });

  const chartData = Object.entries(defectDistribution)
    .map(([name, count]) => ({ name, count }))
    .sort((a, b) => b.count - a.count);

  const handleGeneratePDF = async () => {
    try {
      await generatePDF({
        lot,
        supplier,
        material,
        inspections,
        defectDistribution: chartData,
        switchingLevel: switchingState.currentLevel,
      });
      toast.success('PDF raporu oluşturuldu');
    } catch (error) {
      toast.error('PDF oluşturulamadı');
    }
  };

  const handlePrint = () => {
    window.print();
  };

  const isAccepted = decision === 'accepted';

  return (
    <div className="max-w-4xl mx-auto space-y-6 print:space-y-4">
      {/* Decision Banner */}
      <Card
        padding="lg"
        className={`text-center ${
          isAccepted
            ? 'bg-gradient-to-r from-emerald-500 to-emerald-600'
            : 'bg-gradient-to-r from-red-500 to-red-600'
        } border-0`}
      >
        <div className="flex flex-col items-center">
          {isAccepted ? (
            <CheckCircle className="w-20 h-20 text-white mb-4" />
          ) : (
            <XCircle className="w-20 h-20 text-white mb-4" />
          )}
          <h1 className="text-3xl font-bold text-white mb-2">
            PARTİ {isAccepted ? 'KABUL EDİLDİ' : 'REDDEDİLDİ'}
          </h1>
          <p className="text-white/80">
            {defectCount} hatalı {isAccepted ? '≤' : '≥'}{' '}
            {isAccepted ? lot.acceptanceNumber : lot.rejectionNumber}{' '}
            {isAccepted ? 'kabul' : 'red'} limiti
          </p>
        </div>
      </Card>

      {/* Summary Card */}
      <Card>
        <CardHeader title="Kontrol Özeti" />
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div className="p-4 bg-gray-50 dark:bg-slate-700 rounded-xl text-center">
            <p className="text-sm text-gray-500 dark:text-gray-400">Parti No</p>
            <p className="text-lg font-bold text-gray-900 dark:text-white mt-1">
              {lot.lotNumber}
            </p>
          </div>
          <div className="p-4 bg-gray-50 dark:bg-slate-700 rounded-xl text-center">
            <p className="text-sm text-gray-500 dark:text-gray-400">Örneklem</p>
            <p className="text-lg font-bold text-gray-900 dark:text-white mt-1">
              {sampleSize} {material?.unit || 'adet'}
            </p>
          </div>
          <div className="p-4 bg-emerald-50 dark:bg-emerald-900/20 rounded-xl text-center">
            <p className="text-sm text-gray-500 dark:text-gray-400">Uygun</p>
            <p className="text-lg font-bold text-emerald-600 dark:text-emerald-400 mt-1">
              {sampleSize - defectCount} {material?.unit || 'adet'}
            </p>
          </div>
          <div className="p-4 bg-red-50 dark:bg-red-900/20 rounded-xl text-center">
            <p className="text-sm text-gray-500 dark:text-gray-400">Hatalı</p>
            <p className="text-lg font-bold text-red-600 dark:text-red-400 mt-1">
              {defectCount} {material?.unit || 'adet'}
            </p>
          </div>
        </div>
      </Card>

      {/* Details */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        {/* Lot Details */}
        <Card>
          <CardHeader title="Parti Bilgileri" />
          <div className="space-y-3">
            <div className="flex justify-between py-2 border-b border-gray-100 dark:border-slate-700">
              <span className="text-gray-500 dark:text-gray-400">Tedarikçi</span>
              <span className="font-medium text-gray-900 dark:text-white">
                {supplier?.name || '-'}
              </span>
            </div>
            <div className="flex justify-between py-2 border-b border-gray-100 dark:border-slate-700">
              <span className="text-gray-500 dark:text-gray-400">Malzeme</span>
              <span className="font-medium text-gray-900 dark:text-white">
                {material?.name || '-'}
              </span>
            </div>
            <div className="flex justify-between py-2 border-b border-gray-100 dark:border-slate-700">
              <span className="text-gray-500 dark:text-gray-400">Parti Miktarı</span>
              <span className="font-medium text-gray-900 dark:text-white">
                {lot.quantity.toLocaleString('tr-TR')} {material?.unit || 'adet'}
              </span>
            </div>
            <div className="flex justify-between py-2 border-b border-gray-100 dark:border-slate-700">
              <span className="text-gray-500 dark:text-gray-400">Sipariş No</span>
              <span className="font-medium text-gray-900 dark:text-white">
                {lot.orderNumber || '-'}
              </span>
            </div>
            <div className="flex justify-between py-2">
              <span className="text-gray-500 dark:text-gray-400">Tarih</span>
              <span className="font-medium text-gray-900 dark:text-white">
                {formatDate(new Date())}
              </span>
            </div>
          </div>
        </Card>

        {/* Sampling Parameters */}
        <Card>
          <CardHeader title="Örnekleme Parametreleri" />
          <div className="space-y-3">
            <div className="flex justify-between py-2 border-b border-gray-100 dark:border-slate-700">
              <span className="text-gray-500 dark:text-gray-400">Standart</span>
              <span className="font-medium text-gray-900 dark:text-white">
                ISO 2859-1
              </span>
            </div>
            <div className="flex justify-between py-2 border-b border-gray-100 dark:border-slate-700">
              <span className="text-gray-500 dark:text-gray-400">Muayene Seviyesi</span>
              <span className="font-medium text-gray-900 dark:text-white">
                Seviye {lot.inspectionLevel}
              </span>
            </div>
            <div className="flex justify-between items-center py-2 border-b border-gray-100 dark:border-slate-700">
              <span className="text-gray-500 dark:text-gray-400">Kontrol Durumu</span>
              <SwitchingBadge
                supplierId={lot.supplierId}
                materialTypeId={lot.materialTypeId}
                supplierName={supplier?.name}
                materialName={material?.name}
                size="sm"
              />
            </div>
            <div className="flex justify-between py-2 border-b border-gray-100 dark:border-slate-700">
              <span className="text-gray-500 dark:text-gray-400">AQL</span>
              <span className="font-medium text-gray-900 dark:text-white">
                %{lot.aql}
              </span>
            </div>
            <div className="flex justify-between py-2 border-b border-gray-100 dark:border-slate-700">
              <span className="text-gray-500 dark:text-gray-400">Örneklem Kodu</span>
              <span className="font-medium text-gray-900 dark:text-white">
                {lot.sampleCode}
              </span>
            </div>
            <div className="flex justify-between py-2">
              <span className="text-gray-500 dark:text-gray-400">Ac / Re</span>
              <span className="font-medium text-gray-900 dark:text-white">
                {lot.acceptanceNumber} / {lot.rejectionNumber}
              </span>
            </div>
          </div>
        </Card>
      </div>

      {/* Defect Distribution Chart */}
      {chartData.length > 0 && defectCount > 0 && (
        <Card>
          <CardHeader
            title="Hata Dağılımı"
            subtitle="Tespit edilen hata türleri"
          />
          <div className="h-64">
            <ResponsiveContainer width="100%" height="100%">
              <BarChart data={chartData} layout="vertical">
                <CartesianGrid strokeDasharray="3 3" className="stroke-gray-200 dark:stroke-slate-700" />
                <XAxis type="number" />
                <YAxis type="category" dataKey="name" width={120} />
                <Tooltip
                  contentStyle={{
                    backgroundColor: 'var(--tooltip-bg, #fff)',
                    border: '1px solid var(--tooltip-border, #e5e7eb)',
                    borderRadius: '8px',
                  }}
                />
                <Bar dataKey="count" radius={[0, 4, 4, 0]}>
                  {chartData.map((_, index) => (
                    <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                  ))}
                </Bar>
              </BarChart>
            </ResponsiveContainer>
          </div>

          {/* Defect Table */}
          <div className="mt-4">
            <table className="w-full">
              <thead>
                <tr className="border-b border-gray-200 dark:border-slate-700">
                  <th className="text-left py-2 text-sm font-semibold text-gray-600 dark:text-gray-400">
                    Hata Türü
                  </th>
                  <th className="text-center py-2 text-sm font-semibold text-gray-600 dark:text-gray-400">
                    Adet
                  </th>
                  <th className="text-right py-2 text-sm font-semibold text-gray-600 dark:text-gray-400">
                    Oran
                  </th>
                </tr>
              </thead>
              <tbody>
                {chartData.map((item, index) => (
                  <tr
                    key={item.name}
                    className="border-b border-gray-100 dark:border-slate-700/50"
                  >
                    <td className="py-2 flex items-center gap-2">
                      <span
                        className="w-3 h-3 rounded-full"
                        style={{ backgroundColor: COLORS[index % COLORS.length] }}
                      />
                      <span className="text-gray-900 dark:text-white">{item.name}</span>
                    </td>
                    <td className="py-2 text-center text-gray-900 dark:text-white">
                      {item.count}
                    </td>
                    <td className="py-2 text-right text-gray-500 dark:text-gray-400">
                      %{defectCount > 0 ? ((item.count / defectCount) * 100).toFixed(1) : 0}
                    </td>
                  </tr>
                ))}
                <tr className="font-semibold">
                  <td className="py-2 text-gray-900 dark:text-white">Toplam</td>
                  <td className="py-2 text-center text-gray-900 dark:text-white">
                    {defectCount}
                  </td>
                  <td className="py-2 text-right text-gray-900 dark:text-white">%100</td>
                </tr>
              </tbody>
            </table>
          </div>
        </Card>
      )}

      {/* Actions */}
      <div className="flex flex-wrap justify-center gap-3 print:hidden">
        <Button onClick={handleGeneratePDF} variant="primary">
          <FileText className="w-4 h-4 mr-2" />
          PDF Rapor
        </Button>
        <Button onClick={handlePrint} variant="secondary">
          <Printer className="w-4 h-4 mr-2" />
          Yazdır
        </Button>
        <Button onClick={() => navigate('/')} variant="secondary">
          <Home className="w-4 h-4 mr-2" />
          Ana Sayfa
        </Button>
        <Button onClick={() => navigate('/lot-entry')} variant="success">
          <Plus className="w-4 h-4 mr-2" />
          Yeni Parti
        </Button>
      </div>
    </div>
  );
}


========================================
DOSYA: ./pages/Settings.tsx
========================================
import { useState, useRef } from 'react';
import {
  Save,
  Download,
  Upload,
  Sun,
  Moon,
  Globe,
  AlertTriangle
} from 'lucide-react';
import Card, { CardHeader } from '../components/common/Card';
import Button from '../components/common/Button';
import Input, { Select } from '../components/common/Input';
import Modal from '../components/common/Modal';
import {
  useSettingsStore,
  useLotStore,
  useSupplierStore,
  useMaterialStore,
  useInspectionStore
} from '../store/useStore';
import { aqlOptions, inspectionLevels } from '../data/samplingData';
import toast from 'react-hot-toast';

export default function Settings() {
  const { settings, setSettings, toggleDarkMode } = useSettingsStore();
  const lots = useLotStore((state) => state.lots);
  const suppliers = useSupplierStore((state) => state.suppliers);
  const materials = useMaterialStore((state) => state.materials);
  const inspections = useInspectionStore((state) => state.inspections);

  const [companyName, setCompanyName] = useState(settings.companyName);
  const [defaultAQL, setDefaultAQL] = useState(settings.defaultAQL);
  const [defaultLevel, setDefaultLevel] = useState<'I' | 'II' | 'III'>(settings.defaultInspectionLevel);
  const [showResetConfirm, setShowResetConfirm] = useState(false);
  const fileInputRef = useRef<HTMLInputElement>(null);

  const handleSaveSettings = () => {
    setSettings({
      companyName,
      defaultAQL,
      defaultInspectionLevel: defaultLevel as 'I' | 'II' | 'III',
    });
    toast.success('Ayarlar kaydedildi');
  };

  const handleExportData = () => {
    const data = {
      exportDate: new Date().toISOString(),
      version: '1.0',
      settings,
      lots,
      suppliers,
      materials,
      inspections,
    };

    const blob = new Blob([JSON.stringify(data, null, 2)], {
      type: 'application/json',
    });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `kkys_yedek_${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);

    toast.success('Veriler dışa aktarıldı');
  };

  const handleImportData = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (event) => {
      try {
        const data = JSON.parse(event.target?.result as string);

        // Validate structure
        if (!data.version || !data.lots || !data.suppliers) {
          throw new Error('Geçersiz yedek dosyası');
        }

        // Import data
        if (data.settings) {
          setSettings(data.settings);
        }

        // For stores with persist, we need to update localStorage directly
        // and reload the page
        localStorage.setItem(
          'lot-storage',
          JSON.stringify({ state: { lots: data.lots, currentLot: null } })
        );
        localStorage.setItem(
          'supplier-storage',
          JSON.stringify({ state: { suppliers: data.suppliers } })
        );
        localStorage.setItem(
          'material-storage',
          JSON.stringify({ state: { materials: data.materials } })
        );
        localStorage.setItem(
          'inspection-storage',
          JSON.stringify({
            state: { inspections: data.inspections, currentInspections: [] },
          })
        );

        toast.success('Veriler içe aktarıldı. Sayfa yenileniyor...');
        setTimeout(() => window.location.reload(), 1500);
      } catch (error) {
        toast.error('Dosya okunamadı: Geçersiz format');
      }
    };
    reader.readAsText(file);

    // Reset input
    if (fileInputRef.current) {
      fileInputRef.current.value = '';
    }
  };

  const handleResetData = () => {
    localStorage.removeItem('lot-storage');
    localStorage.removeItem('supplier-storage');
    localStorage.removeItem('inspection-storage');

    toast.success('Veriler sıfırlandı. Sayfa yenileniyor...');
    setTimeout(() => window.location.reload(), 1500);
    setShowResetConfirm(false);
  };

  const stats = {
    lots: lots.length,
    suppliers: suppliers.length,
    materials: materials.length,
    inspections: inspections.length,
  };

  return (
    <div className="max-w-4xl mx-auto space-y-6">
      {/* Company Settings */}
      <Card>
        <CardHeader
          title="Firma Bilgileri"
          subtitle="Raporlarda görünecek bilgiler"
        />
        <div className="space-y-4">
          <Input
            label="Firma Adı"
            value={companyName}
            onChange={(e) => setCompanyName(e.target.value)}
            placeholder="Kalite Kontrol Yönetim Sistemi"
          />
          <div className="flex justify-end">
            <Button onClick={handleSaveSettings}>
              <Save className="w-4 h-4 mr-2" />
              Kaydet
            </Button>
          </div>
        </div>
      </Card>

      {/* Default Parameters */}
      <Card>
        <CardHeader
          title="Varsayılan Parametreler"
          subtitle="Yeni parti girişlerinde kullanılacak değerler"
        />
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <Select
            label="Varsayılan AQL"
            value={defaultAQL}
            onChange={(e) => setDefaultAQL(e.target.value)}
            options={aqlOptions}
          />
          <Select
            label="Varsayılan Muayene Seviyesi"
            value={defaultLevel}
            onChange={(e) => setDefaultLevel(e.target.value as 'I' | 'II' | 'III')}
            options={inspectionLevels}
          />
        </div>
        <div className="flex justify-end mt-4">
          <Button onClick={handleSaveSettings}>
            <Save className="w-4 h-4 mr-2" />
            Kaydet
          </Button>
        </div>
      </Card>

      {/* Appearance */}
      <Card>
        <CardHeader
          title="Görünüm"
          subtitle="Tema ve dil ayarları"
        />
        <div className="space-y-4">
          {/* Theme Toggle */}
          <div className="flex items-center justify-between p-4 bg-gray-50 dark:bg-slate-700 rounded-xl">
            <div className="flex items-center gap-3">
              {settings.darkMode ? (
                <Moon className="w-5 h-5 text-blue-500" />
              ) : (
                <Sun className="w-5 h-5 text-amber-500" />
              )}
              <div>
                <p className="font-medium text-gray-900 dark:text-white">
                  {settings.darkMode ? 'Koyu Tema' : 'Açık Tema'}
                </p>
                <p className="text-sm text-gray-500 dark:text-gray-400">
                  Göz yorgunluğunu azaltır
                </p>
              </div>
            </div>
            <button
              onClick={toggleDarkMode}
              className={`
                relative w-14 h-7 rounded-full transition-colors duration-200
                ${settings.darkMode ? 'bg-blue-600' : 'bg-gray-300'}
              `}
            >
              <span
                className={`
                  absolute top-1 w-5 h-5 bg-white rounded-full shadow transition-transform duration-200
                  ${settings.darkMode ? 'translate-x-8' : 'translate-x-1'}
                `}
              />
            </button>
          </div>

          {/* Language */}
          <div className="flex items-center justify-between p-4 bg-gray-50 dark:bg-slate-700 rounded-xl">
            <div className="flex items-center gap-3">
              <Globe className="w-5 h-5 text-emerald-500" />
              <div>
                <p className="font-medium text-gray-900 dark:text-white">Dil</p>
                <p className="text-sm text-gray-500 dark:text-gray-400">
                  Arayüz dili
                </p>
              </div>
            </div>
            <Select
              value={settings.language}
              onChange={(e) =>
                setSettings({ language: e.target.value as 'tr' | 'en' })
              }
              options={[
                { value: 'tr', label: 'Türkçe' },
                { value: 'en', label: 'English' },
              ]}
              className="w-32"
            />
          </div>
        </div>
      </Card>

      {/* Data Management */}
      <Card>
        <CardHeader
          title="Veri Yönetimi"
          subtitle="Yedekleme ve geri yükleme"
        />

        {/* Stats */}
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
          <div className="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl text-center">
            <p className="text-2xl font-bold text-blue-600 dark:text-blue-400">
              {stats.lots}
            </p>
            <p className="text-sm text-gray-500 dark:text-gray-400">Parti</p>
          </div>
          <div className="p-4 bg-emerald-50 dark:bg-emerald-900/20 rounded-xl text-center">
            <p className="text-2xl font-bold text-emerald-600 dark:text-emerald-400">
              {stats.suppliers}
            </p>
            <p className="text-sm text-gray-500 dark:text-gray-400">Tedarikçi</p>
          </div>
          <div className="p-4 bg-purple-50 dark:bg-purple-900/20 rounded-xl text-center">
            <p className="text-2xl font-bold text-purple-600 dark:text-purple-400">
              {stats.materials}
            </p>
            <p className="text-sm text-gray-500 dark:text-gray-400">Malzeme</p>
          </div>
          <div className="p-4 bg-amber-50 dark:bg-amber-900/20 rounded-xl text-center">
            <p className="text-2xl font-bold text-amber-600 dark:text-amber-400">
              {stats.inspections}
            </p>
            <p className="text-sm text-gray-500 dark:text-gray-400">Kontrol</p>
          </div>
        </div>

        <div className="space-y-4">
          {/* Export */}
          <div className="flex items-center justify-between p-4 bg-gray-50 dark:bg-slate-700 rounded-xl">
            <div className="flex items-center gap-3">
              <Download className="w-5 h-5 text-blue-500" />
              <div>
                <p className="font-medium text-gray-900 dark:text-white">
                  Veri Yedekleme
                </p>
                <p className="text-sm text-gray-500 dark:text-gray-400">
                  Tüm verileri JSON formatında indir
                </p>
              </div>
            </div>
            <Button variant="secondary" onClick={handleExportData}>
              <Download className="w-4 h-4 mr-2" />
              Dışa Aktar
            </Button>
          </div>

          {/* Import */}
          <div className="flex items-center justify-between p-4 bg-gray-50 dark:bg-slate-700 rounded-xl">
            <div className="flex items-center gap-3">
              <Upload className="w-5 h-5 text-emerald-500" />
              <div>
                <p className="font-medium text-gray-900 dark:text-white">
                  Veri Geri Yükleme
                </p>
                <p className="text-sm text-gray-500 dark:text-gray-400">
                  Yedek dosyasından verileri geri yükle
                </p>
              </div>
            </div>
            <div>
              <input
                ref={fileInputRef}
                type="file"
                accept=".json"
                onChange={handleImportData}
                className="hidden"
              />
              <Button
                variant="secondary"
                onClick={() => fileInputRef.current?.click()}
              >
                <Upload className="w-4 h-4 mr-2" />
                İçe Aktar
              </Button>
            </div>
          </div>

          {/* Reset */}
          <div className="flex items-center justify-between p-4 bg-red-50 dark:bg-red-900/20 rounded-xl border border-red-200 dark:border-red-800">
            <div className="flex items-center gap-3">
              <AlertTriangle className="w-5 h-5 text-red-500" />
              <div>
                <p className="font-medium text-gray-900 dark:text-white">
                  Verileri Sıfırla
                </p>
                <p className="text-sm text-gray-500 dark:text-gray-400">
                  Tüm parti ve kontrol verilerini sil
                </p>
              </div>
            </div>
            <Button variant="danger" onClick={() => setShowResetConfirm(true)}>
              Sıfırla
            </Button>
          </div>
        </div>
      </Card>

      {/* About */}
      <Card>
        <CardHeader
          title="Hakkında"
          subtitle="Sistem bilgileri"
        />
        <div className="space-y-3 text-sm">
          <div className="flex justify-between py-2 border-b border-gray-100 dark:border-slate-700">
            <span className="text-gray-500 dark:text-gray-400">Uygulama</span>
            <span className="font-medium text-gray-900 dark:text-white">
              Kalite Kontrol Yönetim Sistemi (KKYS)
            </span>
          </div>
          <div className="flex justify-between py-2 border-b border-gray-100 dark:border-slate-700">
            <span className="text-gray-500 dark:text-gray-400">Versiyon</span>
            <span className="font-medium text-gray-900 dark:text-white">1.0.0</span>
          </div>
          <div className="flex justify-between py-2 border-b border-gray-100 dark:border-slate-700">
            <span className="text-gray-500 dark:text-gray-400">Standart</span>
            <span className="font-medium text-gray-900 dark:text-white">ISO 2859-1</span>
          </div>
          <div className="flex justify-between py-2">
            <span className="text-gray-500 dark:text-gray-400">Geliştirici</span>
            <span className="font-medium text-gray-900 dark:text-white">
              Üniversite Bitirme Projesi
            </span>
          </div>
        </div>
      </Card>

      {/* Reset Confirmation Modal */}
      <Modal
        isOpen={showResetConfirm}
        onClose={() => setShowResetConfirm(false)}
        title="Verileri Sıfırla"
        size="sm"
      >
        <div className="text-center py-4">
          <AlertTriangle className="w-16 h-16 mx-auto text-red-500 mb-4" />
          <p className="text-gray-600 dark:text-gray-400 mb-2">
            Bu işlem geri alınamaz!
          </p>
          <p className="text-gray-600 dark:text-gray-400 mb-6">
            Tüm parti, kontrol ve tedarikçi verileri silinecek.
          </p>
          <div className="flex justify-center gap-3">
            <Button variant="secondary" onClick={() => setShowResetConfirm(false)}>
              İptal
            </Button>
            <Button variant="danger" onClick={handleResetData}>
              Evet, Sıfırla
            </Button>
          </div>
        </div>
      </Modal>
    </div>
  );
}


========================================
DOSYA: ./pages/Suppliers.tsx
========================================
import { useState } from 'react';
import {
  Plus,
  Search,
  Edit2,
  Trash2,
  Building2,
  Phone,
  Mail,
  MapPin,
  User,
  CheckCircle,
  XCircle
} from 'lucide-react';
import Card from '../components/common/Card';
import Button from '../components/common/Button';
import Input from '../components/common/Input';
import Modal from '../components/common/Modal';
import Badge from '../components/common/Badge';
import {
  useSupplierStore,
  useLotStore,
  useMaterialStore,
  useAnalytics
} from '../store/useStore';
import { useSwitchingStore } from '../store/switchingStore';
import { SwitchingIcon } from '../components/switching/SwitchingBadge';
import toast from 'react-hot-toast';

export default function Suppliers() {
  const { suppliers, addSupplier, updateSupplier, deleteSupplier } = useSupplierStore();
  const lots = useLotStore((state) => state.lots);
  const materials = useMaterialStore((state) => state.materials);
  const { getSupplierPerformance } = useAnalytics();
  const getAllStatesForSupplier = useSwitchingStore((state) => state.getAllStatesForSupplier);

  const [search, setSearch] = useState('');
  const [showModal, setShowModal] = useState(false);
  const [editingId, setEditingId] = useState<string | null>(null);
  const [showDeleteConfirm, setShowDeleteConfirm] = useState<string | null>(null);

  const [formData, setFormData] = useState({
    name: '',
    code: '',
    contactPerson: '',
    phone: '',
    email: '',
    address: '',
    isActive: true,
  });

  const supplierPerformance = getSupplierPerformance();

  const filteredSuppliers = suppliers.filter((s) =>
    s.name.toLowerCase().includes(search.toLowerCase()) ||
    s.code.toLowerCase().includes(search.toLowerCase())
  );

  const getPerformance = (supplierId: string) =>
    supplierPerformance.find((p) => p.supplierId === supplierId);

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();

    if (!formData.name || !formData.code) {
      toast.error('Ad ve kod zorunludur');
      return;
    }

    if (editingId) {
      updateSupplier(editingId, formData);
      toast.success('Tedarikçi güncellendi');
    } else {
      addSupplier(formData);
      toast.success('Tedarikçi eklendi');
    }

    handleCloseModal();
  };

  const handleEdit = (supplier: typeof suppliers[0]) => {
    setFormData({
      name: supplier.name,
      code: supplier.code,
      contactPerson: supplier.contactPerson,
      phone: supplier.phone,
      email: supplier.email,
      address: supplier.address,
      isActive: supplier.isActive,
    });
    setEditingId(supplier.id);
    setShowModal(true);
  };

  const handleDelete = (id: string) => {
    const hasLots = lots.some((l) => l.supplierId === id);
    if (hasLots) {
      toast.error('Bu tedarikçiye ait partiler var. Önce partileri silin.');
      return;
    }
    deleteSupplier(id);
    toast.success('Tedarikçi silindi');
    setShowDeleteConfirm(null);
  };

  const handleCloseModal = () => {
    setShowModal(false);
    setEditingId(null);
    setFormData({
      name: '',
      code: '',
      contactPerson: '',
      phone: '',
      email: '',
      address: '',
      isActive: true,
    });
  };

  const getScoreColor = (rate: number) => {
    if (rate >= 90) return 'text-emerald-600 dark:text-emerald-400';
    if (rate >= 70) return 'text-amber-600 dark:text-amber-400';
    return 'text-red-600 dark:text-red-400';
  };

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex flex-wrap justify-between items-center gap-4">
        <div className="relative flex-1 max-w-md">
          <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400" />
          <input
            type="text"
            value={search}
            onChange={(e) => setSearch(e.target.value)}
            placeholder="Tedarikçi ara..."
            className="w-full pl-10 pr-4 py-2.5 border border-gray-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
          />
        </div>
        <Button onClick={() => setShowModal(true)}>
          <Plus className="w-4 h-4 mr-2" />
          Yeni Tedarikçi
        </Button>
      </div>

      {/* Supplier Cards */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        {filteredSuppliers.map((supplier) => {
          const performance = getPerformance(supplier.id);
          return (
            <Card key={supplier.id} hover className="relative">
              {/* Actions */}
              <div className="absolute top-4 right-4 flex gap-1">
                <button
                  onClick={() => handleEdit(supplier)}
                  className="p-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700 text-gray-500 hover:text-blue-600 transition-colors"
                >
                  <Edit2 className="w-4 h-4" />
                </button>
                <button
                  onClick={() => setShowDeleteConfirm(supplier.id)}
                  className="p-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700 text-gray-500 hover:text-red-600 transition-colors"
                >
                  <Trash2 className="w-4 h-4" />
                </button>
              </div>

              {/* Header */}
              <div className="flex items-start gap-3 mb-4">
                <div className="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center text-white font-bold text-lg">
                  {supplier.code.substring(0, 2)}
                </div>
                <div>
                  <h3 className="font-semibold text-gray-900 dark:text-white">
                    {supplier.name}
                  </h3>
                  <p className="text-sm text-gray-500 dark:text-gray-400">
                    {supplier.code}
                  </p>
                </div>
              </div>

              {/* Contact Info */}
              <div className="space-y-2 mb-4">
                {supplier.contactPerson && (
                  <div className="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
                    <User className="w-4 h-4" />
                    <span>{supplier.contactPerson}</span>
                  </div>
                )}
                {supplier.phone && (
                  <div className="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
                    <Phone className="w-4 h-4" />
                    <span>{supplier.phone}</span>
                  </div>
                )}
                {supplier.email && (
                  <div className="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
                    <Mail className="w-4 h-4" />
                    <span>{supplier.email}</span>
                  </div>
                )}
                {supplier.address && (
                  <div className="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
                    <MapPin className="w-4 h-4" />
                    <span>{supplier.address}</span>
                  </div>
                )}
              </div>

              {/* Performance Stats */}
              {performance && performance.totalLots > 0 && (
                <div className="pt-4 border-t border-gray-200 dark:border-slate-700">
                  <div className="flex items-center justify-between mb-2">
                    <span className="text-sm text-gray-500 dark:text-gray-400">
                      Performans
                    </span>
                    <span className={`text-lg font-bold ${getScoreColor(performance.acceptanceRate)}`}>
                      %{performance.acceptanceRate.toFixed(1)}
                    </span>
                  </div>
                  <div className="h-2 bg-gray-200 dark:bg-slate-700 rounded-full overflow-hidden">
                    <div
                      className={`h-full rounded-full ${
                        performance.acceptanceRate >= 90
                          ? 'bg-emerald-500'
                          : performance.acceptanceRate >= 70
                          ? 'bg-amber-500'
                          : 'bg-red-500'
                      }`}
                      style={{ width: `${performance.acceptanceRate}%` }}
                    />
                  </div>
                  <div className="flex justify-between mt-2 text-xs text-gray-500 dark:text-gray-400">
                    <span className="flex items-center gap-1">
                      <CheckCircle className="w-3 h-3 text-emerald-500" />
                      {performance.acceptedLots} Kabul
                    </span>
                    <span className="flex items-center gap-1">
                      <XCircle className="w-3 h-3 text-red-500" />
                      {performance.rejectedLots} Red
                    </span>
                    <span>{performance.totalLots} Toplam</span>
                  </div>
                </div>
              )}

              {/* Status Badge */}
              <div className="mt-4 flex items-center gap-2 flex-wrap">
                <Badge variant={supplier.isActive ? 'success' : 'default'}>
                  {supplier.isActive ? 'Aktif' : 'Pasif'}
                </Badge>

                {/* Switching States */}
                {getAllStatesForSupplier(supplier.id).map((switchState) => {
                  const material = materials.find((m) => m.id === switchState.materialTypeId);
                  if (!material || switchState.currentLevel === 'normal') return null;

                  return (
                    <div
                      key={switchState.materialTypeId}
                      className="flex items-center gap-1 text-xs"
                      title={`${material.name}: ${switchState.currentLevel === 'tightened' ? 'Sıkılaştırılmış' : 'Gevşetilmiş'}`}
                    >
                      <SwitchingIcon
                        level={switchState.currentLevel}
                        shouldStop={switchState.shouldStopProduction}
                      />
                      <span className="text-gray-500 dark:text-gray-400">{material.name}</span>
                    </div>
                  );
                })}
              </div>
            </Card>
          );
        })}
      </div>

      {/* Empty State */}
      {filteredSuppliers.length === 0 && (
        <Card className="text-center py-12">
          <Building2 className="w-16 h-16 mx-auto text-gray-300 dark:text-gray-600 mb-4" />
          <h3 className="text-lg font-medium text-gray-900 dark:text-white mb-2">
            Tedarikçi bulunamadı
          </h3>
          <p className="text-gray-500 dark:text-gray-400 mb-4">
            Yeni tedarikçi ekleyerek başlayın
          </p>
          <Button onClick={() => setShowModal(true)}>
            <Plus className="w-4 h-4 mr-2" />
            Yeni Tedarikçi
          </Button>
        </Card>
      )}

      {/* Add/Edit Modal */}
      <Modal
        isOpen={showModal}
        onClose={handleCloseModal}
        title={editingId ? 'Tedarikçi Düzenle' : 'Yeni Tedarikçi'}
        size="md"
      >
        <form onSubmit={handleSubmit} className="space-y-4">
          <div className="grid grid-cols-2 gap-4">
            <Input
              label="Tedarikçi Adı"
              value={formData.name}
              onChange={(e) => setFormData({ ...formData, name: e.target.value })}
              placeholder="Örn: ABC Ltd. Şti."
              required
            />
            <Input
              label="Kısa Kod"
              value={formData.code}
              onChange={(e) => setFormData({ ...formData, code: e.target.value.toUpperCase() })}
              placeholder="Örn: ABC"
              required
            />
          </div>

          <Input
            label="Yetkili Kişi"
            value={formData.contactPerson}
            onChange={(e) => setFormData({ ...formData, contactPerson: e.target.value })}
            placeholder="Ad Soyad"
          />

          <div className="grid grid-cols-2 gap-4">
            <Input
              label="Telefon"
              value={formData.phone}
              onChange={(e) => setFormData({ ...formData, phone: e.target.value })}
              placeholder="0212 555 1234"
            />
            <Input
              label="E-posta"
              type="email"
              value={formData.email}
              onChange={(e) => setFormData({ ...formData, email: e.target.value })}
              placeholder="info@firma.com"
            />
          </div>

          <Input
            label="Adres"
            value={formData.address}
            onChange={(e) => setFormData({ ...formData, address: e.target.value })}
            placeholder="İstanbul, Türkiye"
          />

          <div className="flex items-center gap-2">
            <input
              type="checkbox"
              id="isActive"
              checked={formData.isActive}
              onChange={(e) => setFormData({ ...formData, isActive: e.target.checked })}
              className="w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
            />
            <label htmlFor="isActive" className="text-sm text-gray-700 dark:text-gray-300">
              Aktif Tedarikçi
            </label>
          </div>

          <div className="flex justify-end gap-3 pt-4">
            <Button type="button" variant="secondary" onClick={handleCloseModal}>
              İptal
            </Button>
            <Button type="submit">
              {editingId ? 'Güncelle' : 'Ekle'}
            </Button>
          </div>
        </form>
      </Modal>

      {/* Delete Confirmation Modal */}
      <Modal
        isOpen={!!showDeleteConfirm}
        onClose={() => setShowDeleteConfirm(null)}
        title="Tedarikçi Sil"
        size="sm"
      >
        <p className="text-gray-600 dark:text-gray-400 mb-6">
          Bu tedarikçiyi silmek istediğinize emin misiniz?
        </p>
        <div className="flex justify-end gap-3">
          <Button variant="secondary" onClick={() => setShowDeleteConfirm(null)}>
            İptal
          </Button>
          <Button
            variant="danger"
            onClick={() => showDeleteConfirm && handleDelete(showDeleteConfirm)}
          >
            Sil
          </Button>
        </div>
      </Modal>
    </div>
  );
}


========================================
DOSYA: ./store/switchingStore.ts
========================================
// ISO 2859-1 Switching Rules Store

import { create } from 'zustand';
import { persist } from 'zustand/middleware';
import type { SwitchingState, SwitchingTransition } from '../types/switching';
import { createDefaultSwitchingState, evaluateSwitching } from '../utils/switchingLogic';

interface SwitchingStore {
  // State: key = `${supplierId}-${materialTypeId}`
  states: Record<string, SwitchingState>;

  // Actions
  getState: (supplierId: string, materialTypeId: string) => SwitchingState;
  updateState: (
    supplierId: string,
    materialTypeId: string,
    result: 'accepted' | 'rejected',
    lotId: string,
    lotNumber: string
  ) => { transition: SwitchingTransition | null; shouldStop: boolean };
  getHistory: (supplierId: string, materialTypeId: string) => SwitchingTransition[];
  resetState: (supplierId: string, materialTypeId: string) => void;
  clearStopFlag: (supplierId: string, materialTypeId: string) => void;

  // Tüm tedarikçilerin durumlarını getir
  getAllStatesForSupplier: (supplierId: string) => SwitchingState[];
}

// Key oluşturma yardımcı fonksiyonu
const createKey = (supplierId: string, materialTypeId: string): string => {
  return `${supplierId}-${materialTypeId}`;
};

export const useSwitchingStore = create<SwitchingStore>()(
  persist(
    (set, get) => ({
      states: {},

      getState: (supplierId, materialTypeId) => {
        const key = createKey(supplierId, materialTypeId);
        const existing = get().states[key];

        if (existing) {
          return existing;
        }

        // Yoksa yeni oluştur
        const newState = createDefaultSwitchingState(supplierId, materialTypeId);
        set((state) => ({
          states: {
            ...state.states,
            [key]: newState,
          },
        }));
        return newState;
      },

      updateState: (supplierId, materialTypeId, result, lotId, lotNumber) => {
        const key = createKey(supplierId, materialTypeId);
        const currentState = get().getState(supplierId, materialTypeId);

        const { newState, transition } = evaluateSwitching(
          currentState,
          result,
          lotId,
          lotNumber
        );

        set((state) => ({
          states: {
            ...state.states,
            [key]: newState,
          },
        }));

        return {
          transition,
          shouldStop: newState.shouldStopProduction,
        };
      },

      getHistory: (supplierId, materialTypeId) => {
        const key = createKey(supplierId, materialTypeId);
        const state = get().states[key];
        return state?.history || [];
      },

      resetState: (supplierId, materialTypeId) => {
        const key = createKey(supplierId, materialTypeId);
        const newState = createDefaultSwitchingState(supplierId, materialTypeId);

        set((state) => ({
          states: {
            ...state.states,
            [key]: newState,
          },
        }));
      },

      clearStopFlag: (supplierId, materialTypeId) => {
        const key = createKey(supplierId, materialTypeId);
        const currentState = get().states[key];

        if (currentState) {
          set((state) => ({
            states: {
              ...state.states,
              [key]: {
                ...currentState,
                shouldStopProduction: false,
                consecutiveRejects: 0,
              },
            },
          }));
        }
      },

      getAllStatesForSupplier: (supplierId) => {
        const allStates = get().states;
        return Object.values(allStates).filter(
          (state) => state.supplierId === supplierId
        );
      },
    }),
    {
      name: 'kkys-switching-store',
    }
  )
);


========================================
DOSYA: ./store/useStore.ts
========================================
import { create } from 'zustand';
import { persist } from 'zustand/middleware';
import { v4 as uuidv4 } from 'uuid';
import type {
  Lot,
  Inspection,
  Supplier,
  MaterialType,
  Settings
} from '../types';
import {
  sampleSuppliers,
  materialTypes as defaultMaterialTypes,
  generateLotNumber
} from '../data/samplingData';

// ============================================
// SETTINGS STORE
// ============================================

interface SettingsState {
  settings: Settings;
  setSettings: (settings: Partial<Settings>) => void;
  toggleDarkMode: () => void;
}

export const useSettingsStore = create<SettingsState>()(
  persist(
    (set) => ({
      settings: {
        companyName: 'Kalite Kontrol Yönetim Sistemi',
        companyLogo: null,
        defaultAQL: '2.5',
        defaultInspectionLevel: 'II',
        darkMode: false,
        language: 'tr',
      },
      setSettings: (newSettings) =>
        set((state) => ({
          settings: { ...state.settings, ...newSettings },
        })),
      toggleDarkMode: () =>
        set((state) => ({
          settings: { ...state.settings, darkMode: !state.settings.darkMode },
        })),
    }),
    {
      name: 'settings-storage',
    }
  )
);

// ============================================
// SUPPLIER STORE
// ============================================

interface SupplierState {
  suppliers: Supplier[];
  addSupplier: (supplier: Omit<Supplier, 'id' | 'createdAt'>) => void;
  updateSupplier: (id: string, supplier: Partial<Supplier>) => void;
  deleteSupplier: (id: string) => void;
  getSupplierById: (id: string) => Supplier | undefined;
}

export const useSupplierStore = create<SupplierState>()(
  persist(
    (set, get) => ({
      suppliers: sampleSuppliers,
      addSupplier: (supplier) =>
        set((state) => ({
          suppliers: [
            ...state.suppliers,
            {
              ...supplier,
              id: uuidv4(),
              createdAt: new Date().toISOString(),
            },
          ],
        })),
      updateSupplier: (id, supplier) =>
        set((state) => ({
          suppliers: state.suppliers.map((s) =>
            s.id === id ? { ...s, ...supplier } : s
          ),
        })),
      deleteSupplier: (id) =>
        set((state) => ({
          suppliers: state.suppliers.filter((s) => s.id !== id),
        })),
      getSupplierById: (id) => get().suppliers.find((s) => s.id === id),
    }),
    {
      name: 'supplier-storage',
    }
  )
);

// ============================================
// MATERIAL STORE
// ============================================

interface MaterialState {
  materials: MaterialType[];
  addMaterial: (material: Omit<MaterialType, 'id'>) => void;
  updateMaterial: (id: string, material: Partial<MaterialType>) => void;
  deleteMaterial: (id: string) => void;
  getMaterialById: (id: string) => MaterialType | undefined;
}

export const useMaterialStore = create<MaterialState>()(
  persist(
    (set, get) => ({
      materials: defaultMaterialTypes,
      addMaterial: (material) =>
        set((state) => ({
          materials: [
            ...state.materials,
            {
              ...material,
              id: uuidv4(),
            },
          ],
        })),
      updateMaterial: (id, material) =>
        set((state) => ({
          materials: state.materials.map((m) =>
            m.id === id ? { ...m, ...material } : m
          ),
        })),
      deleteMaterial: (id) =>
        set((state) => ({
          materials: state.materials.filter((m) => m.id !== id),
        })),
      getMaterialById: (id) => get().materials.find((m) => m.id === id),
    }),
    {
      name: 'material-storage',
    }
  )
);

// ============================================
// LOT STORE
// ============================================

interface LotState {
  lots: Lot[];
  currentLot: Lot | null;
  addLot: (lot: Omit<Lot, 'id' | 'lotNumber' | 'createdAt' | 'status' | 'decision' | 'defectCount'>) => Lot;
  updateLot: (id: string, lot: Partial<Lot>) => void;
  deleteLot: (id: string) => void;
  setCurrentLot: (lot: Lot | null) => void;
  getLotById: (id: string) => Lot | undefined;
  completeLot: (id: string, decision: 'accepted' | 'rejected', defectCount: number) => void;
  updateCurrentSampleIndex: (id: string, index: number) => void;
}

export const useLotStore = create<LotState>()(
  persist(
    (set, get) => ({
      lots: [],
      currentLot: null,
      addLot: (lot) => {
        const newLot: Lot = {
          ...lot,
          id: uuidv4(),
          lotNumber: generateLotNumber(),
          createdAt: new Date().toISOString(),
          status: 'pending',
          decision: null,
          defectCount: 0,
        };
        set((state) => ({
          lots: [newLot, ...state.lots],
          currentLot: newLot,
        }));
        return newLot;
      },
      updateLot: (id, lot) =>
        set((state) => ({
          lots: state.lots.map((l) => (l.id === id ? { ...l, ...lot } : l)),
          currentLot:
            state.currentLot?.id === id
              ? { ...state.currentLot, ...lot }
              : state.currentLot,
        })),
      deleteLot: (id) =>
        set((state) => ({
          lots: state.lots.filter((l) => l.id !== id),
          currentLot: state.currentLot?.id === id ? null : state.currentLot,
        })),
      setCurrentLot: (lot) => set({ currentLot: lot }),
      getLotById: (id) => get().lots.find((l) => l.id === id),
      completeLot: (id, decision, defectCount) =>
        set((state) => ({
          lots: state.lots.map((l) =>
            l.id === id
              ? {
                  ...l,
                  status: 'completed',
                  decision,
                  defectCount,
                  inspectionDate: new Date().toISOString(),
                }
              : l
          ),
          currentLot:
            state.currentLot?.id === id
              ? {
                  ...state.currentLot,
                  status: 'completed',
                  decision,
                  defectCount,
                  inspectionDate: new Date().toISOString(),
                }
              : state.currentLot,
        })),
      updateCurrentSampleIndex: (id, index) =>
        set((state) => ({
          lots: state.lots.map((l) =>
            l.id === id ? { ...l, currentSampleIndex: index } : l
          ),
          currentLot:
            state.currentLot?.id === id
              ? { ...state.currentLot, currentSampleIndex: index }
              : state.currentLot,
        })),
    }),
    {
      name: 'lot-storage',
    }
  )
);

// ============================================
// INSPECTION STORE
// ============================================

interface InspectionState {
  inspections: Inspection[];
  currentInspections: Inspection[];
  addInspection: (inspection: Omit<Inspection, 'id' | 'inspectedAt'>) => void;
  getInspectionsByLotId: (lotId: string) => Inspection[];
  clearCurrentInspections: () => void;
  setCurrentInspections: (inspections: Inspection[]) => void;
}

export const useInspectionStore = create<InspectionState>()(
  persist(
    (set, get) => ({
      inspections: [],
      currentInspections: [],
      addInspection: (inspection) => {
        const newInspection: Inspection = {
          ...inspection,
          id: uuidv4(),
          inspectedAt: new Date().toISOString(),
        };
        set((state) => ({
          inspections: [...state.inspections, newInspection],
          currentInspections: [...state.currentInspections, newInspection],
        }));
      },
      getInspectionsByLotId: (lotId) =>
        get().inspections.filter((i) => i.lotId === lotId),
      clearCurrentInspections: () => set({ currentInspections: [] }),
      setCurrentInspections: (inspections) => set({ currentInspections: inspections }),
    }),
    {
      name: 'inspection-storage',
    }
  )
);

// ============================================
// ANALYTICS HELPERS
// ============================================

export const useAnalytics = () => {
  const lots = useLotStore((state) => state.lots);
  const suppliers = useSupplierStore((state) => state.suppliers);
  const inspections = useInspectionStore((state) => state.inspections);
  const materials = useMaterialStore((state) => state.materials);

  const getStats = () => {
    const now = new Date();
    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
    const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
    const monthAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);

    const completedLots = lots.filter((l) => l.status === 'completed');
    const todayLots = completedLots.filter(
      (l) => new Date(l.inspectionDate) >= today
    );
    const weeklyLots = completedLots.filter(
      (l) => new Date(l.inspectionDate) >= weekAgo
    );
    const monthlyLots = completedLots.filter(
      (l) => new Date(l.inspectionDate) >= monthAgo
    );

    const acceptedLots = completedLots.filter((l) => l.decision === 'accepted');
    const rejectedLots = completedLots.filter((l) => l.decision === 'rejected');
    const pendingLots = lots.filter((l) => l.status === 'pending');

    return {
      todayInspections: todayLots.length,
      weeklyInspections: weeklyLots.length,
      monthlyInspections: monthlyLots.length,
      acceptanceRate:
        completedLots.length > 0
          ? (acceptedLots.length / completedLots.length) * 100
          : 0,
      pendingLots: pendingLots.length,
      totalLots: lots.length,
      totalAccepted: acceptedLots.length,
      totalRejected: rejectedLots.length,
    };
  };

  const getSupplierPerformance = () => {
    return suppliers.map((supplier) => {
      const supplierLots = lots.filter(
        (l) => l.supplierId === supplier.id && l.status === 'completed'
      );
      const acceptedLots = supplierLots.filter((l) => l.decision === 'accepted');
      const totalDefects = supplierLots.reduce((sum, l) => sum + l.defectCount, 0);

      return {
        supplierId: supplier.id,
        supplierName: supplier.name,
        totalLots: supplierLots.length,
        acceptedLots: acceptedLots.length,
        rejectedLots: supplierLots.length - acceptedLots.length,
        acceptanceRate:
          supplierLots.length > 0
            ? (acceptedLots.length / supplierLots.length) * 100
            : 0,
        totalDefects,
        avgDefectsPerLot:
          supplierLots.length > 0 ? totalDefects / supplierLots.length : 0,
      };
    });
  };

  const getDefectAnalysis = () => {
    const defectCounts: Record<string, { name: string; count: number }> = {};

    inspections.forEach((inspection) => {
      inspection.defects.forEach((defect) => {
        if (!defectCounts[defect.defectTypeId]) {
          // Find defect name from materials
          let defectName = defect.defectTypeId;
          materials.forEach((material) => {
            const found = material.defectTypes.find(
              (d) => d.id === defect.defectTypeId
            );
            if (found) defectName = found.name;
          });
          defectCounts[defect.defectTypeId] = { name: defectName, count: 0 };
        }
        defectCounts[defect.defectTypeId].count++;
      });
    });

    const total = Object.values(defectCounts).reduce((sum, d) => sum + d.count, 0);

    return Object.entries(defectCounts)
      .map(([id, data]) => ({
        defectTypeId: id,
        defectName: data.name,
        count: data.count,
        percentage: total > 0 ? (data.count / total) * 100 : 0,
      }))
      .sort((a, b) => b.count - a.count);
  };

  const getTrendData = (days: number = 30) => {
    const result: Array<{
      date: string;
      inspections: number;
      accepted: number;
      rejected: number;
      defectRate: number;
    }> = [];

    const now = new Date();
    for (let i = days - 1; i >= 0; i--) {
      const date = new Date(now.getTime() - i * 24 * 60 * 60 * 1000);
      const dateStr = date.toISOString().split('T')[0];

      const dayLots = lots.filter((l) => {
        if (l.status !== 'completed') return false;
        const lotDate = new Date(l.inspectionDate).toISOString().split('T')[0];
        return lotDate === dateStr;
      });

      const accepted = dayLots.filter((l) => l.decision === 'accepted').length;
      const rejected = dayLots.filter((l) => l.decision === 'rejected').length;
      const totalDefects = dayLots.reduce((sum, l) => sum + l.defectCount, 0);
      const totalSamples = dayLots.reduce((sum, l) => sum + l.sampleSize, 0);

      result.push({
        date: dateStr,
        inspections: dayLots.length,
        accepted,
        rejected,
        defectRate: totalSamples > 0 ? (totalDefects / totalSamples) * 100 : 0,
      });
    }

    return result;
  };

  return {
    getStats,
    getSupplierPerformance,
    getDefectAnalysis,
    getTrendData,
  };
};


========================================
DOSYA: ./types/index.ts
========================================
// ============================================
// TÜM VERİ MODELLERİ
// ============================================

export interface Supplier {
  id: string;
  name: string;
  code: string;
  contactPerson: string;
  phone: string;
  email: string;
  address: string;
  createdAt: string;
  isActive: boolean;
}

export interface MaterialType {
  id: string;
  name: string;
  code: string;
  unit?: string;  // 'adet', 'bobin', 'metre' vb.
  defaultAQL: string;
  criteria: ControlCriterion[];
  defectTypes: DefectType[];
}

export interface ControlCriterion {
  id: string;
  name: string;
  description: string;
  acceptanceCriteria: string;
  inspectionMethod?: string;  // 'Görsel', 'Dokunma ve koku' vb.
  isCritical: boolean;
}

export interface DefectType {
  id: string;
  code: string;
  name: string;
  description: string;
  severity: 'critical' | 'major' | 'minor';
}

// Parti yapısı konfigürasyonu
export interface PackageConfig {
  palletCount: number;       // P - Palet sayısı
  packagesPerPallet: number; // B - Palet başı poşet sayısı
  itemsPerPackage: number;   // L - Poşet içi etiket sayısı
}

// Numune pozisyonu (clusterSampling.ts ile senkron)
export interface SamplePosition {
  code: string;           // "02-11-02" formatında
  pallet: number;         // Palet numarası
  package: number;        // Poşet numarası
  position: '01' | '02' | '03'; // Konum kodu
  positionLabel: string;  // "ÜSTTEN", "ORTADAN", "ALTTAN"
}

export interface Lot {
  id: string;
  lotNumber: string;
  supplierId: string;
  materialTypeId: string;
  quantity: number;
  sampleSize: number;
  sampleCode: string;
  aql: string;
  inspectionLevel: 'I' | 'II' | 'III';
  acceptanceNumber: number;
  rejectionNumber: number;
  orderNumber: string;
  receivedDate: string;
  inspectionDate: string;
  status: 'pending' | 'in-progress' | 'completed';
  decision: 'accepted' | 'rejected' | null;
  inspectedBy: string;
  notes: string;
  createdAt: string;
  defectCount: number;
  // Küme örnekleme için yeni alanlar
  packageConfig?: PackageConfig;
  samplePositions?: SamplePosition[];
  currentSampleIndex?: number;
}

export interface Inspection {
  id: string;
  lotId: string;
  sampleNumber: number;
  isDefective: boolean;
  defects: InspectionDefect[];
  notes: string;
  photoBase64: string | null;
  inspectedAt: string;
}

export interface InspectionDefect {
  criterionId: string;
  defectTypeId: string;
  description: string;
}

export interface SamplingResult {
  sampleCode: string;
  sampleSize: number;
  acceptanceNumber: number;
  rejectionNumber: number;
}

export interface DashboardStats {
  todayInspections: number;
  weeklyInspections: number;
  monthlyInspections: number;
  acceptanceRate: number;
  pendingLots: number;
  totalLots: number;
  totalAccepted: number;
  totalRejected: number;
}

export interface SupplierPerformance {
  supplierId: string;
  supplierName: string;
  totalLots: number;
  acceptedLots: number;
  rejectedLots: number;
  acceptanceRate: number;
  totalDefects: number;
  avgDefectsPerLot: number;
}

export interface DefectAnalysis {
  defectTypeId: string;
  defectName: string;
  count: number;
  percentage: number;
}

export interface TrendData {
  date: string;
  inspections: number;
  accepted: number;
  rejected: number;
  defectRate: number;
}

export interface Settings {
  companyName: string;
  companyLogo: string | null;
  defaultAQL: string;
  defaultInspectionLevel: 'I' | 'II' | 'III';
  darkMode: boolean;
  language: 'tr' | 'en';
}

export type InspectionStatus = 'pending' | 'in-progress' | 'completed';
export type Decision = 'accepted' | 'rejected' | null;
export type Severity = 'critical' | 'major' | 'minor';
export type InspectionLevel = 'I' | 'II' | 'III';


========================================
DOSYA: ./types/switching.ts
========================================
// ISO 2859-1 Switching Rules Tipleri

export type SwitchingLevel = 'normal' | 'tightened' | 'reduced';

export interface SwitchingState {
  supplierId: string;
  materialTypeId: string;
  currentLevel: SwitchingLevel;
  consecutiveAccepts: number;
  consecutiveRejects: number;
  recentResults: ('accepted' | 'rejected')[];  // Son 5 lot sonucu
  history: SwitchingTransition[];
  lastUpdated: string;
  shouldStopProduction: boolean;  // 5 ardışık RED durumu
}

export interface SwitchingTransition {
  id: string;
  fromLevel: SwitchingLevel;
  toLevel: SwitchingLevel;
  reason: string;
  lotId: string;
  lotNumber: string;
  timestamp: string;
}

// Türkçe seviye isimleri
export const SWITCHING_LEVEL_LABELS: Record<SwitchingLevel, string> = {
  normal: 'Normal',
  tightened: 'Sıkılaştırılmış',
  reduced: 'Gevşetilmiş',
};

// Seviye renkleri
export const SWITCHING_LEVEL_COLORS: Record<SwitchingLevel, { bg: string; text: string; border: string }> = {
  normal: {
    bg: 'bg-blue-100 dark:bg-blue-900/30',
    text: 'text-blue-700 dark:text-blue-300',
    border: 'border-blue-300 dark:border-blue-700',
  },
  tightened: {
    bg: 'bg-red-100 dark:bg-red-900/30',
    text: 'text-red-700 dark:text-red-300',
    border: 'border-red-300 dark:border-red-700',
  },
  reduced: {
    bg: 'bg-green-100 dark:bg-green-900/30',
    text: 'text-green-700 dark:text-green-300',
    border: 'border-green-300 dark:border-green-700',
  },
};

// Örneklem çarpanları
export const SAMPLE_MULTIPLIERS: Record<SwitchingLevel, number> = {
  normal: 1.0,
  tightened: 1.0,  // Aynı örneklem, düşük Ac
  reduced: 0.4,    // %40 örneklem
};


========================================
DOSYA: ./utils/clusterSampling.ts
========================================
// ============================================
// İKİ AŞAMALI KÜME ÖRNEKLEMESİ (Two-Stage Cluster Sampling)
// ============================================

// Pozisyon kodları: Üst, Orta, Alt
export type PositionCode = '01' | '02' | '03';

// Parti yapısı konfigürasyonu
export interface PackageConfig {
  palletCount: number;       // P - Palet sayısı
  packagesPerPallet: number; // B - Palet başı poşet sayısı
  itemsPerPackage: number;   // L - Poşet içi etiket sayısı
}

// Tek bir numune pozisyonu
export interface SamplePosition {
  code: string;           // "02-11-02" formatında
  pallet: number;         // Palet numarası (1-99)
  package: number;        // Poşet numarası (1-99)
  position: PositionCode; // Konum kodu ("01", "02", "03")
  positionLabel: string;  // "ÜSTTEN", "ORTADAN", "ALTTAN"
}

// Poşet grubu (aynı poşetten alınacak numuneler)
export interface PackageGroup {
  pallet: number;
  package: number;
  packageCode: string;    // "02-11" formatında
  sampleCount: number;    // Bu poşetten kaç numune alınacak
  samples: SamplePosition[];
}

// Pozisyon etiketlerini döndür
const POSITION_LABELS: Record<PositionCode, string> = {
  '01': 'ÜSTTEN',
  '02': 'ORTADAN',
  '03': 'ALTTAN'
};

/**
 * Pozisyon koduna göre Türkçe etiket döndürür
 */
export function getPositionLabel(code: PositionCode): string {
  return POSITION_LABELS[code];
}

// Küme örnekleme sabitleri
const MAX_PACKAGE_RATIO = 0.25; // Maksimum %25 poşet açılır
const MIN_PACKAGES = 3;         // Minimum 3 poşet açılır

/**
 * Açılacak poşet sayısını hesaplar (maksimum oran sınırlı)
 * S = max(MIN_PACKAGES, floor(T × MAX_RATIO))
 */
export function getPackagesToOpen(_sampleSize: number, totalPackages: number): number {
  // Oran bazlı maksimum poşet sayısı
  const maxByRatio = Math.floor(totalPackages * MAX_PACKAGE_RATIO);

  // En az MIN_PACKAGES, en fazla maxByRatio (ama totalPackages'ı geçmez)
  const packagesToOpen = Math.max(MIN_PACKAGES, maxByRatio);

  return Math.min(packagesToOpen, totalPackages);
}

/**
 * Poşet başına etiket sayısını dinamik hesaplar
 * m = ceil(n / S)
 */
export function getSamplesPerPackage(sampleSize: number, packagesToOpen?: number): number {
  // Eğer packagesToOpen verilmişse dinamik hesapla
  if (packagesToOpen && packagesToOpen > 0) {
    return Math.ceil(sampleSize / packagesToOpen);
  }

  // Geriye uyumluluk için eski sabit kurallar (referans)
  if (sampleSize <= 30) return 3;
  if (sampleSize <= 60) return 4;
  if (sampleSize <= 120) return 5;
  if (sampleSize <= 200) return 8;
  return 10;
}

/**
 * Tek bir rastgele sayıdan palet ve poşet koordinatını hesaplar
 * y → (palet, poşet) dönüşümü
 */
function yToCoordinate(y: number, packagesPerPallet: number): { pallet: number; package: number } {
  const pallet = Math.ceil(y / packagesPerPallet);
  const pkg = y - (pallet - 1) * packagesPerPallet;
  return { pallet, package: pkg };
}

/**
 * Koordinatı PP-BB formatına çevirir
 */
function formatPackageCode(pallet: number, pkg: number): string {
  return `${pallet.toString().padStart(2, '0')}-${pkg.toString().padStart(2, '0')}`;
}

/**
 * Tam pozisyon kodunu PP-BB-NN formatında oluşturur
 */
function formatFullCode(pallet: number, pkg: number, position: PositionCode): string {
  return `${formatPackageCode(pallet, pkg)}-${position}`;
}

/**
 * Fisher-Yates shuffle algoritması ile diziyi karıştırır
 */
function shuffleArray<T>(array: T[]): T[] {
  const shuffled = [...array];
  for (let i = shuffled.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
  }
  return shuffled;
}

/**
 * Döngüsel pozisyon kodu döndürür (01 → 02 → 03 → 01 → ...)
 */
function getCyclicPosition(index: number): PositionCode {
  const positions: PositionCode[] = ['01', '02', '03'];
  return positions[index % 3];
}

/**
 * Ana fonksiyon: Tüm numune pozisyonlarını üretir
 * İki aşamalı küme örneklemesi algoritması
 */
export function generateSamplePositions(
  sampleSize: number,
  config: PackageConfig
): SamplePosition[] {
  const { palletCount, packagesPerPallet } = config;
  const totalPackages = palletCount * packagesPerPallet;

  // Açılacak poşet sayısı (S)
  const packagesToOpen = getPackagesToOpen(sampleSize, totalPackages);

  // 1..T arasında tüm poşet numaralarını oluştur
  const allPackageNumbers = Array.from({ length: totalPackages }, (_, i) => i + 1);

  // Rastgele karıştır ve ilk S tanesini seç
  const selectedPackageNumbers = shuffleArray(allPackageNumbers).slice(0, packagesToOpen);

  // Seçilen poşetleri koordinatlara çevir (rastgele sırayı koru)
  const selectedPackages = selectedPackageNumbers
    .map(y => yToCoordinate(y, packagesPerPallet));

  // Etiket dağılımı: q = n // S, r = n % S
  const q = Math.floor(sampleSize / packagesToOpen);
  const r = sampleSize % packagesToOpen;

  // Tüm numune pozisyonlarını oluştur
  const positions: SamplePosition[] = [];
  let sampleIndex = 0;

  for (let i = 0; i < selectedPackages.length; i++) {
    const { pallet, package: pkg } = selectedPackages[i];

    // Bu poşetten kaç etiket alınacak
    const samplesFromThisPackage = i < r ? q + 1 : q;

    for (let j = 0; j < samplesFromThisPackage; j++) {
      const position = getCyclicPosition(sampleIndex);
      positions.push({
        code: formatFullCode(pallet, pkg, position),
        pallet,
        package: pkg,
        position,
        positionLabel: getPositionLabel(position)
      });
      sampleIndex++;
    }
  }

  return positions;
}

/**
 * Poşet gruplarını döndürür (UI'da poşet bazlı görüntüleme için)
 */
export function getPackageGroups(positions: SamplePosition[]): PackageGroup[] {
  const groupMap = new Map<string, PackageGroup>();

  for (const pos of positions) {
    const key = `${pos.pallet}-${pos.package}`;

    if (!groupMap.has(key)) {
      groupMap.set(key, {
        pallet: pos.pallet,
        package: pos.package,
        packageCode: formatPackageCode(pos.pallet, pos.package),
        sampleCount: 0,
        samples: []
      });
    }

    const group = groupMap.get(key)!;
    group.samples.push(pos);
    group.sampleCount++;
  }

  // Palet sırasına göre sırala
  return Array.from(groupMap.values()).sort((a, b) => {
    if (a.pallet !== b.pallet) return a.pallet - b.pallet;
    return a.package - b.package;
  });
}

/**
 * Bekleyen lotlardan rastgele bir lot seçer
 */
export function selectRandomLot<T extends { status: string; id: string }>(lots: T[]): T | null {
  const pendingLots = lots.filter(l => l.status === 'pending');
  if (pendingLots.length === 0) return null;

  const randomIndex = Math.floor(Math.random() * pendingLots.length);
  return pendingLots[randomIndex];
}

/**
 * Örnekleme istatistiklerini hesaplar
 */
export function calculateSamplingStats(sampleSize: number, config: PackageConfig) {
  const totalPackages = config.palletCount * config.packagesPerPallet;
  const totalItems = totalPackages * config.itemsPerPackage;
  const packagesToOpen = getPackagesToOpen(sampleSize, totalPackages);
  const samplesPerPackage = getSamplesPerPackage(sampleSize, packagesToOpen);

  return {
    totalPackages,
    totalItems,
    samplesPerPackage,
    packagesToOpen,
    estimatedTime: packagesToOpen * 2 // Tahmini dakika (poşet başı 2 dk)
  };
}


========================================
DOSYA: ./utils/fonts/turkishFont.ts
========================================
// Türkçe karakter desteği için jsPDF font konfigürasyonu
// Bu dosya, jsPDF'e Türkçe karakterleri düzgün gösterebilen font ekler

import jsPDF from 'jspdf';

// Türkçe karakterleri destekleyen fontu yükle
// Not: jsPDF varsayılan fontları Türkçe karakterleri desteklemez
// Bu yüzden özel font eklememiz gerekiyor

// Basit çözüm: Türkçe karakterleri ASCII eşdeğerlerine çevirme fonksiyonu
// Bu geçici bir çözümdür, asıl çözüm özel font eklemektir
export function turkishToAscii(text: string): string {
  const charMap: Record<string, string> = {
    'ı': 'i',
    'İ': 'I',
    'ğ': 'g',
    'Ğ': 'G',
    'ü': 'u',
    'Ü': 'U',
    'ş': 's',
    'Ş': 'S',
    'ö': 'o',
    'Ö': 'O',
    'ç': 'c',
    'Ç': 'C',
  };

  return text.replace(/[ığüşöçİĞÜŞÖÇ]/g, (char) => charMap[char] || char);
}

// jsPDF'e Türkçe font ekleme fonksiyonu
// Bu fonksiyon, doküman oluşturulmadan önce çağrılmalıdır
export async function addTurkishFont(doc: jsPDF): Promise<void> {
  // Roboto fontunu CDN'den yükle
  try {
    const fontUrl = 'https://cdn.jsdelivr.net/npm/@fontsource/roboto@5.0.8/files/roboto-latin-400-normal.woff';

    const response = await fetch(fontUrl);
    if (!response.ok) {
      console.warn('Font yüklenemedi, varsayılan font kullanılacak');
      return;
    }

    const arrayBuffer = await response.arrayBuffer();
    const base64 = btoa(
      new Uint8Array(arrayBuffer).reduce(
        (data, byte) => data + String.fromCharCode(byte),
        ''
      )
    );

    // Fontu jsPDF'e ekle
    doc.addFileToVFS('Roboto-Regular.ttf', base64);
    doc.addFont('Roboto-Regular.ttf', 'Roboto', 'normal');
    doc.setFont('Roboto');
  } catch (error) {
    console.warn('Font yüklenirken hata oluştu:', error);
  }
}

// Alternatif: Gömülü font kullanımı
// Bu yöntem daha güvenilir çünkü harici bağlantıya ihtiyaç duymaz
// Ancak dosya boyutu büyür

// Türkçe metin düzeltme fonksiyonu
// Font yüklenemezse bu fonksiyon kullanılır
export function fixTurkishText(text: string, useAscii: boolean = false): string {
  if (useAscii) {
    return turkishToAscii(text);
  }
  return text;
}


========================================
DOSYA: ./utils/pdf.ts
========================================
import jsPDF from 'jspdf';
import autoTable from 'jspdf-autotable';
import type { Lot, Supplier, MaterialType, Inspection } from '../types';
import type { SwitchingLevel } from '../types/switching';
import { SWITCHING_LEVEL_LABELS } from '../types/switching';
import { formatDate, formatDateTime } from '../data/samplingData';

interface PDFData {
  lot: Lot;
  supplier?: Supplier;
  material?: MaterialType;
  inspections: Inspection[];
  defectDistribution: { name: string; count: number }[];
  switchingLevel?: SwitchingLevel;
}

// Türkçe karakterleri ASCII eşdeğerlerine çevirme
// jsPDF varsayılan fontları Türkçe karakterleri desteklemediği için
function tr(text: string): string {
  const charMap: Record<string, string> = {
    'ı': 'i',
    'İ': 'I',
    'ğ': 'g',
    'Ğ': 'G',
    'ü': 'u',
    'Ü': 'U',
    'ş': 's',
    'Ş': 'S',
    'ö': 'o',
    'Ö': 'O',
    'ç': 'c',
    'Ç': 'C',
  };

  return text.replace(/[ığüşöçİĞÜŞÖÇ]/g, (char) => charMap[char] || char);
}

export async function generatePDF(data: PDFData): Promise<void> {
  const { lot, supplier, material, defectDistribution, switchingLevel } = data;

  // Birim belirleme - malzeme türüne göre
  const unit = material?.unit || 'adet';

  const doc = new jsPDF();
  const pageWidth = doc.internal.pageSize.getWidth();

  // Title
  doc.setFontSize(18);
  doc.setFont('helvetica', 'bold');
  doc.text(tr('GELEN MALZEME KALİTE KONTROL RAPORU'), pageWidth / 2, 20, {
    align: 'center',
  });

  // Subtitle
  doc.setFontSize(10);
  doc.setFont('helvetica', 'normal');
  doc.text(tr('ISO 2859-1 Standardı'), pageWidth / 2, 28, { align: 'center' });

  // Report info
  doc.setFontSize(10);
  doc.text(`Rapor No: RPR-${lot.lotNumber}`, 14, 40);
  doc.text(`Tarih: ${formatDateTime(new Date())}`, pageWidth - 14, 40, {
    align: 'right',
  });

  // Lot Number
  doc.setFontSize(12);
  doc.setFont('helvetica', 'bold');
  doc.text(`Parti No: ${lot.lotNumber}`, 14, 50);

  // Supplier Information
  doc.setFontSize(11);
  doc.setFont('helvetica', 'bold');
  doc.text(tr('TEDARİKÇİ BİLGİLERİ'), 14, 62);
  doc.setFont('helvetica', 'normal');
  doc.setFontSize(10);

  const supplierData = [
    [tr('Tedarikçi'), supplier?.name || '-'],
    [tr('Sipariş No'), lot.orderNumber || '-'],
    ['Teslim Tarihi', formatDate(lot.receivedDate)],
  ];

  autoTable(doc, {
    startY: 65,
    head: [],
    body: supplierData,
    theme: 'plain',
    styles: { fontSize: 10 },
    columnStyles: {
      0: { fontStyle: 'bold', cellWidth: 40 },
      1: { cellWidth: 100 },
    },
    margin: { left: 14 },
  });

  // Material Information
  const materialY = (doc as any).lastAutoTable.finalY + 8;
  doc.setFontSize(11);
  doc.setFont('helvetica', 'bold');
  doc.text(tr('MALZEME BİLGİLERİ'), 14, materialY);

  const materialData = [
    [tr('Malzeme Türü'), tr(material?.name || '-')],
    [tr('Parti Miktarı'), `${lot.quantity.toLocaleString('tr-TR')} ${unit}`],
  ];

  autoTable(doc, {
    startY: materialY + 3,
    head: [],
    body: materialData,
    theme: 'plain',
    styles: { fontSize: 10 },
    columnStyles: {
      0: { fontStyle: 'bold', cellWidth: 40 },
      1: { cellWidth: 100 },
    },
    margin: { left: 14 },
  });

  // Sampling Parameters
  const samplingY = (doc as any).lastAutoTable.finalY + 8;
  doc.setFontSize(11);
  doc.setFont('helvetica', 'bold');
  doc.text(tr('ÖRNEKLEME PARAMETRELERİ'), 14, samplingY);

  // Switching seviye metni
  const switchingLevelText = switchingLevel
    ? tr(SWITCHING_LEVEL_LABELS[switchingLevel])
    : 'Normal';

  const samplingData = [
    ['Standart', 'ISO 2859-1'],
    ['Muayene Seviyesi', `Seviye ${lot.inspectionLevel}`],
    ['Kontrol Durumu', switchingLevelText],
    ['AQL', `%${lot.aql}`],
    [tr('Örneklem Kodu'), lot.sampleCode],
    [tr('Örneklem Büyüklüğü'), `${lot.sampleSize} ${unit}`],
    [tr('Kabul Sayısı (Ac)'), lot.acceptanceNumber.toString()],
    [tr('Red Sayısı (Re)'), lot.rejectionNumber.toString()],
  ];

  autoTable(doc, {
    startY: samplingY + 3,
    head: [],
    body: samplingData,
    theme: 'plain',
    styles: { fontSize: 10 },
    columnStyles: {
      0: { fontStyle: 'bold', cellWidth: 50 },
      1: { cellWidth: 90 },
    },
    margin: { left: 14 },
  });

  // Control Results
  const resultsY = (doc as any).lastAutoTable.finalY + 8;
  doc.setFontSize(11);
  doc.setFont('helvetica', 'bold');
  doc.text(tr('KONTROL SONUÇLARI'), 14, resultsY);

  const uygunCount = lot.sampleSize - lot.defectCount;
  const controlData = [
    ['Kontrol Edilen', `${lot.sampleSize} ${unit}`],
    ['Uygun', `${uygunCount} ${unit}`],
    [tr('Hatalı'), `${lot.defectCount} ${unit}`],
  ];

  autoTable(doc, {
    startY: resultsY + 3,
    head: [],
    body: controlData,
    theme: 'plain',
    styles: { fontSize: 10 },
    columnStyles: {
      0: { fontStyle: 'bold', cellWidth: 40 },
      1: { cellWidth: 100 },
    },
    margin: { left: 14 },
  });

  // Decision Box
  const decisionY = (doc as any).lastAutoTable.finalY + 10;
  const isAccepted = lot.decision === 'accepted';

  doc.setDrawColor(isAccepted ? 16 : 239, isAccepted ? 185 : 68, isAccepted ? 129 : 68);
  doc.setFillColor(isAccepted ? 236 : 254, isAccepted ? 253 : 242, isAccepted ? 245 : 242);
  doc.roundedRect(14, decisionY, pageWidth - 28, 20, 3, 3, 'FD');

  doc.setFontSize(12);
  doc.setFont('helvetica', 'bold');
  doc.setTextColor(isAccepted ? 5 : 185, isAccepted ? 150 : 28, isAccepted ? 105 : 28);
  doc.text(
    tr(`KARAR: PARTİ ${isAccepted ? 'KABUL EDİLMİŞTİR' : 'REDDEDİLMİŞTİR'}`),
    pageWidth / 2,
    decisionY + 8,
    { align: 'center' }
  );
  doc.setFontSize(10);
  doc.setFont('helvetica', 'normal');
  doc.text(
    tr(`(${lot.defectCount} ${isAccepted ? '<=' : '>='} ${isAccepted ? lot.acceptanceNumber : lot.rejectionNumber}, Hatalı sayısı ${isAccepted ? 'kabul limitinde' : 'red limitini aştı'})`),
    pageWidth / 2,
    decisionY + 15,
    { align: 'center' }
  );

  // Reset text color
  doc.setTextColor(0, 0, 0);

  // Defect Distribution
  if (defectDistribution.length > 0) {
    const defectY = decisionY + 30;
    doc.setFontSize(11);
    doc.setFont('helvetica', 'bold');
    doc.text(tr('HATA DAĞILIMI'), 14, defectY);

    const defectTableData = defectDistribution.map((item) => [
      tr(item.name),
      item.count.toString(),
      `%${((item.count / lot.defectCount) * 100).toFixed(1)}`,
    ]);

    defectTableData.push(['TOPLAM', lot.defectCount.toString(), '%100']);

    autoTable(doc, {
      startY: defectY + 3,
      head: [[tr('Hata Tipi'), 'Adet', 'Oran']],
      body: defectTableData,
      theme: 'striped',
      styles: { fontSize: 10 },
      headStyles: { fillColor: [37, 99, 235], textColor: 255 },
      margin: { left: 14 },
    });
  }

  // Signature Section
  const signatureY = Math.min((doc as any).lastAutoTable?.finalY + 20 || decisionY + 50, 250);

  doc.setFontSize(10);
  doc.setFont('helvetica', 'normal');

  // Signature boxes
  doc.text('Kontrol Eden:', 14, signatureY);
  doc.line(14, signatureY + 15, 80, signatureY + 15);
  doc.text(tr('İmza:'), 14, signatureY + 20);

  doc.text('Onaylayan:', 110, signatureY);
  doc.line(110, signatureY + 15, 176, signatureY + 15);
  doc.text(tr('İmza:'), 110, signatureY + 20);

  doc.text(`Tarih: ${formatDate(new Date())}`, 14, signatureY + 30);

  // Footer
  doc.setFontSize(8);
  doc.setTextColor(128, 128, 128);
  doc.text(
    tr('Bu rapor ISO 2859-1 standartlarına uygun olarak hazırlanmıştır.'),
    pageWidth / 2,
    285,
    { align: 'center' }
  );

  // Save
  doc.save(`Kontrol_Raporu_${lot.lotNumber}.pdf`);
}

export async function generateBulkPDF(lots: Lot[], suppliers: Supplier[], materials: MaterialType[]): Promise<void> {
  const doc = new jsPDF();
  const pageWidth = doc.internal.pageSize.getWidth();

  // Title
  doc.setFontSize(16);
  doc.setFont('helvetica', 'bold');
  doc.text(tr('KALİTE KONTROL ÖZET RAPORU'), pageWidth / 2, 20, { align: 'center' });

  doc.setFontSize(10);
  doc.setFont('helvetica', 'normal');
  doc.text(tr(`Oluşturulma Tarihi: ${formatDateTime(new Date())}`), pageWidth / 2, 28, {
    align: 'center',
  });

  // Summary stats
  const accepted = lots.filter((l) => l.decision === 'accepted').length;
  const rejected = lots.filter((l) => l.decision === 'rejected').length;

  doc.setFontSize(11);
  doc.setFont('helvetica', 'bold');
  doc.text(tr('GENEL ÖZET'), 14, 45);

  const summaryData = [
    ['Toplam Parti', lots.length.toString()],
    ['Kabul Edilen', accepted.toString()],
    ['Reddedilen', rejected.toString()],
    [tr('Kabul Oranı'), `%${lots.length > 0 ? ((accepted / lots.length) * 100).toFixed(1) : 0}`],
  ];

  autoTable(doc, {
    startY: 48,
    head: [],
    body: summaryData,
    theme: 'plain',
    styles: { fontSize: 10 },
    columnStyles: {
      0: { fontStyle: 'bold', cellWidth: 40 },
      1: { cellWidth: 40 },
    },
    margin: { left: 14 },
  });

  // Lot list
  const listY = (doc as any).lastAutoTable.finalY + 15;
  doc.setFontSize(11);
  doc.setFont('helvetica', 'bold');
  doc.text(tr('PARTİ LİSTESİ'), 14, listY);

  const tableData = lots.map((lot) => {
    const supplier = suppliers.find((s) => s.id === lot.supplierId);
    const material = materials.find((m) => m.id === lot.materialTypeId);
    return [
      lot.lotNumber,
      supplier?.name || '-',
      tr(material?.name || '-'),
      lot.quantity.toLocaleString('tr-TR'),
      `${lot.defectCount}/${lot.sampleSize}`,
      lot.decision === 'accepted' ? 'KABUL' : lot.decision === 'rejected' ? 'RED' : '-',
      formatDate(lot.createdAt),
    ];
  });

  autoTable(doc, {
    startY: listY + 3,
    head: [[tr('Parti No'), tr('Tedarikçi'), 'Malzeme', 'Miktar', tr('Hatalı'), tr('Sonuç'), 'Tarih']],
    body: tableData,
    theme: 'striped',
    styles: { fontSize: 8 },
    headStyles: { fillColor: [37, 99, 235], textColor: 255 },
    margin: { left: 14, right: 14 },
    columnStyles: {
      5: {
        fontStyle: 'bold',
      },
    },
    didParseCell: (data) => {
      if (data.column.index === 5 && data.section === 'body') {
        if (data.cell.text[0] === 'KABUL') {
          data.cell.styles.textColor = [16, 185, 129];
        } else if (data.cell.text[0] === 'RED') {
          data.cell.styles.textColor = [239, 68, 68];
        }
      }
    },
  });

  // Footer
  doc.setFontSize(8);
  doc.setTextColor(128, 128, 128);
  doc.text(
    tr('Bu rapor ISO 2859-1 standartlarına uygun olarak hazırlanmıştır.'),
    pageWidth / 2,
    285,
    { align: 'center' }
  );

  doc.save(`Kalite_Kontrol_Ozet_${formatDate(new Date()).replace(/\//g, '-')}.pdf`);
}


========================================
DOSYA: ./utils/switchingLogic.ts
========================================
// ISO 2859-1 Switching Rules Mantığı

import type { SwitchingLevel, SwitchingState, SwitchingTransition } from '../types/switching';
import { SAMPLE_MULTIPLIERS, SWITCHING_LEVEL_LABELS } from '../types/switching';

// Varsayılan switching state
export function createDefaultSwitchingState(
  supplierId: string,
  materialTypeId: string
): SwitchingState {
  return {
    supplierId,
    materialTypeId,
    currentLevel: 'normal',
    consecutiveAccepts: 0,
    consecutiveRejects: 0,
    recentResults: [],
    history: [],
    lastUpdated: new Date().toISOString(),
    shouldStopProduction: false,
  };
}

// Switching kurallarını değerlendir
export function evaluateSwitching(
  state: SwitchingState,
  newResult: 'accepted' | 'rejected',
  lotId: string,
  lotNumber: string
): { newState: SwitchingState; transition: SwitchingTransition | null } {
  const updatedState = { ...state };

  // Son 5 sonucu güncelle
  updatedState.recentResults = [...state.recentResults, newResult].slice(-5);

  // Ardışık sayaçları güncelle
  if (newResult === 'accepted') {
    updatedState.consecutiveAccepts = state.consecutiveAccepts + 1;
    updatedState.consecutiveRejects = 0;
  } else {
    updatedState.consecutiveRejects = state.consecutiveRejects + 1;
    updatedState.consecutiveAccepts = 0;
  }

  updatedState.lastUpdated = new Date().toISOString();

  // Switching kurallarını uygula
  let transition: SwitchingTransition | null = null;
  const previousLevel = state.currentLevel;

  switch (state.currentLevel) {
    case 'normal':
      // 10 ardışık KABUL → Gevşetilmiş
      if (updatedState.consecutiveAccepts >= 10) {
        updatedState.currentLevel = 'reduced';
        transition = createTransition(previousLevel, 'reduced', '10 ardışık kabul', lotId, lotNumber);
        updatedState.consecutiveAccepts = 0;
      }
      // Son 5 lottan 2+ RED → Sıkılaştırılmış
      else if (countRejects(updatedState.recentResults) >= 2) {
        updatedState.currentLevel = 'tightened';
        transition = createTransition(previousLevel, 'tightened', 'Son 5 lottan 2+ red', lotId, lotNumber);
        updatedState.recentResults = [];
      }
      break;

    case 'tightened':
      // 5 ardışık RED → Üretim durdurulmalı
      if (updatedState.consecutiveRejects >= 5) {
        updatedState.shouldStopProduction = true;
        // Seviye değişmez ama uyarı verilir
      }
      // 5 ardışık KABUL → Normal
      else if (updatedState.consecutiveAccepts >= 5) {
        updatedState.currentLevel = 'normal';
        updatedState.shouldStopProduction = false;
        transition = createTransition(previousLevel, 'normal', '5 ardışık kabul', lotId, lotNumber);
        updatedState.consecutiveAccepts = 0;
        updatedState.recentResults = [];
      }
      break;

    case 'reduced':
      // 1 RED → Normal
      if (newResult === 'rejected') {
        updatedState.currentLevel = 'normal';
        transition = createTransition(previousLevel, 'normal', 'Red alındı', lotId, lotNumber);
        updatedState.recentResults = [];
      }
      break;
  }

  // Geçiş geçmişine ekle
  if (transition) {
    updatedState.history = [...state.history, transition];
  }

  return { newState: updatedState, transition };
}

// Red sayısını hesapla
function countRejects(results: ('accepted' | 'rejected')[]): number {
  return results.filter(r => r === 'rejected').length;
}

// Geçiş kaydı oluştur
function createTransition(
  fromLevel: SwitchingLevel,
  toLevel: SwitchingLevel,
  reason: string,
  lotId: string,
  lotNumber: string
): SwitchingTransition {
  return {
    id: `trans-${Date.now()}`,
    fromLevel,
    toLevel,
    reason,
    lotId,
    lotNumber,
    timestamp: new Date().toISOString(),
  };
}

// Seviyeye göre örneklem boyutunu ayarla
export function getAdjustedSampleSize(baseSize: number, level: SwitchingLevel): number {
  const multiplier = SAMPLE_MULTIPLIERS[level];
  const adjusted = Math.round(baseSize * multiplier);
  return Math.max(adjusted, 2); // Minimum 2 numune
}

// Seviyeye göre kabul sayısını ayarla
export function getAdjustedAcceptance(
  baseAcceptance: number,
  baseRejection: number,
  level: SwitchingLevel
): { acceptance: number; rejection: number } {
  if (level === 'tightened') {
    // Sıkılaştırılmışta Ac düşer
    const newAcceptance = Math.max(0, baseAcceptance - 1);
    return {
      acceptance: newAcceptance,
      rejection: newAcceptance + 1,
    };
  }

  // Normal ve Gevşetilmiş'te aynı
  return {
    acceptance: baseAcceptance,
    rejection: baseRejection,
  };
}

// Geçiş sebebi metni
export function getTransitionText(transition: SwitchingTransition): string {
  const from = SWITCHING_LEVEL_LABELS[transition.fromLevel];
  const to = SWITCHING_LEVEL_LABELS[transition.toLevel];
  return `${from} → ${to}: ${transition.reason}`;
}

// Seviye durumu özeti
export function getSwitchingStatusText(state: SwitchingState): string {
  const level = SWITCHING_LEVEL_LABELS[state.currentLevel];

  if (state.shouldStopProduction) {
    return `${level} - ⚠️ Üretim durdurulmalı`;
  }

  if (state.currentLevel === 'normal') {
    if (state.consecutiveAccepts > 0) {
      return `${level} - ${state.consecutiveAccepts}/10 ardışık kabul`;
    }
    const rejects = countRejects(state.recentResults);
    if (rejects > 0) {
      return `${level} - ${rejects}/2 red (son 5 lot)`;
    }
  }

  if (state.currentLevel === 'tightened') {
    if (state.consecutiveAccepts > 0) {
      return `${level} - ${state.consecutiveAccepts}/5 ardışık kabul`;
    }
    if (state.consecutiveRejects > 0) {
      return `${level} - ${state.consecutiveRejects}/5 ardışık red`;
    }
  }

  return level;
}


